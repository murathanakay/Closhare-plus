
function toggleNavToDropdown(a){var b=$page.find("ul.fr");if(a){$page.addClass("btn-group");b.addClass("dropdown-menu").removeClass("pull-left")}else{$page.removeClass("btn-group");b.removeClass("dropdown-menu").addClass("pull-left")}}function topBar(){setTimeout(function(){var a=$topActBtns.width();if(a<523){toggleNavToDropdown(true);$wrap.addClass("small").removeClass("medium wide");$list.find("li.preview").removeClass("col-xs-3").addClass("col-xs-12 col-sm-12")}else{if(a>=593&&a<768){toggleNavToDropdown(true);$wrap.addClass("medium").removeClass("small wide");$list.find("li.preview").removeClass("col-xs-12 col-sm-6").addClass("col-xs-3")}else{if(a>=768){toggleNavToDropdown(false);$wrap.addClass("wide").removeClass("small medium");$list.find("li.preview").removeClass("col-xs-12 col-sm-12")}}}},150)}function sidebar(){dirTreeScr()}function dirTreeScr(){$dirTree.slimScroll({height:"auto",});$sideBarStaticTree.find(".scr").slimScroll({height:"auto",})}function fullreload(){if(navigator.userAgent.indexOf("Safari")===-1&&navigator.userAgent.indexOf("Chrome")!==-1){window.location=CLO_URL}else{location.reload()}}function successBoxForm(d,b,i,k,h,a,c,f,j,e){if($.inArray(f,j)>-1){if(h){h.button("reset");if(!h.hasClass("noDisable")){setTimeout(function(){h.disabletoggle(true)},17)}}}else{if(h){h.prev("a").text("Close");h.remove()}$(window).resize();var g=parseInt(a.data("countdown")?a.data("countdown"):10);a.find(".countdow span").countdown(g,"Box will be closed in",function(){a.modal("hide")});if(c){if(k.find('input[name="value"]:first').val()==currDirID){window.location.replace("#page="+currPage)}else{if($.inArray(f,e)===-1){reloadPage(1,false,1000)}}sidebarStatistics()}else{if($.inArray(f,e)===-1){reloadPage(1,false,1000)}}}}function handleBoxFormAjaxResponse(h,b,l,n,k,a){var e=(n.attr("id")=="form_delete")?true:false,j=n.attr("id"),m=new Array("form_downloadItem","form_tpage","form_downloadFolder","form_downloadItems"),i=new Array("form_email");var c=h.message?(h.message.txt?h.message.txt:h.message):"";if(h.result==1){if($.inArray(j,m)>-1){if(a.find(".callout.result").length>0){n.find(".callout:first").removeClass("callout-danger").addClass("callout-success").show().find("div").htmlA(c,200,function(){return successBoxForm(h,b,l,n,k,a,e,j,m,i)})}else{return successBoxForm(h,b,l,n,k,a,e,j,m,i)}console.log("yesarr")}else{console.log("noarr");n.htmlA('<div class="form-group" style="margin: 0; float:none"><div class="callout callout-'+(e?"danger":"success")+'">'+c+"</div></div>",200,function(){return successBoxForm(h,b,l,n,k,a,e,j,m,i)})}var f=n.find(".control").attr("id")+"_callback";if(f in window){window[f]()}}else{var g=n.find(".callout:first");g.removeClass("callout-success").addClass("callout-danger");if(n.find(".fterr").length==0){var d=$('<div class="form-group fterr" style="margin: 0"/>');n.prepend(d)}else{d=n.find(".fterr")}d.append(g);if(g.is(":hidden")){g.show().find("div:first").htmlA(h.message,200,function(){$(window).resize()})}else{g.find("div:first").html(h.message)}if(k){k.button("reset")}}if(k){k.blur()}}function handleboxForms(a,b,d){var a=a;var c={success:function(f,g,h,e){handleBoxFormAjaxResponse(f,g,h,e,a,d);e.unblock()},dataType:"json"};b.blockit({message:indicatorCssSm+" Please wait...",simple:true,button:false});b.ajaxSubmit(c)}function loadShareBigBox(e,a,c,d,b){c.find("#share_box").empty().append('<div class="sharebox"></div>');$(".ignoretitem").off("click").on("click",function(){var j=$(this).closest("div.thumbnail"),k=j.data("id"),i=c.find('input[name="value"]'),g=d.find(".box_title .count");i.val(removeVal(i.val(),k));selectedItems[dir.id]=jQuery.grep(selectedItems[dir.id],function(m,l){return m!==k});var f=$list.findItem(k,"selected");selectItem(f,true);e.data("item",selectedItems[dir.id].join(","));var h=selectedItems[dir.id].length;if(h===0){d.modal("hide")}g.text(h);hideTip(j[0]);j.remove();if(h>=1){loadShareBigBox(e,a,c,d," Refreshing item list...")}});c.blockit({message:indicatorCssSm+(b?b:" Loading social platforms..."),simple:true,button:false});$.ajaxQueue({url:AJAX_PATH,type:"POST",data:{action:"prepare_share",value:e.data("item")},dataType:"json",success:function(f){$spintarget.spin(false);c.unblock();c.find(".sharebox").html(f.html);c.find("#go-share-url-btn").attr("href",f.link);c.find("#share_url").removeClass("vh");c.find("#share_short_url").on("focus click",function(){$(this).select()}).val(f.link);c.find(".sharebox").share({networks:f.shareOpts,link:f.link,url:f.url,title:f.title,desc:f.description,theme:"default"});console.log(f.exclude);if(f.exclude.length>0){console.log(f.exclude);$.each(f.exclude,function(g,h){console.log(c.findItem(h,"thumbnail",false,"div"));c.findItem(h,"thumbnail",false,"div").addClass("error").attr({"data-original-title":"Not found!"})})}loadscript({src:ASSURI+"js/rotors/zero/ZeroClipboard.min.js"},function(){var g=new ZeroClipboard(document.getElementById("copy-share-url-btn"));ZeroClipboard.config({moviePath:ASSURI+"js/rotors/zero/ZeroClipboard.swf"});g.on("ready",function(h){g.on("aftercopy",function(i){jQuery("#copy-to-clipboard-result").show("highlight").text("Copied link to clipboard");$(window).resize()})})})}})}function loadShareBox(a){if($list.find(".sharebox").length>0){$list.find(".sharebox").find(".close").trigger("click")}a.append('<div class="sharebox"></div>');a.blockit({message:indicatorCssPurple,simple:true,usimple:true,button:false});$.ajaxQueue({url:AJAX_PATH,type:"POST",data:{action:"prepare_share",value:a.data("id")},dataType:"json",beforeSend:function(){},success:function(b){$spintarget.spin(false);a.unblock();a.find(".sharebox").html(b.html);a.addClass("sharing");setTimeout(function(){a.find(".sharebox").share({networks:b.shareOpts,link:b.link,url:b.url,title:b.title,desc:b.description,theme:"circle"});a.find(".sharebox").append($('<span class="close icon icon-times" title="Cancel" rel="tip"></span>').on("click",function(){hideTip(this);var c=$(this).closest("li");c.find(".sharebox").remove();c.removeClass("sharing")}))},600)}})}function isApproachingToBottom(c){var e=(c[0].tagName.toLowerCase()=="body"?$(window):c);var b=c[0].scrollHeight,a=e.height()+e.scrollTop(),d=100;return(b-d<=a)}$(function(){count=0;loadingMore=false;if(!isMob()){$screl.scroll($.debounce(500,function(){var e=$(this);if(dir.scrollMore){if(isApproachingToBottom(e)){loadMore=true;$("#moreItemLoader").show();dir.page=dir.page+1;if(loadingMore===false){loadingMore=true;doPageLoad(false,{page:"list",dir:currDir,path:dir.path,p:dir.id+","+dir.parentid,pg:dir.page,filter:currFilter,search:(currSearch?currSearch:undefined),sort:sortby,order:orderby},false);loadingMore=false}}}return false}))}var b=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.value)},limit:5,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:AJAX_PATH+"?dir=%DIR&in=%IN&search=%KEY&q=%QUERY",type:"GET",dataType:"json",replace:function(e,f){return e.replace("%DIR",currDirID).replace("%IN",$("#search_filter").find(":selected").val()).replace("%KEY","key").replace("%QUERY",encodeURIComponent(f))},xhrSending:function(){$indicatorEl.css("visibility","visible")},xhrDone:function(f){$indicatorEl.css("visibility","hidden");var h=$searcher.data("url")?$searcher.data("url"):{},g=$.deparam(f);h[g.q]=g.q;$searcher.data("url",h);var e='<div id="search_details" class="well well-sm borrn ptb5 mb5 mt0 curdef">Search result for <span class="highlight p3"><span class="large">"</span><b class="medium">'+g.q+'</b><span class="large">"</span></span> inside <b class="ul">'+dir.name+'</b> with filter <b class="ul">'+$("#search_filter").find(":selected").text()+"</b></div>";if($("#search_details").length>0){$("#search_details").replaceWith(e)}else{$searcher.find(".tt-dropdown-menu").prepend(e)}setTimeout(function(){$indicatorEl.css("visibility","hidden")},5000)},filter:function(e){return $.map(e,function(f){f.value=f.name;return f})}}});var d=b.initialize();$("#search").typeahead(null,{hint:true,highlight:true,items:10,minLength:0,templates:{empty:['<div class="alert alert-warning bgw mt0 mb0 p5 brn">',"unable to find any items that match the current query","</div>"].join("\n"),suggestion:tmpl("query-suggestions")},displayKey:function(f,e){return this.query},source:b.ttAdapter()}).on("typeahead:selected",function(i,h,f){var g=createDomItem(h);g.attr("id",h.type+h.id);if(h.type=="folder"){g.data("hash",h.hash)}g.find(".vpsve").toggleClass("vpsve fakevpsve");g.addClass("dn").appendTo("body");$(".fakevpsve").vobox();loadMore=false;$.bbq.pushState({dir:dir.hash,search:encodeURIComponent($("#search").val())});$("#search").typeahead("close");return false}).on("typeahead:opened",function(f,g,e){$("#search").focus()}).on("typeahead:closed",function(f,g,e){});var c=$.cookie("CLO_SF")||false;if(c&&c!="all"){$("#search_filter").find(":selected").removeAttr("selected");$("#search_filter").find('[value="'+c+'"]').attr("selected",true);$("#search_filter").trigger("change")}else{$.cookie("CLO_SF",$("#search_filter").find(":selected").val())}$("#search_filter").on("change",function(){$("#search").focus();c=$(this).find(":selected").val();$.cookie("CLO_SF",c);b.clearRemoteCache()});$("#search_submit").on("click",function(){var e=$("#search").val();if($searcher.hasClass("on")){if(e.length>0&&e!=currSearch){loadMore=false;var f={dir:dir.hash,search:encodeURIComponent(e)};if(c!="all"&&c!==false){console.log(c);f.filter=c}$.bbq.pushState(f);$("#search").typeahead("close");return false}else{$("#search").focus()}}if((!$searcher.hasClass("on"))||$searcher.val().length==0){$("#search").focus()}return false});var a;$(document).mousedown(function(f){a=f.target||f.srcElement;checkCloseSearch(this,a)});$(document).mouseup(function(f){a=null});$("#search").on("focus",function(){$searcher.addClass("on");$list.addClass("listdown");if(isMob()){return}var e=$.Event("keydown");e.keyCode=e.which=40;$(this).trigger(e);return true}).on("blur",function(f){checkCloseSearch(this,a)}).on("keyup",function(j){var i=$(this),g=$(this).val();if(i.val().length>0){$searcher.addClass("opened");$searcher.find(".clearinput").addClass("on");if($searcher.data("url")){var h=$searcher.data("url");if(i.val() in h){var f='<div id="search_details" class="well well-sm borrn ptb5 mb5 mt0 curdef">Search result for <span class="highlight p3"><span class="large">"</span><b class="medium">'+h[i.val()]+'</b><span class="large">"</span></span> inside <b class="ul">'+dir.name+'</b> with filter <b class="ul">'+$("#search_filter").find(":selected").text()+"</b></div>";if($("#search_details").length>0){$("#search_details").replaceWith(f)}else{$searcher.find(".tt-dropdown-menu").prepend(f)}}}}else{$searcher.removeClass("opened");$searcher.find(".clearinput").removeClass("on")}if(j&&j.which===$.ui.keyCode.ENTER&&$.trim(g)!==""){$("#search_submit").trigger("click")}});$searcher.find(".clearinput").on("click",function(){$("#search").typeahead("val","").focus().trigger("keyup");return false});$body.on("click",".suggestion-action",function(g){g.preventDefault();g.stopPropagation();var f=$(this),h=f.data();hideTip(this);setTimeout(function(){switch(h.action){case"viewItem":var e=$("#"+h.type+h.id).find(".fakevpsve");e.trigger("click");e.on("click",function(){$("#"+h.type+h.id).removeClass("dn")});break;case"downloaditem":itemActions("downloadItem",$("#"+h.type+h.id),false);break;case"downloadfolder":itemActions("downloadItem",$("#"+h.type+h.id),false);break;case"openupfolder":$.bbq.pushState({dir:$("#"+h.type+h.id).data("hash")});break}},17);return false})});window.onbeforeunload=function(){if(currprocData("uploadinprogress")==1){return"An upload process is running. Do you really want to leave the page?"}};function checkCloseSearch(c,a){var b=(typeof a!="undefined"&&a!==null)?($("#searcher").has(a).length>0||$("#search").is(a)):false;if(!b){$searcher.find(".tt-dropdown-menu").css("display","none");$searcher.removeClass("on");$list.removeClass("listdown");$body.removeClass("searcison")}}function updateprocData(a){var b=$viewPort.data("procs");$.extend(true,b,a);$viewPort.data("procs",b)}function currprocData(a){var b=$viewPort.data("procs")||0;return b?b[a]:0}function loadPage(d,b,a){var c=a||1;setTimeout(function(){$.bbq.pushState(d);if(b){forceUpdate=true}},c)}function reloadPage(f,d,a){var b=$.param.fragment(),e=a||1,c;setTimeout(function(){if(f){forceUpdate=true;$.bbq.pushState($.param.fragment(),2);$(window).trigger("hashchange")}else{forceUpdate=false;$(d).unblock();$spintarget.spin(false)}},e)}function returnTypeIcon(b){var a="other";if(b===false){return a}$.each(typesObj,function(c,d){if($.inArray(b,d)>-1){a=c.split("-")[0];return}});return a}function loadExtractDirectories(g,a,b,f){var h=g.data(),c={action:"extract_directories",value:h.id,path:dir.path,name:h.t,toSelect:{name:"extract_to",id:"exto","class":"form-control"}},e=b.find("#extract_to");$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:c,beforeSend:function(){setTimeout(function(){e.blockit({message:$indicator+" loading target tree...",simple:true,button:false})},16)},success:function(j,k,m){if(j.result){setTimeout(function(){e.unblock()},50);e.html(j.html);var d=b.find("#zip_contains");b.find("#zip_infp").prepend('<div class="callout callout-info mt10"><b>'+j.zipInfo.data.Items+"</b> Items | <b>"+j.zipInfo.data.Size+"</b>B<small>("+formatFileSize(j.zipInfo.data.Size)+")</small> | <b>"+j.zipInfo.data.UnCompSize+"</b>B<small>(Uncompressed:"+formatFileSize(j.zipInfo.data.UnCompSize)+")</small><b> | "+j.zipInfo.data.Ratio+"%</b> ratio.</div>");d.find("div.int").html(j.zipInfo.table.html);var l=d.find("table");d.find("#zip_cont-inner").on("shown.bs.collapse",function(){if(!l.hasClass("footable")){l.footable()}$(window).resize()}).on("hidden.bs.collapse",function(){$(window).resize()});$(window).resize()}var i=$.deparam.fragment(b.serialize());$.extend(true,i,{parentid:dir.id});b.find("#extract_toBtn").on("click",function(){var n=$(this);var o=$.deparam.fragment(b.serialize());$.extend(true,o,{parentid:dir.id});$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:o,beforeSend:function(){n.button("loading");saveArchive=(f.find("#saveZip").is(":checked")?1:0)},success:function(p,q,r){handleBoxFormAjaxResponse(p,q,r,b,n,f);if(p.result){n.toggleClass("btn-primary-alt btn-success-alt")}else{n.button("reset").removeClass("btn-primary-alt").addClass("btn-danger-alt")}}})})}})}function calculateArchiveSize(g,a,b,f){var i=g.data();var e={action:"calculate_size",value:archiveItems.value,path:archiveItems.path,parent:archiveItems.parent},h=i.diro,c=1;$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:e,beforeSend:function(){setTimeout(function(){b.find(".tbs").blockit({message:indicatorCssSm+" calculating approximate size...",simple:true,button:false})},16)},success:function(d){setTimeout(function(){b.find(".tbs").unblock()},50);f.find("#total_size_down").find("strong").html(d.size);archiveItems={};f.find("#downloadBtn").on("click",function(){var j=$(this);$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:{dirid:(dir.id==1?1:(h?dir.parentid:dir.id)),action:"compress",dirname:(dir.id==1&&h?dir.hash:dir.name),ondir:h},beforeSend:function(){j.button("loading");c=(f.find("#saveZip").is(":checked")?1:0)},success:function(k,l,m){handleBoxFormAjaxResponse(k,l,m,b,j,f);if(k.result){j.toggleClass("btn-primary-alt btn-success-alt")}else{j.button("reset").toggleClass("btn-primary-alt btn-danger-alt")}}})})}})}function prepareDownload(g,a,b,f){var i=g.data();$item=$list.findItem(i.value,"selected");var e={action:"prepare_download",value:downloadItems.value,path:downloadItems.path,name:i.name},h=i.diro,c=1;$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:e,beforeSend:function(){setTimeout(function(){b.find(".tbs").blockit({message:$indicator+" preparing to download...",simple:true,button:false})},16)},success:function(d,j,k){setTimeout(function(){b.find(".tbs").unblock().hide();handleBoxFormAjaxResponse(d,j,k,b,false,f)},50);downloadItems={};$.fileDownload(d.octet).done(function(){selectItem($item,true);$.removeCookie("CLO_OCT")}).fail(function(){alert("File download failed!")})}})}function calculateDownloadSize(g,a,b,f){var i=g.data();var e={action:"calculate_size",value:downloadItems.value,path:downloadItems.path},h=i.diro,c=1;$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:e,beforeSend:function(){setTimeout(function(){b.find(".tbs").blockit({message:indicatorCssSm+" calculating approximate size...",simple:true,button:false})},16)},success:function(d){setTimeout(function(){b.find(".tbs").unblock()},50);f.find("#total_size_down").find("strong").html(d.size);downloadItems={};f.find("#downloadBtn").on("click",function(){var j=$(this);$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:{dirid:(dir.id==1?1:(h?dir.parentid:dir.id)),action:"download",dirname:(dir.id==1&&h?dir.hash:dir.name),ondir:h,saveArchive:(f.find("#saveZip").is(":checked")?1:0)},beforeSend:function(){j.button("loading");c=(f.find("#saveZip").is(":checked")?1:0)},success:function(k,l,m){handleBoxFormAjaxResponse(k,l,m,b,j,f);if(k.result){j.toggleClass("btn-primary-alt btn-success-alt");if((dir.id==1&&c)||(!h&&c)){reloadPage(1,false,400)}$.fileDownload(k.octet).done(function(){$.removeCookie("CLO_OCT")}).fail(function(){alert("File download failed!")})}else{j.button("reset").toggleClass("btn-primary-alt btn-danger-alt")}}})})}})}$(function(){$topActBtns.find(".act").on("click",function(i){i.preventDefault();hideTip(this);var h=$(this),g=h.data(),a=g.clicked;if(a){return false}switch(g.action){case"updatedir":$notify.jGrowl("close").jGrowl('<div class="icon icon-flash animated zoomOutLeft loop"></div>Syncing current folder...',{header:"In progress",sticky:true,theme:"iconup"});forceUpdate=true;var f={page:"list",dir:currDir,force:true,updatedir:1,path:dir.path,p:dir.id+","+dir.parentid,filter:(currFilter?currFilter:undefined),search:(currSearch?currSearch:undefined)};doPageLoad(false,f,false,"sidebarStatistics");break;case"createdir":var d=createJElobj({"data-type":"d"}).data("id","d_"+dir.id);itemActions("create",d,false);break;case"sharedir":var d=createJElobj(false);createActionBox("share",d,"loadShareBox","share-square");break;case"cutItem":itemActions("cut",$("#list li.selected"),false);break;case"copyItem":itemActions("copy",$("#list li.selected"),false);break;case"pasteItem":itemActions("paste",cutcopyItems,false,true);break;case"deleteItem":itemActions("delete",$("li.preview.selected"),false);break;case"shareItem":itemActions("shareItem",$("li.preview.selected"),"loadShareBigBox","share-alt");break;case"downloadFolder":itemActions("downloadFolder",false,"file-zip-o");break;case"downloadItem":itemActions("downloadItem",$("li.preview.selected"),"file-zip-o");break;case"switchListType":var h=$(this),c=h.data("type"),b=(c=="list"?"thumb":"list");$list.removeClass(b).addClass(c);$.cookie("CLO_VT",c);if(c=="list"){$list.find("li.preview").each(function(){var j=$(this),e=j.find("span.vn"),k=j.data();if(e.attr("rel")){e.html(truncToTip($("<span>"),k.t,50,false,k.ftype).html())}})}else{$list.find("li.preview").each(function(){var j=$(this),e=j.find("span.vn"),k=j.data();if(e.attr("rel")){e.html(truncToTip($("<span>"),k.t,22,false,k.ftype).html())}})}break}h.data("clicked",true);setTimeout(function(){h.removeData("clicked")},300)});$uiactControl.on("click","a.uiact",function(){var b=$(this);var a=(parseInt($(window).height())-187);b.data({width:b.data("width")||"70%",height:a});createActionBox("tpage",b,"remoteLoadPage");return false});$body.tooltip({html:true,selector:'[rel=tip]:not(".disabled")',trigger:"hover",container:function(b,a){return($(a).data("container")===undefined)?$body:false},animation:false,placement:function(b,a){return $(a).data("placement")?$(a).data("placement"):popoverautoplacement(b,a,true)},});$body.popover({html:true,selector:'[rel=pop]:not(".disabled")',trigger:"hover",container:function(b,a){return($(a).data("container")===undefined)?$body:false},animation:false,placement:function(b,a){return $(a).data("placement")?$(a).data("placement"):popoverautoplacement(b,a,true)},}).show();$body.on("click","li.preview .tnsocialContainer",function(){var a=$(this).closest("li.preview");loadShareBox(a)}).on("mousleave","li.preview",function(){clearTimeout(hdelay)});$body.on("mousedown",function(a){setTimeout(function(){$(".info-active").find(".unfocusablebtn").each(function(){if(!$(this).is(a.target)&&$(this).has(a.target).length===0&&$(".popover").has(a.target).length===0){$(this).popover("hide")}})},16)});$(".statPull").on("click",function(c){c.preventDefault();c.stopPropagation();hideTip(this);var a=$(this),b=$("#usageStatistics"),d=a.find("i");b.append(a.removeClass("on"));b.slideToggle("fast",function(){$("#usageStatistics").resize();setTimeout(function(){if(b.is(":visible")){b.append(a.removeClass("on"));$("#usageStatistics").unblock()}else{b.after(a.addClass("on"))}d.toggleClass("icon-angle-double-up icon-angle-double-down")},10)})}).click();$sdivider.on("click",function(b,c){var a=$(this);closeSideBar(a,c,false)});$sopener.on("click",function(b,c){var a=$(this);openSideBar(a,c,false)});selectedTemp=[];$list.on("change","input[type=checkbox]:not(:disabled)",function(i,j){var c=$(this),f=$list.find("li.preview").length,b=$list.find("input[type=checkbox]:checked").not(":disabled").length,g=c.closest("li.preview"),h=g.data(),a=h.id;if(c[0].checked){g.addClass("selected");if($.inArray(a,selectedTemp)===-1){selectedTemp.push(a)}if($.inArray(a,selectedItems[dir.id])===-1){selectedItems[dir.id].push(a)}}else{g.removeClass("selected");selectedTemp=jQuery.grep(selectedTemp,function(e,d){return e!==a});selectedItems[dir.id]=jQuery.grep(selectedItems[dir.id],function(e,d){return e!==a})}if(!b){selectedTemp=[];selectedItems[dir.id]=[]}liveSelections(b,f);if(!j){if(selectedTemp.length>0){$.cookie("CLO_IS_"+dir.id,selectedTemp)}else{$.removeCookie("CLO_IS_"+dir.id)}}});$("#checkFiles").on("change",function(){var b=$(this),a=b.prop("checked"),c=$list.find("input[type=checkbox]:not(:disabled)");if(b.prop("indeterminate")){a=true}c.prop("checked",a).trigger("change",["all"]);if(selectedTemp.length>0){$.cookie("CLO_IS_"+dir.id,selectedTemp)}else{$.removeCookie("CLO_IS_"+dir.id)}});$.fn.editableContainer.defaults.placement=popoverautoplacement;if(($.inArray("describe",ui.perms)>-1||$.inArray("rename",ui.perms)>-1)){$list.editable({selector:($.inArray("describe",ui.perms)>-1&&$.inArray("rename",ui.perms)>-1)?"li.preview:not(.error) span.dv, li.preview:not(.error) span.vn":(($.inArray("describe",ui.perms)>-1&&$.inArray("rename",ui.perms)===-1)?"li.preview:not(.error) span.dv":(($.inArray("describe",ui.perms)===-1&&$.inArray("rename",ui.perms)>-1)?"li.preview:not(.error) span.vn":"")),html:true,emptytext:"",placement:popoverautoplacement,title:function(){var a=$(this).closest("li.preview").data("ftype");if($(this).closest("li.preview").data("type")=="d"){a="folder"}return'<i title="'+a+'" class="icon icon-circle '+(filterTypes[a])+'"></i> '+$(this).text()},viewport:"",url:"/",pk:function(){return $(this).closest("li.preview").data("id").match(/\d+/)[0]},params:function(e,b){var c=$(this).closest("li.preview").data();if(!$(this).hasClass("dv")){e.ext=c.realext}e.path=c.ppath;e.parent=c.parent;e.oname=c.t;e.type=c.type;e.action=$(this).hasClass("dv")?"description":"rename";return e},success:function(a){if(a.result){var b=$(this);$parent=b.closest("li.preview");if(b.hasClass("vn")){var c={t:a.newValue,p:a.newpValue}}else{var c={description:a.newValue};if(a.newValue){$parent.find(".tnpreviewDesc").addClass("on").removeClass("empty");setTimeout(function(){$parent.find(".tnpreviewDesc").removeClass("on")},3000)}}$parent.data(c);if(b.data("original-title")){b.attr({"data-original-title":a.newValue})}return{newValue:(a.newValue!==false?a.newValue:"")}}else{return a.message}},}).on("x-editable.shown",function(g,b){var k=b.$element,c=k.closest("li.preview"),h=c.data();if(k.hasClass("vn")){c.addClass("vn");var a=(h.type!="d")?(h.p+((h.realext)?("."+h.realext):"")):h.t;b.input.$input.val(a)}else{c.addClass("dv");var a=(h.description?h.description:""),j=$("<span/>"),i=j.html(a).text(),f=b.input.$input;f.val(i).attr({placeholder:"Modify description of "+h.t});if(k.data("original-title")){k.data("bs.popover").$tip.find("h3.popover-title").html(b.options.title)}if(k.text()==""){k.html(k.data("emptytext"))}}setTimeout(function(){c.addClass("editing")},16)}).on("x-editable.hidden",function(c,b){var a=b.$element;a.closest("li.preview").removeClass("editing dv vn");if(a.text()==a.data("emptytext")){a.html("")}})}$list.on("click","span.editName",function(a){a.stopPropagation();$(this).parent().find("span.vn").trigger("click",true)});$list.on("click","span.edititemDesc",function(a){a.stopPropagation();$(this).parent().find("span.dv").trigger("click",true)});$.contextMenu({selector:"#viewport",className:"dropdown-menu fdropdownActions",build:function(a){var b={items:{refresh:{name:"Refresh",icon:"refresh",callback:function(){reloadPage(1,false,100)},disabled:function(){return currSearch?true:false}},edit:{className:"empty",disabled:function(){return currSearch?true:false}},newdir:{name:"New Folder",icon:"plus",callback:function(){$topActBtns.find('a[data-action="createdir"]').trigger("click")},disabled:function(){return currSearch?true:false}},download:{name:"Download",icon:"cloud-download",callback:function(d,c){itemActions("downloadFolder",false,"file-zip-o")},disabled:function(){return currSearch?true:false}}}};if(cutcopyItems.length&&checkPasteTarget()){b.items.paste={name:"Paste",icon:"paste",callback:function(){$topActBtns.find('button[data-action="pasteItem"]').trigger("click")},disabled:function(){return currSearch?true:false}}}if(dir.id>6){b.items.edit={name:"Edit",icon:"pencil",callback:function(){var d={"data-item":dir.id,"class":"item","data-t":dir.name,"data-parent":dir.parentid,"data-type":"d","data-ondir":true},c=createJElobj(d);itemActions("edit",c,"pencil")},disabled:function(){return currSearch?true:false}}}if(($.inArray("create",ui.perms)===-1)){delete b.items.newdir}if(($.inArray("download",ui.perms)===-1)){delete b.items.download}return b}});$.contextMenu({selector:"li.preview",className:"dropdown-menu fdropdownActions",build:function(a){if(a.hasClass("sharing")||(ui.totalPerm)===0){return false}a.find(".fileMoreButton").blockit({message:$indicator,fadeOut:1,blockMsgClass:"",css:{padding:0},overlayCSS:{opacity:0.9}});var b={events:{show:function(d){var e=$(this);setTimeout(function(){e.find(".fileMoreButton").unblock()},10)},hide:function(d){$(this).find(".fileMoreButton").removeClass("on").unblock()},},callback:function(e,d){$(this).contextMenu("hide");itemActions(e,this,d);return false},items:{open:{name:"Open",icon:"em",className:"bold blue",callback:function(e,d){var f=this;var g={dir:f.find(".item").data("hash"),};if(currFilter){g.filter=currFilter}if(currSearch){g.search=currSearch}$.bbq.pushState(g,2)},},sep5:"---------",addstar:{name:"Add Star",icon:"star",className:"gold",callback:function(e,d){selectItem(this,false);var f=a.data("starred")?false:true;itemActions("addremovestar",$list.find("li.selected"),f)}},shareOp:{name:"Share...",icon:"share-alt",callback:function(e,d){return false},items:{email:{name:"Send via E-mail",icon:"envelope",callback:function(e,d){selectItem(this,false);itemActions("email",$list.find("li.selected"),d)}},share:{name:"Social Share",icon:"hand-o-right",callback:function(e,d){loadShareBox(this)}},sharewith:{name:"Share With",icon:"user-plus",callback:function(e,d){loadShareWithBox(this)}}}},sep3:"---------",download:{name:"Download",icon:"download",callback:function(e,d){downloadSingleItem(this,d)}},archive:{name:"Compress(.zip)",icon:"file-zip-o",callback:function(e,d){selectItem(this,false);itemActions("archiveItem",$list.find("li.selected"),d)}},sep2:"---------",select:{name:"Select/Deselect",icon:"check-square-o",callback:function(e,d){selectItem(this,true)}},sep4:"---------",edit:{className:"empty"},rename:{className:"empty"},cut:{name:"Cut",icon:"cut"},copy:{name:"Copy",icon:"copy"},paste:{className:"empty"},"delete":{name:"Delete",icon:"trash"},sep1:"---------",quit:{name:"Quit",icon:"em"},}};if(a.data("starred")){b.items.addstar.name="Remove Star";b.items.addstar.icon="star-o"}if(a.hasClass("folder")){b.items.edit={name:"Edit",icon:"pencil",className:""};if(checkPasteTarget(a)){b.items.paste={name:"Paste",icon:"paste",className:"",disabled:function(e,d){return !checkPasteTarget(a)}}}}else{if(a.data("viewable")){b.items.open={name:"Preview",icon:"eye",callback:function(e,d){a.find(".vpsve").trigger("click")}}}else{delete b.items.open}b.items.rename={name:"Rename",icon:"pencil",className:"",callback:function(e,d){setTimeout(function(){a.find("span.vn").trigger("click",true)},150)}};if(a.data("ext")=="zip"){b.items.archive={name:"Extract to",icon:"file-zip-o",callback:function(e,d){itemActions("extractItem",this,d)}}}}console.log(a.data());if(currSearch||currFilter){var c=(a.hasClass("folder")?"folder":"file");b.items={filelocation:{name:"Open "+c+" location",icon:"mail-forward",callback:function(e,d){var f={dir:a.data("dirhash")};lookfor=a.data("id");$.bbq.pushState(f,2)}}}}if(($.inArray("download",ui.perms)===-1)){delete b.items.download}if(($.inArray("share",ui.perms)===-1)){delete b.items.shareOp.items.share}if(($.inArray("compress",ui.perms)===-1)){delete b.items.archive;delete b.items.sep2}if(($.inArray("delete",ui.perms)===-1)){delete b.items["delete"]}if(($.inArray("email",ui.perms)===-1)){delete b.items.shareOp.items.email}if(($.inArray("move",ui.perms)===-1)){delete b.items.cut}if(($.inArray("copy",ui.perms)===-1)){delete b.items.copy}if(($.inArray("copy",ui.perms)===-1)&&($.inArray("move",ui.perms)===-1)){delete b.items.paste}if(($.inArray("rename",ui.perms)===-1)){delete b.items.rename}if(($.inArray("rename",ui.perms)===-1)&&($.inArray("describe",ui.perms)===-1)){delete b.items.edit}return b}});$body.on("click",".fileMoreButton",function(b){var a=$(this),c=a.offset(),d=a.closest("li.preview");d.contextMenu({x:c.left-1,y:c.top+a.height()+3});a.addClass("on")});$sideBarStaticTree.find(".filter").on("click",function(b){var a=$(this).attr("rel").replace(/^#/,"");toggleStaticFilterButtonStates(b.target);loadMore=false;$.bbq.pushState({dir:dir.hash,filter:a});return false});$sideBarStaticTree.find("#filter_current_dir").on("change",function(){var a=$(this);if(a.is(":checked")){$.cookie("CLO_DP","1")}else{$.removeCookie("CLO_DP")}if(currFilter){reloadPage(1,false,400)}});$sideBarStaticTree.find("#filter_current_dir").prop(":checked",$.cookie("CLO_DP")).trigger("change");$sideBarStaticTree.find("button.resetFilter").on("click",function(b){hideTip(this);toggleStaticFilterButtonStates(false);var a={dir:dir.hash};if(currSearch){a.search=currSearch}$.bbq.pushState(a,2);$(window).resize()});setTimeout(function(){if(!isMob()&&!isTablet()){sidebarStatistics()}$("#usageStatistics").find(" .chartContainer").on("click",function(){createActionBox("statistics",$(this),"createStatistics","bar-chart-o")})},1000);$itemPaste.on("click","a.clearcutocopyItem",function(){cutcopyItems=[];cutCopyItemList()});$itemPaste.on("click","i.cutitemdismiss",function(){var a=$(this).closest("li"),c=a.data("id"),b=$list.findItem(cutcopyItems[c].id,"selected");b.removeClass("cut copy");selectItem(b,true);cutcopyItems=jQuery.grep(cutcopyItems,function(e,d){return d!==c});a.remove();cutCopyItemList(false);return false});$body.on("click","span.qplayMedia",function(h){h.preventDefault();h.stopPropagation();var j=$(this),i=j.clone(true),k=j.data("currentTime")||0,l=j.closest("li.preview"),c=l.find("div.vpsve"),d=l.find(".tnpreviewBottomBar"),g=l.data(),f=c.width(),b=c.height(),b=(g.ftype=="video"?('width="'+(f)+'" height="'+(b)+'"'):""),a=CLO_URL+"/"+UIDIR+((g.path!="/")?(g.path+"/"):g.path)+g.t,n=$("<"+g.ftype+' src="'+a+'" '+b+">");var m=checkhead(l.find(g.ftype).attr("src"));hideTip(this);if(m==200){if($list.hasClass("list")&&g.ftype=="video"){l.data("playState",true);c.trigger("click");return}j.replaceWith(n);l.find(g.ftype).mediaelementplayer({audioWidth:f,audioHeight:42,defaultVideoWidth:f,defaultVideoHeight:b,videoWidth:f,videoHeight:b,enableAutosize:true,plugins:["flash","silverlight"],pluginPath:ASSURI+"player/",flashName:"player.swf",features:["playpause","progress","fullscreen"],success:function(p){p.addEventListener("play",function(){l.data("playState",true);l.find(".mejs-time-rail").show();mediaPlaying=p},true);p.addEventListener("pause",function(){l.data("playState",false);mediaPlaying=false},true);if(g.currentTime){var o=g.currentTime,e=false;p.addEventListener("loadedmetadata",function(q){if(!e&&o>0){p.setCurrentTime(o);e=true}},false)}p.play()},error:function(){appendMediaError(l,m)}});setTimeout(function(){l.find(".mejs-fullscreen-button").find("button").off("click");l.find(".mejs-fullscreen-button").off("click").click(function(q){q.preventDefault();q.stopPropagation();var o=l.find(g.ftype)[0].player,p=o.getCurrentTime();l.data("currentTime",p);c.trigger("click");o.remove();d.append(i);d.find("video").remove();return false})},17);return false}else{appendMediaError(l,m)}});$(".filesHeading").find(".link").on("click",function(){var c=$(this),b=c.closest(".fheading"),a=c.data();if(c.closest(".fheading").hasClass("up")){$(".fheading").removeClass("down").removeClass("up");setTimeout(function(){c.closest(".fheading").addClass("down")},17);sortUpdate=sortUpdateMore=true;orderby=b.data("order");sortby="asc"}else{$(".fheading").removeClass("down").removeClass("up");sortUpdate=true;orderby=b.data("order");sortby="desc";setTimeout(function(){c.closest(".fheading").addClass("up")},17)}if(orderby=="none"){return}doPageLoad(false,{page:"list",dir:currDir,path:dir.path,p:dir.id+","+dir.parentid,filter:currFilter,search:currSearch,order:orderby,sort:sortby},false)});$dirNav.on("click","a.parentN",function(){var c=$(this).data("state");var a=$dirTree.fancytree("getTree"),b=a.getNodeByKey(dir.parentid.toString()),c={dir:b.data.hash};if(currFilter){c.filter=currFilter}if(currSearch){c.search=currSearch}$.bbq.pushState(c)});$list.on("click","li.preview:not(.tobeUploaded, .uploading) .octet",function(){var a=$(this).closest("li.preview");downloadSingleItem(a,false)});$("#usageStatistics").on("resize",function(){$("#usageStatistics").blockit({message:indicatorCssPurple,fadeOut:1,blockMsgClass:"",css:{top:"2px",left:"2px",padding:0},overlayCSS:{opacity:0.9}})});$.fn.modal.defaults.maxHeight=function(){return $(window).height()-165}});function appendMediaError(a,c){var b="";switch(c){case 404:b='<div style="position: absolute; bottom: 10px; left: 0; right: 0; font-size: 10px; color: white; text-align: center">Sorry the media that you are trying to play cannot be found on the server.</div>';a.find(".download").empty();break;default:b='<div style="position: absolute; bottom: 10px; left: 0; right: 0; font-size: 10px; color: white; text-align: center">Your browser does not support to play this kind of media.</div>'}a.find(".download").prepend(b)}function checkhead(d,c){var a=c?c:200,b=jQuery.ajax({type:"HEAD",url:d,async:false});return a}function downloadSingleItem(b,a){if(selectedItems[dir.id].length>0){$list.find("li.selected").not(this).each(function(){var d=$(this);selectItem(d.find("input[type=checkbox]:not(:disabled)"),true);d.find("input[type=checkbox]:not(:disabled)").prop("checked",false).trigger("change")})}var c=b;setTimeout(function(){selectItem(c,false);var d=$(c);if($list.find("li.selected").length>1||d.hasClass("folder")){d=$list.find("li.selected")}itemActions("downloadItem",d,(a?a:false))},50)}function resetSort(){$(".fheading").removeClass("up").removeClass("down");setTimeout(function(){$(".filesHeading").find(".filetypes").addClass("down")},17)}function sidebarStatistics(a){$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:{action:"user_stat"},success:function(b){userDiskUsageDonut(b);userFileTypesDonut(b);uSt=b;if(a){window[a]()}}})}function closeSideBar(c,e){hideTip(c);var b=($(window).width()<768?true:false);var a=(e?e:440);$sidebar.hide("slide",{direction:"left"},a,function(){$sopener.addClass("on").removeClass("off");$.cookie("CLO_SBAR","off")});if(!b){$wrap.stop().animate({"margin-left":"0"},a,function(){console.log("wrap animated to margin-left: 0");viewport()});$footer.stop().animate({left:"0"},a)}else{viewport()}$body.addClass("sidebar-off").removeClass("sidebar-on");$footer.addClass("up").removeClass("down")}function openSideBar(c,e){$("#usageStatistics").resize();var b=($(window).width()<768?true:false);hideTip(c);var a=(e?e:440);c.addClass("off").removeClass("on");$sidebar.removeClass("hidden-xs").show("slide",{direction:"left"},a);if(b){viewport();dirTreeScr()}else{$.cookie("CLO_SBAR","on");$wrap.stop().animate({"margin-left":251},a,function(){console.log("wrap animated to margin-left: 250");viewport();dirTreeScr()});$footer.stop().animate({left:255},a)}$body.addClass("sidebar-on").removeClass("sidebar-off");$footer.addClass("down").removeClass("up")}function toggleStaticFilterButtonStates(b){var a=$sideBarStaticTree.find(".filter");a.removeClass("active");if(b){var c=a.filter(b);c.addClass("active");$("#sidebarTabContainer").find("li.active a > i").prop("class","icon icon-circle").addClass(c.data("color"))}}function userFileTypesDonut(d){var c=d.percent_types,b=[];var b=[{label:"Image",value:d.count_image_types},{label:"Video",value:d.count_video_types},{label:"Audio",value:d.count_audio_types},{label:"Document",value:d.count_document_types},{label:"Other",value:d.count_other_types},{label:"Folder",value:d.count_dirs},];var a=["#68217A","#F25022","#0072C6","#8AC53E","#FFB900","#EAEAEA"];createDonut("typesCountDonut",b,function(e,f){return e+(f.label=="Folder"?" folder":" file")},5,a)}function userDiskUsageDonut(b){var a=[{label:b.space_used_percentage+"% In use",value:b.space_used_percentage,size:b.space_used_formatted},{label:b.space_free_percentage+"% Free",value:b.space_free_percentage,size:b.space_free_formatted}];createDonut("diskSpaceUseDonut",a,function(c,d){return d.size},1,["#E73D0D","#3075DD"]);if(b.error){$("#diskSpaceUseDonut").attr({title:b.error.title,"data-content":b.error.content,rel:"pop"})}}function createDonut(d,e,c,b,a){Morris.Donut({element:d,data:e,labelColor:"#3E4855",formatter:c,colors:a,resize:true}).select(b)}function renderSideBar(e,f){var b=$dirTree.data("uiFancytree")||0;if(b&&f){$dirTree.fancytree("option","source",e.folderTree)}if(!b){$dirTree.fancytree({source:e.folderTree,debugLevel:0,selectMode:4,clickFolderMode:4,autoCollapse:true,keyboard:true,minExpandLevel:2,extensions:["dnd","filter","childcounter","glyph"],glyph:{map:{error:"icon icon-exclamation-sign",expanderClosed:"icon icon-caret-right",expanderOpen:"icon icon-caret-down",folder:"icon icon-folder",folderActive:"icon icon-folder-o",folderOpen:"icon icon-folder-open",loading:"icon icon-refresh icon-spin"}},click:function(h,j){var g=j.node,k=g.data;if(dir.hash!=k.hash){var i={dir:k.hash};if(currFilter){$.extend(true,i,{filter:currFilter})}if(currSearch){$.extend(true,i,{search:currSearch})}setTimeout(function(){$.bbq.pushState(i,2)},17)}},dnd:{preventVoidMoves:true,preventRecursiveMoves:true,autoExpandMS:400,dragStart:function(g,h){return true},dragEnter:function(g,h){if(g.key==1){return false}if(g.data.parent==h.otherNode.data.parent){return["over"]}return true},dragDrop:function(g,i){var m=g.data,l=((i.hitMode=="before"||i.hitMode=="after")?g.data.parent:i.node.key),k=((i.hitMode=="before"||i.hitMode=="after")?i.otherNode.data.parent_path:i.otherNode.data.parent_path),j=((i.hitMode=="before"||i.hitMode=="after")?g.data.parent_path:g.data.path);if(l==i.otherNode.data.parent){return false}var h={value:"d_"+i.otherNode.key,dir:"d_"+l,path:j,cdir:"d_"+i.otherNode.data.parent,cpath:k,};qDirActions("move",g,h);forceUpdate=true;var n=((i.hitMode=="before"||i.hitMode=="after")?g.data.phash:g.data.hash);$.bbq.pushState({dir:n},2);if(dir.hash==n){$(window).trigger("hashchange")}i.otherNode.moveTo(g,i.hitMode)}},filter:{mode:(dir.subdirs.count_total>=6)?"hide":"dimm"},childcounter:{deep:true,hideZeros:true,hideExpanded:true}})}if(dir.id>6||dir.id==1){var a=$dirTree.fancytree("getTree"),d=a.getNodeByKey(dir.id.toString()),c=(f?500:17);if(d){d.setActive()}d.renderTitle();if(!d.isExpanded()){setTimeout(function(){d.setExpanded()},c)}}$("#dirTreeFilter").keyup(function(i){var h=$("#dirTreeCtr"),g=$(this).val();if(i&&i.which===$.ui.keyCode.ESCAPE||$.trim(g)===""){h.click();return}var j=a.applyFilter(g);$("#dirTreematches").text(j+" matches ");$("#dirTreeCtr").show()});$("#dirTreeCtr").click(function(g){$("#dirTreeFilter").val("");$("#dirTreematches").text("");$(this).hide();a.clearFilter()})}function truncToTip(d,f,c,a,b){if(!f||typeof f=="undefined"){return""}f=String(f);var e=f.trunc(c,"...");d.text(e);if(f.length>c-3){d.attr({rel:"tip",title:(b?('<i class="icon icon-circle '+filterTypes[(b=="d"?"folder":b)]+'"></i> '):"")+f})}if(a){return $("<div/>").append(d).html()}return d}function clearList(a){var b=($viewPort.data("dir")!=a.dir.id)?5:1;if(b==5&&mediaPlaying){mediaPlaying.pause()}b+=(($viewPort.data("filter")!=currFilter))?5:0;b+=(($viewPort.data("search")!=currSearch))?5:0;b-=(loadMore)?5:0;if(!$.bbq.getState("dir")){b+=11}if(forceUpdate){b+=(forceUpdate?11:1);forceUpdate=false}if(sortUpdate){b+=(sortUpdate?11:1);sortUpdate=false}if(b>=5){$list.empty()}}function setElData(a,b){$.each(b,function(d,c){if(c){a.data(d,c)}});return a}function createDomItem(a){var b=$(tmpl("item-tpl",{files:[a]}));return setElData(b,a.data)}(function(a){a.renderListPage=function(d,e){var c=(forceUpdate&&!firstLoad)?true:false;var i=[];clearList(d);a("#checkFiles").prop("indeterminate",false).prop("checked",false);if(d.items.length){a.each(d.items,function(l,j){var o=[];if(j.preview!="canvas"&&c&&j.type!="folder"){j.preview=j.preview+"?f="+(a.now())}if(currSearch&&dir.id==1){j.noaction=(currSearch&&dir.id==1)?true:false}var p=createDomItem(j);if(checkItemCheckedStatus(j.data.id)){p.find("input[type=checkbox]:not(:disabled)").not(":checked").prop("checked",true)}if(j.type=="folder"){if(j.thumbs&&a(window).width()>767){var n=a('<span class="tnimpreview"></span>'),m=0;a.each(j.thumbs,function(q,r){n.append('<img src="'+r.src+'">');m++});p.addClass("tnim"+m).find(".tnpreviewImageContainer").prepend(n)}if(j.bsize==0){p.addClass("empty")}p.data("thumbs",j.thumbs)}if(j.filetype=="image"){p.find(".tnpreviewImageContainer").append(a((isMob())?indicatorCss:indicatorCssPurple).css({position:"absolute",top:"50%",left:"50%","margin-left":"-39px","margin-top":"-25px"}));var k=a("<img/>").attr("src",j.preview).css("display","none");p.find(".tnpreviewImageContainer").append(k);imagesLoaded(p.find(".tnpreviewImageContainer"),function(q,r){p.find(".tnpreviewImageContainer").find(".indicator").remove();p.find(".tnpreviewImageContainer").removeClass("done").find("img").remove().detach()}).on("fail",function(q){p.find(".tnpreviewImageContainer").find(".indicator").remove();p.find(".tnpreviewImageContainer").find(".tnpreviewImage").append('<span class="bno tacent" style="position: absolute; height: 100%; width: 100%; left:0; line-height: 4;">No preview is available!</span>');p.addClass("error")})}fileInfoBtn(p);$list.append(p)});if($list.findItem(lookfor,"preview").length>0){$list.findItem(lookfor,"preview").addClass("highlight")}var h=$list.find("li").eq(0).width(),b=Math.floor(parseInt($list.width())/parseInt(h));$list.find("li").eq(b-1).find(".tnFilename .vn").data("placement","bottom");$list.find("li").eq(0).find(".tnFilename .vn").data("placement","right");$list.find("li").eq(0).find(".tnFilename .vn").on("shown.bs.popover",function(){$list.find("li").eq(0).find(".popover").css("top",parseInt(a(".popover").css("top"))+22+"px")});$list.find(".tnpreviewImageContainer");a(".vpsve").vobox();emptyDirectory(true)}else{emptyDirectory();liveSelections(0,0)}$list.find("input[type=checkbox]:not(:disabled)").trigger("change");if((a.inArray("describe",ui.perms)===-1)){$viewPort.find("li.preview").not(".rendered").addClass("noDescribe")}if((a.inArray("share",ui.perms)>-1)){$viewPort.find("li.preview").not(".rendered").each(function(){var k=a(this),j=k.data();k.addClass("rendered").find(".tnpreviewBottomBar .bright").append('<div class="tnsocialContainer hidden-xs btn-white"><span class=""><i class="icon icon-share-alt"></i> Share</span></div>')})}if(checkPasteTarget()){$itemPaste.find("button:first").disabletoggle(false)}else{$itemPaste.find("button:first").disabletoggle(true)}if(a.cookie("CLO_VT")&&firstLoad){var g=a.cookie("CLO_VT");a("#switchListType").find('label[data-type="'+g+'"]').click()}updateItemsTotalText(loadMore);firstLoad=false;if(loadMore){a("#loadAllItems").addClass("active")}else{a("#loadAllItems").removeClass("active")}$viewPort.data("dir",currDirID);$viewPort.data("filter",currFilter);$viewPort.data("search",currSearch);loadMore=false;a("#moreItemLoader").hide();if($viewPort.data("contextMenu")){$viewPort.contextMenu("hide")}setPageTitle((currSearch?("search: "+decodeURIComponent(currSearch)):currFilter));setPageNumber();if(dir.page===1){breadCrumb((currSearch?("search: "+decodeURIComponent(currSearch)):currFilter))}if(dir.scrollMore){$screl.trigger("scroll")}if(currSearch){var f=$searcher.addClass("on").find("#search");a("#search").focus().typeahead("val",decodeURIComponent(currSearch));$list.addClass("listdown");a("#checkFiles").prop("disabled",true)}else{$searcher.removeClass("on").find("#search").typeahead("val","").blur();$list.removeClass("listdown");a("#checkFiles").prop("disabled",false)}a.removeCookie("CLO_HG")}})(jQuery);function fileInfoBtn(b){var a="";b.find("button.fileInfoButton").popover({html:true,trigger:"manual",content:function(e,c){var f=b.data();a=$(tmpl("itemInfo",f));return a},container:function(d,c){return($(c).data("container")===undefined)?$body:false},animation:false,placement:function(d,c){$(d).addClass("infoTable");return $(c).data("placement")?$(c).data("placement"):popoverautoplacement(d,c,false)},viewport:"#list"}).on("show.bs.popover",function(e){var c=$(e.target).closest("li");$container.find(".infoTable").popover("hide")}).on("shown.bs.popover",function(e){var c=$(e.target).closest("li");c.addClass("context-active info-active");$container.data("unfocusable",true)}).on("hidden.bs.popover",function(e){var c=$(e.target).closest("li");c.removeClass("context-active info-active");$container.removeData("unfocusable")}).on("click",function(c){$(this).popover("toggle")})}function breadCrumb(b){var f=$dirNav.find("a.parentN").first(),d=f.next("a");f.show();if(dir.id!=1){f.find("span").html(truncToTip($("<b/>"),dir.parentname,30,true)+' <i class="icon icon-angle-right"></i>')}else{f.hide()}d.show().addClass("disabled").find("span").html(truncToTip($('<u class="uld arr"/>'),dir.name,30,true));if(b){var a=$('<button href="javascript:;" class="close icon icon-times-circle small mt10" data-aria="hidden"></button>').on("click",function(){if(currFilter){$sideBarStaticTree.find("button.resetFilter").trigger("click")}else{var h={dir:$.bbq.getState("dir")};$.bbq.pushState(h,2)}});d.find("i.fltr").html(' <i class="icon icon-filter"></i> '+decodeURIComponent(b)).append(a)}else{d.find("i.fltr").html("")}var g=d.position(),c=d.width(),e={left:g.left+36+c/2,top:g.top};$wrap.data("nofilepos",e)}function emptyDirectory(a){$wrap.find(".empty-directory").hide();setTimeout(function(){var d=$wrap.find(".empty-directory");if(a){$(".edis").unblock();$searcher.show();$dirNav.find(".uld").addClass("arr");return d.detach().remove()}if(d.length){d.detach().remove()}var e='Empty folder!<span class="hidden-xs"> Add some goods...</span>';if(currFilter){e="No "+(currFilter=="folder"?"folders":(currFilter=="file"?"files":(currFilter+" files ")))+" in this directory"}var c='<div id="dragboxnot" class="hidden-xs" style="border: 4px dashed #ddd; text-align: center; position: relative; top: 20px; margin-left: 0px; min-height: 200px;"><h1 style="line-height: 200px; color: #ddd">Drop your files to upload</h1></div>';var b=$('<div class="empty-directory"><h2>'+e+"</h2>"+c+"</div>");if(isMob()&&$(window).width()<768){b.css("top",$wrap.data("nofilepos").top-5)}$viewPort.append(b.css("left",$wrap.data("nofilepos").left));$itemPaste.find("a.clearcutocopyItem").click("click");$(".edis").block({message:false,overlayCSS:{backgroundColor:"#fff",opacity:0.1,cursor:"not-allowed"}});$searcher.hide();$dirNav.find(".uld").removeClass("arr");d.show()},16)}function setPageNumber(){var a=$("#pageNumber"),b=a.find("div.helper");a.find("div.badge").text("Page "+dir.page);if(!touchable){b.removeClass("touch")}if(dir.scrollMore){b.show()}else{b.hide()}}function setPageTitle(a){var b=SITENAME+" "+ui.name+" "+dir.pageTitle;if(a){b+=" ≈ "+a}$(document).attr("title",b)}function updateItemsTotalText(h,k,i){var a=$totalItemsNum.find(".files"),l=$totalItemsNum.find(".dirs");var j=l.data("loaded"),c=a.data("loaded"),b=$totalItemsNum.find("span.loaded").text();var d=dir.scrollMore?dir.scrollMore:dir.totalitems;var e=$totalItemsNum.find("span.total"),f=$totalItemsNum.find("span.loaded"),g=e.text(),m=dir.totalitems;if(k){if((!currFilter||$viewPort.data("filter")==i)){m+=k;d+=k}}f.animateNumber(b,d);e.animateNumber(g,m)}function checkItemCheckedStatus(b){var c=((selectedItems[dir.id].length)?selectedItems[dir.id]:false)||$.cookie("CLO_IS_"+dir.id)||false;var a=c?(($.isArray(c))?c:c.split(",")):false;if(a&&a.length){if(jQuery.inArray(b,a)>-1){return true}}return false}function googlePluspOK(){console.log("googlePlusOK")}function selectItem(b,a){b.each(function(){var d=$(this).find("input[type=checkbox]:not(:disabled)"),c=a?(a=="unchk"?false:!d.is(":checked")):true;d.prop("checked",c).trigger("change").change()})}function cutCopyItemList(d,g){var a=$itemPaste.find("ul.scr"),e=cutcopyItems.length,h=$itemPaste.find("span.badge"),f=$itemPaste.find("div.ccinfo");if(e){$itemPaste.removeClass("dn");a.empty();var b="";$.each(cutcopyItems,function(j,i){if(!$itemPaste.find('li[data-id="'+j+'"]').length){b+='<li role="presentation" data-id="'+j+'" class="item"><i title="'+i.ftype+'" class="icon icon-circle '+filterTypes[i.ftype]+'"></i> '+i.name+'<i class="icon icon-times cutitemdismiss" title="Ignore this one"></i></li>'}});a.append(b);h.removeClass("animated shake").text(e);setTimeout(function(){h.addClass("animated shake")},200);if(d){f.text("("+d+" from "+g+")")}}else{a.empty();$itemPaste.addClass("dn");$notify.jGrowl("close");var c=$list.find("li.preview");selectItem(c,"unchk");c.removeClass("cut copy")}}function checkPasteTarget(b){if(cutcopyItems.length===0){return false}var c=(b?parseInt(b.data("id").match(/\d+/)):dir.id),a=(c!=cutcopyItems[0].parent)?1:0;if(a){$.each(cutcopyItems,function(h,f){var e=parseInt(f.id.match(/\d+/)),j=b?c:dir.id,d=$dirTree.fancytree("getTree"),i=d.getNodeByKey(j.toString()),g=d.getNodeByKey(e.toString());if(e==j||i.isDescendantOf(g)){a=false;return false}});return a}else{return false}return true}function itemActions(s,A,a,r){switch(s){case"select":break;case"create":createActionBox(s,A,"loadFolderEdit","plus");break;case"edit":createActionBox(s,A,"loadFolderEdit","pencil");break;case"copy":case"cut":cutcopyItems=[];var D=false,k="copied",h=A.eq(0).data("t").trunc(17,"...");if(s=="cut"){D=true;k="cut"}if($list.find("li.selected").length>1){selectItem(A,false);A=$list.find("li.selected")}else{selectItem($list.find("li.selected"),"unchk")}$.each(A,function(d,t){var q=$(t),p=q.data(),i=q.hasClass("folder")?"d":"f";cutcopyItems.push({id:p.id,name:p.t,parent:p.parent,type:i,path:p.path,ftype:(i=="d"?"folder":p.ftype),remove:D});$("li.preview").removeClass("cut copy");setTimeout(function(){if(s=="cut"){q.addClass("cut")}else{q.addClass("copy")}},17);selectItem(q,false)});cutCopyItemList(k,dir.name);if(A.length>1){var x=A.length-1,w=A.eq(0).data("t"),C=A.eq(0).hasClass("folder")?"Folder":"File",y=" and other <i>"+x+"</i> item(s)",h=w.trunc(17,"...")+y}$notify.jGrowl("close").jGrowl('<div class="icon icon-'+s+'"></div> Now paste it where you want.',{header:h+" was "+k+"!",sticky:true,theme:"iconup"});break;case"paste":var c=[],s="copy",k="Copying",E=$(A).data()||false;$.each(cutcopyItems,function(i,d){c.push(d.id);if(d.remove){s="move";k="Moving"}});var m={value:c.join(","),dir:((r)?dir.id:E.id),path:((r)?dir.path:E.path),cdir:cutcopyItems[0].parent,cpath:(cutcopyItems[0].type=="d")?(cutcopyItems[0].path).substring(0,(cutcopyItems[0].path).lastIndexOf("/")+1):cutcopyItems[0].path,};$notify.jGrowl("close").jGrowl('<div class="icon icon-copy animated zoomOutLeft loop"></div>'+k+" selected item(s)...",{header:"In progress",sticky:true,theme:"iconup"});qDirActions(s,false,m,function(){cutcopyItems=[];cutCopyItemList();reloadPage(1,false,400)});break;case"move":break;case"delete":if($list.find("li.selected").length>1){selectItem(A,false);A=$list.find("li.selected")}var E={"data-item":"","data-type":"","data-t":""},u=[],j=[],g=[],n=[];$.each(A,function(i,q){var p=$(this),t=$(this).data();u.push(t.id);j.push(t.type);g.push(t.t);n.push(p)});E["data-item"]=u.join(",");E["data-type"]=j.join(",");E["data-t"]=g.join(",");var b=createJElobj(E).data({preview:n,count:A.length});createActionBox(s,b,"deleteItemDismiss","trash-o");b.remove();break;case"email":var E={"data-item":"","data-type":"","data-t":"","data-width":"45%","data-height":$(window).height()-165},u=[],j=[],g=[],n=[];$.each(A,function(i,q){var p=$(this),t=$(this).data();u.push(t.id);j.push(t.type);g.push(t.t);n.push(p)});E["data-item"]=u.join(",");E["data-type"]=j.join(",");E["data-t"]=g.join(",");var b=createJElobj(E).data({preview:n,count:A.length});createActionBox(s,b,"loadEmailShare","envelope-o");break;case"shareItem":var E={"data-item":"","data-type":"","data-t":"",},u=[],j=[],g=[],n=[];$.each(A,function(i,q){var p=$(this),t=$(this).data();u.push(t.id);j.push(t.type);g.push(t.t);n.push(p)});E["data-item"]=u.join(",");E["data-type"]=j.join(",");E["data-t"]=g.join(",");var b=createJElobj(E).data({preview:n,count:A.length});createActionBox("share",b,"loadShareBigBox","share-alt");break;case"downloadFolder":var E={"data-path":dir.path,"data-value":dir.id+" ","data-diro":true,"data-name":dir.name},A=createJElobj(E);downloadItems={path:dir.path,value:dir.id+" "};createActionBox("downloadFolder",A,"calculateDownloadSize","file-zip-o");break;case"downloadItem":var E={"data-path":[],"data-value":[],"data-diro":false,"data-count":A.length,"data-name":"","data-type":""},z="";downloadItems={path:[],value:[],count:0};$.each(A,function(d,i){z=$(this).data(),tps=((z.path=="/")?"":"/"),pth=z.path+tps+($(this).hasClass("file")?z.t:"");E["data-path"].push(pth);E["data-value"].push(z.id);E["data-name"]=z.t;E["data-type"]=($(this).hasClass("file")?"f":"d");downloadItems.path.push(pth);downloadItems.value.push(z.id);downloadItems.count=E["data-count"]});if(E["data-count"]==1&&E["data-type"]=="f"){E["data-ftype"]=z.ftype}else{E["data-ftype"]="d"}var B=(A.length>1||(A.eq(0).hasClass("folder")))?"downloadItems":"downloadItem",f=(A.length>1||(A.eq(0).hasClass("folder")))?"calculateDownloadSize":"prepareDownload",o=(A.length>1||(A.eq(0).hasClass("folder")))?"file-zip-o":"cloud-download";var A=createJElobj(E);createActionBox(B,A,f,o);break;case"archiveItem":var E={"data-path":[],"data-value":[],"data-diro":false,"data-count":A.length,"data-name":"","data-type":""},z="";archiveItems={path:[],value:[],parent:[]};$.each(A,function(i,q){var v=$(this).data(),p=((v.path=="/")?"":"/"),t=v.path+p+($(this).hasClass("file")?v.t:"");E["data-path"].push(t);E["data-value"].push(v.id);E["data-name"]=v.t;E["data-type"]=($(this).hasClass("file")?"f":"d");archiveItems.path.push(t);archiveItems.value.push(v.id);archiveItems.parent.push(v.parent)});if(E["data-count"]==1&&E["data-type"]=="f"){E["data-ftype"]=z.ftype}else{E["data-ftype"]="d"}var A=createJElobj(E);createActionBox("archiveItem",A,"calculateArchiveSize","file-zip-o");break;case"extractItem":A.data({width:"480",height:$(window).height()-110});createActionBox("extractItem",A,"loadExtractDirectories","file-zip-o");break;case"addremovestar":var l=[],e=[];$.each(A,function(i,p){var q=$(this).data();l.push(q.id);e.push($(this))});addRemoveStar($(e),l,a);break}return false}function addRemoveStar(d,a,c){var b={action:"addremovestar",value:a,add:c};$indicatorEl.css("visibility","visible");$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",data:b,success:function(e){$indicatorEl.css("visibility","hidden");selectItem(d,"unchk");reloadPage(1,false,200)}})}var sselected=[];var sselect=function(a){sselected.push(a.attrs.value)};var sunselect=function(a){removeVal(sselected,a.attrs.value)};var sfilter=function(a){return $.grep(a,function(b){return $.inArray(b.value,sselected)===-1})};var esuggest=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:AJAX_PATH+"?userdata=email&q=%QUERY",type:"GET",dataType:"json"}});esuggest.initialize();function loadEmailShare(e,c,a,d){sselected=[];var b=d.find(".editor");makeSmallEditor(b,d);$(".ignoretitem").one("click",function(){var j=$(this).closest("div.thumbnail"),k=j.data("id"),i=a.find('input[name="value"]'),g=d.find(".box_title .count");i.val(removeVal(i.val(),k));selectedItems[dir.id]=jQuery.grep(selectedItems[dir.id],function(m,l){return m!==k});var f=$list.findItem(k,"selected");selectItem(f,true);var h=selectedItems[dir.id].length;if(h===0){d.modal("hide")}g.text(h);hideTip(j[0]);j.remove()}).closest("div.thumbnail").on("touchend",function(){$(this).find(".close").trigger("click")});setTimeout(function(){$(".emailsuggestion").on("tagfield:initialize",function(){setTimeout(function(){a.find(".tt-input").focus();console.log("focused")},150)}).on("tagfield:createtoken",function(i){var f=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var g=f.test(i.attrs.value);if(!g){return false}else{var h=i.attrs.value.split("|");i.attrs.value=h[1]||h[0];i.attrs.label=h[1]?h[0]+" ("+h[1]+")":h[0]}}).on("tagfield:edittoken",function(g){if(g.attrs.label!==g.attrs.value){var f=g.attrs.label.split(" (");g.attrs.value=f[0]+"|"+g.attrs.value}}).on("tagfield:removedtoken",function(f){if(a.find("div.token").length==0){d.find("a.go").disabletoggle(true)}sunselect(f)}).on("tagfield:createdtoken",function(f){if(a.find("div.token").length>0){d.find("a.go").disabletoggle(false)}sselect(f)}).tagfield({typeahead:[null,{source:function(g,f){esuggest.get(g,function(h){f(sfilter(h))})},hint:true,highlight:true,minLength:0}],minWidth:120});a.find("#usemyEmail").on("change",function(){if($(this).is(":checked")){a.find("#sender").val(ui.mail)}else{a.find("#sender").val("")}});a.bootstrapValidator();$(window).resize()},700)}function makeSmallEditor(d,c,b){var a={source:b?true:false,format:false,indent:false,justify:false,sub:false,sup:false,u:false,outdent:false,strike:false,};a.placeholder=d.attr("placeholder");d.veditor(a).veditorVal(b);c.find(".veditor").addClass("form-control p0")}function multiplePreviewCreate(b){var a="";$.each(b,function(d,c){var f=$(this),e=f.data(),g=f.find(".tnpreviewImage").css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,"");if(f.data("type")=="d"){g=THEMEURL+"images/folder.mb.gif"}a+='<div class="thumbnail" data-id="'+e.id+'" data-placement="top" data-container=".modal-body" rel="tip" data-title="'+f.data("t")+'">\n                 <button class="close-button close ignoretitem" type="button" title="Ignore this one">×</button>\n                 <div class="caption">'+f.data("t")+'</div>\n                 <img src="'+g+'">\n                 </div>'});return a}function createActionBox(n,d,i,l,j){var k=$html.hasClass("vobox")?$(".slide.current").find(".om").spin(e,"#fff"):$indicatorEl.css("visibility","visible"),e=$html.hasClass("vobox")?"mid":"main";var p=$("#actionbox").find("div.modal").clone(),m="",g="",u=d.data(),t=false;var w=d.data("title")||0,b=$.isArray(u.type)?u.type.join(","):u.type,f=(b=="d"?"folder":(b=="f"?"file":"item(s)")),x=u.t||"",o=u.description||"",s=n,r=u.icon||false,l=(l?l:r),a=u.p||0,q=d.data("item")?d.data("item"):d.data("id"),v="box_"+n,c=p.find("form"),h=false;if(n!="tpage"){g='<div class="result callout callout-danger dnone vhidden"><div></div></div>'}if(n!="page"){g+='<input class="dnone" type="hidden" name="value" value="'+q+'" />\n                     <input class="dnone" type="hidden" name="filetype" value="'+b+'" />\n                     <input class="dnone" type="hidden" name="path" value="'+((u.ppath?u.ppath:(u.path?u.path:dir.path)))+'" />\n                     <input class="dnone" type="hidden" name="action" value="'+n+'">',labels=((d.data("labels")!==undefined)?d.data("labels").split("_"):""),content=d.data("content")||0}switch(n){case"delete":w="Delete Operation"+(u.count>1?(' - <span class="count">'+u.count+"</span> Item selected"):"");g+="<h5>Are you sure you want to  permanently delete the following "+f+"?</h5>";g+='<div class="ItemPreview">'+(u.preview?multiplePreviewCreate(u.preview):"")+"</div>";g+=$divider;g+="<small>Note: This cannot be undone!</small>";m=$('<a href="" class="btn btn-danger btn-sm go">Delete</a>');g+='<input class="dnone" type="hidden" name="cdir" value="'+dir.id+'" />';t=true;break;case"create":w="Create new folder in <span>"+x+"</span>";g+='<div class="form-group">\n                     <label for="foname">Name</label>\n'+createTextInput("name","foname",false,"Please enter a folder name")+'                     </div>\n                     <div class="form-group">\n                     <label for="fodesc">Description</label>\n'+createTextInput("desc","fodesc","","Please enter a description","textarea")+'\n                     </div>\n                     <div class="form-group">\n                     <label for="fopass_val" rel="tip" data-container="item" data-placement="right" data-title="Prevent direct access to this folder on shared page">Folder Protection: <input id="fopass" name="fopass" type="checkbox" value="'+((a)?"2":"1")+'" class="switch-small"'+(a?" checked":"")+">\n                     </label>\n"+createTextInput("fopass_val","fopass_val",false,((a)?"Leave empty if you don't want to change":"Please specify a password"),"text",((a)?"":"dn"))+'\n                     </div>\n                     <div class="divider mt0 mb0"></div>\n                     <div class="form-group last">\n                     <label for="icon_select" class="col-md-12 col-sm-12 col-xs-12 fltn p0">Folder Icon: <img id="iconpreview" src="'+ASSURI+"img/"+((r)?("icons/"+r):"blank.png")+'">'+(r?'<span id="resetIcon" class="fltrt"><i class="icon icon-times-circle-o"></i> Remove Icon</span>':"")+'</label>\n                     <a href="#" class="icon_select_btn">Click to select <i class="icon icon-caret-down"></i></a>\n                     <div id="icon_select" class="scrollContainer dnone"></div>'+createTextInput("icon","foiconin",r,r,"hidden","col-md-3 fltn ml0")+"\n                     </div>";m=$('<a href="" class="btn btn-primary btn-sm disabled go"><i class="icon icon-check"></i> Create</a>');t=true;break;case"edit":w="Edit folder <span>"+x+"</span>";g+='<div class="form-group">\n                     <label for="foname">Name</label>\n'+createTextInput("name","foname",x,"Specify a "+f+" name",false,"col-md-3 fltn ml0",true,false,($.inArray("rename",ui.perms)===-1))+'\n                     </div>\n                     <div class="form-group">\n                     <label for="fodesc">Description</label>\n'+createTextInput("desc","fodesc",o,"No Description","textarea")+'\n                     </div>\n                     <div class="form-group">\n                     <label for="fopass_val" rel="tip" data-container="item" data-placement="right" data-title="Prevent direct access to this folder on shared page">Folder Protection: <input id="fopass" name="fopass" type="checkbox" value="'+((a)?"2":"1")+'" class="switch-small"'+(a?" checked":"")+"></label>\n"+createTextInput("fopass_val","fopass_val",false,((a)?"Leave empty if you don't want to change":"Please specify a password"),"text",((a)?"":"dn"))+'\n                     </div>\n                     <div class="divider mt0 mb0"></div>\n                     <div class="form-group last">\n                     <label for="icon_select" class="col-md-12 col-sm-12 col-xs-12 fltn p0">Folder Icon: <img id="iconpreview" src="'+ASSURI+"img/"+((r)?("icons/"+r):"blank.png")+'">'+(r?'<span id="resetIcon" class="fltrt"><i class="icon icon-times-circle-o"></i> Remove Icon</span>':"")+'</label>\n                     <a href="#" class="icon_select_btn">Click to select <i class="icon icon-caret-down"></i></a>\n                     <div id="icon_select" class="scrollContainer dnone"></div>'+(u.ondir?createTextInput("ondir","ondir","1","","hidden",""):"")+createTextInput("icon","foiconin",r,r,"hidden","")+createTextInput("oname","oname",x,"","hidden","")+createTextInput("parent","parent",u.parent,"","hidden","")+"\n                     </div>";m=$('<a href="" class="btn btn-primary btn-sm disabled go"><i class="icon icon-save"></i> Save</a>');t=true;break;case"move":d.data("ajax","loadFoldersDropdown");g+='<div class="form-group">\n                     <span>Current Folder: </span><i class="ul">'+$viewPort.find("#breadcrumb li.active a").text()+'</i>\n                     </div>\n                     <div id="fo_dropdownlist" class="form-group row-fluid last">\n                     <label for="folist">Move To</label>\n                     <div class="col-md-11" style="height: 33px;"></div>                     <input class="dnone" type="hidden" name="odir" value="'+dir.id+'" />                     </div>';m=$('<a href="" class="btn btn-primary disabled go"><i class="icon icon-copy"></i> Move</a>');break;case"statistics":w="Statistics";g+='<p class="meterTitle">Disk Usage<span class="free-space">'+uSt.space_free_formatted+" free out of "+uSt.space_total_formatted+"</span></p>";g+='<div id="trs"></div>';g+='<p class="meterTitle">File Types</p>';g+='<div class="uts"></div>';break;case"email":w='Send <b class="small icon icon-circle '+filterTypes[(u.ftype=="d"?"folder":u.ftype)]+'"></b> '+(u.count==1?("<i> "+truncToTip($('<b class="small" data-container="false"/>'),u.t,25,true)+"</i>"):('selected <span class="count">'+u.count+"</span> item(s)"))+" via Email";g+='<div style="min-height: '+u.height+'px">';if(!$html.hasClass("vobox")){g+='<div class="ItemPreview">'+(u.preview?multiplePreviewCreate(u.preview):"")+"</div>";g+=$divider}g+='<div class="form-group emailsuggestContainer" style="min-height: 69px">\n                     <label for="recipient">To <small>(can select multiple e-mail addresses)</small></label>\n'+createTextInput("recipient","recipient",false,"john@example.com","email","emailsuggestion",true)+'                     </div>\n                     <div class="form-group">\n                     <label for="sender">Sender email</label>\n                     <div class="input-group">'+createTextInput("sender","sender",false,"sender email (optional)","email",false,false,false,false,' data-container="#form_email"')+'<label for="usemyEmail" class="input-group-addon">'+createTextInput("usemyEmail","usemyEmail","",false,"checkbox","")+' Use my email                     </label></div>\n                     </div>\n                     <div class="form-group">\n                     <label for="message">Aditional Message</label>\n'+createTextInput("message","message","","Enter aditional message (optional)","textarea","editor")+"\n                     </div>";g+='<div class="form-group last">\n                     <div class="checkbox">\n                     <label for="sendCopy">\n'+createTextInput("sendCopy","sendCopy","",false,"checkbox","")+"\n                     Send a copy to my email address\n                    </label>\n                    </div>\n                    </div>";g+="</div>";m=$('<a href="" class="btn btn-primary btn-sm disabled go"  data-loading-text="Sending..."><i class="icon icon-paper-plane"></i> Send</a>');t=false;break;case"share":w='Share <b class="small icon icon-circle '+filterTypes[(u.ftype=="d"?"folder":u.ftype)]+'"></b> '+(u.count==1?("<i> "+truncToTip($('<b class="small" data-container="false"/>'),u.t,25,true)+"</i>"):('selected <span class="count">'+u.count+"</span> item(s)"));if(!$html.hasClass("vobox")){g+='<div class="ItemPreview">'+(u.preview?multiplePreviewCreate(u.preview):"")+"</div>";g+=$divider}g+='<div id="share_url" class="input-group sharing vh" style="position: relative">\n                    <span class="input-group-btn"><button id="copy-share-url-btn" type="button" class="btn btn-default" data-clipboard-target="share_short_url" title="Copy link to clipboard" rel="tip" data-container="item" data-placement="top">Copy <i class="icon icon-clipboard"></i></button></span>'+createTextInput("share_short_url","share_short_url","","Short link","text","unselectable",false,false,true)+'\n                     <span class="input-group-btn"><a href="#" target="_blank" id="go-share-url-btn" class="btn btn-default" title="Open link in a new tab" rel="tip" data-container="item" data-placement="top"><i class="icon icon-external-link"></i></a></span>\n                     </div><div id="copy-to-clipboard-result" class="callout callout-success-alt clearfix dn"></div>';g+='<div class="divider"></div><div id="share_box" class="sharing" style="position: relative">\n                     </div>';m=false;break;case"downloadFolder":w="Download <i>"+truncToTip($('<b class="small" data-container="false"/>'),u.name,25,true)+"</i> as .zip";g+='<div class="form-group tacent tbs">\n                     <div id="total_size_down">Approximate unpacked size: <strong></strong></div>\n                     </div>';g+='<div id="down_box" class="form-group">\n                     <button data-loading-text=\''+$indicatorbg+' creating zip archive...\' id="downloadBtn" type="button" class="btn btn-lg btn-primary-alt btn-block">\n                     <i class="icon icon-cloud-download"></i> Download</button>\n                     <label>Also save zip file: <input id="saveZip" name="saveZip" type="checkbox" value="1" checked>\n                     </label>\n                     </div>';m=false;break;case"downloadItems":w='Download <b class="small icon icon-circle '+filterTypes[(u.type=="d"?"folder":u.ftype)]+'"></b> '+(u.count==1?("<i> "+truncToTip($('<b class="small" data-container="false"/>'),u.name,25,true)+"</i>"):("selected "+u.count+" item(s)"))+" as .zip";g+='<div class="form-group tacent tbs">\n                     <div id="total_size_down">Approximate unpacked size: <strong></strong></div>\n                     </div>';g+='<div id="down_box" class="form-group row-fluid">\n                     <button data-loading-text=\''+$indicatorbg+' creating zip archive...\' id="downloadBtn" type="button" class="btn btn-lg btn-primary-alt btn-block">\n                     <i class="icon icon-cloud-download"></i> Download</button>\n                     <label>Also save zip file: <input id="saveZip" name="saveZip" type="checkbox" value="1">\n                     </label>\n                     </div>';m=false;break;case"downloadItem":w='Downloading <b class="small icon icon-circle '+filterTypes[(u.type=="d"?"folder":u.ftype)]+'"></b> '+("<i> "+truncToTip($('<b class="small" data-container="false"/>'),u.name,25,true)+"</i>");g+='<div class="form-group tacent tbs h30">\n                     </div>';g+='<div id="down_box" class="form-group row-fluid">\n                     </div>';m="close";h=60;break;case"archiveItem":w='Add <b class="small icon icon-circle '+filterTypes[(u.type=="d"?"folder":u.ftype)]+'"></b> '+(u.count==1?("<i> "+truncToTip($('<b class="small" data-container="false"/>'),u.name,25,true)+"</i>"):("selected "+u.count+" item(s)"))+" to .zip archive";g+='<div class="form-group tacent tbs">\n                     <div id="total_size_down">Approximate unpacked size: <strong></strong></div>\n                     </div>';g+='<div id="down_box" class="form-group row-fluid">\n                     <button data-loading-text=\''+$indicatorbg+' creating zip archive...\' id="downloadBtn" type="button" class="btn btn-lg btn-primary-alt btn-block">\n                     <i class="icon icon-bolt"></i> Start Process</button>\n                     </div>';m=false;break;case"extractItem":w='Extract <b class="small icon icon-circle '+filterTypes[(u.type=="d"?"folder":u.ftype)]+'"></b> '+("<i> "+truncToTip($('<b class="small" data-container="false"/>'),u.t,25,true)+"</i>");g+="<div>";g+='<div class="form-group tacent">\n                     <label for="exto">Extract to: </label>\n                     <div id="extract_to" class="h30"></div>\n                     </div>\n                     <div class="form-group">'+createTextInput("extract_to","exto1",false,"or create a new directory in current folder")+"                     </div>";g+='<div class="form-group" id="zip_infp">\n                     <label for="zip_contains" class="btn btn-block btn-default mb5" data-toggle="collapse" data-parent="#zip_infp" href="#zip_cont-inner">\n                     Click for detailed tree of this archive</label>\n                     <div id="zip_contains"><div id="zip_cont-inner" class="int panel-collapse collapse"></div></div>\n                     </div>';g+='<div class="form-group last">'+createTextInput("name","name",u.t,u.t,"hidden","")+'                     <div class="callout callout-warning">Note: If this archive was created as a backup and will be extracted it to it\'s previous path, all files&folders will be overwritten! </div>\n                     </div>';g+='<div id="extract_box" class="form-group">\n                     <button data-loading-text=\''+$indicatorbg+' extracting...\' id="extract_toBtn" type="button" class="btn btn-lg btn-primary-alt btn-block">\n                     <i class="icon icon-bolt"></i> Extract</button>\n                     </div></div>';m=false;break;case"tpage":w=u.title+'<div id="headcontrol"><div class="uitoolbar"></div></div>';g+=createTextInput("page","page",u.action,"","hidden");g+='<div id="page_'+u.action+'" style="height: '+u.height+'px; max-height: 100%" class="last control">';m=$('<a href="" class="btn btn-primary btn-sm disabled go"><i class="icon icon-save"></i> Save</a>');t=true;break;default:m=$('<a href="" class="btn btn-danger disabled go">Continue</a>');break}p.attr("id",v);c.attr("id","form_"+n).data("target",d.attr("id")).append(g);if(w){p.find(".box_title").html(((l)?'<i class="icon icon-'+l+'"></i> ':"")+w)}else{p.find(".modal-header").remove()}if(content){if(n.split("_")[1]=="delete"){c.find(".callout").show().addClass("mp0").find("div:first").html(content)}else{c.append(content)}}if(u.width){p.attr("data-width",u.width)}if(m&&!d.data("nobtn")){if(m!="close"){m.on("click",function(){var y=$(this);if(!$(this).hasClass("disabled")){handleboxForms(y,c,p);y.button("loading")}return false});p.find(".modal-footer").append(m)}}else{p.addClass("nofooter").find(".modal-footer").remove()}if(h){p.data("countdown",h)}p.on("shown",function(){var y=c.find("input[type=text]")||0;if(y){y.eq(0).focus().select()}p.addClass("resize")});p.on("shown",function(){if(i){setTimeout(function(){if(n=="tpage"){c.blockit({message:indicatorCssSm+" Loading "+w,simple:true,button:false})}window[i](d,s,c,p)},700)}else{p.find("a.go").disabletoggle(false)}if(t){p.find("a.go").disabletoggle(false)}liveFormEnterSubmit(p);p.draggable({handle:".moveHandler",containment:"body",cursor:"crosshair"})});p.on("hide.bs.modal",function(){p.find(".jGrowl").jGrowl("shutdown")});setTimeout(function(){p.modal("show");p.find(".dismisbox").on("touchend",function(){p.modal("hide")});$indicatorEl.css("visibility","hidden");k.spin(false)},100)}function liveFormEnterSubmit(a){a.find("input[type=text], input[type=email]").keypress(function(b){if(b.which==13){$(this).blur();a.find("a.go").focus().click();return false}})}function remoteLoadPage(e,g,i,a,f,h){var b=e.data("action"),d=i.find("#page_"+b),c={page:b};if(f!==undefined){$.extend(true,c,f)}$.ajaxQueue({url:AJAX_PATH,type:"GET",data:c,beforeSend:function(){},success:function(j){i.unblock();d.htmlA(j,600,function(){liveFormEnterSubmit(a);if(a.find(".tabbable").length>0){a.find(".nav-tabs a.active").tab("show").trigger("click")}if(h){h.call()}});$(window).resize()}})}function createStatistics(e,i,k,b){Morris.Bar({element:b.find(e.data("target"))[0],stacked:true,hideHover:false,resize:true,xLabelAngle:35,data:[{t:"Image",a:uSt.count_image_types,i:0},{t:"Video",a:uSt.count_video_types,i:1},{t:"Audio",a:uSt.count_audio_types,i:2},{t:"Document",a:uSt.count_document_types,i:3},{t:"Other Types",a:uSt.count_other_types,i:4},{t:"Folders",a:uSt.count_dirs,i:5}],xkey:"t",ykeys:["a"],labels:["Total"],barColors:function(o,m,n){var l={Image:"#68217A",Video:"#F25022",Audio:"#0072C6",Document:"#8AC53E","Other Types":"#FFB900",Folders:"#EAEAEA"};return l[o.label]},hoverCallback:function(m,l,n){return(n+" item(s)")}});var g=k.width(),a=Raphael("trs",g,50),h=function(){this.flag=a.popup(this.bar.x,this.bar.y,(formatFileSize(this.bar.value))||"0").insertBefore(this)},f=function(){this.flag.animate({opacity:0},300,function(){this.remove()})};var j=parseInt(uSt.space_used_percentage),c=(j<20?"#3980B5":((j>20&&j<50)?"#d07e22":"#E73D0D")),d=a.hbarchart(30,10,g-60,40,[[uSt.space_used],[uSt.space_free]],{stacked:true,colors:[c,"#F4F4F4"]}).hover(h,f);$(window).resize(function(){a.setSize(k.width(),50);d.remove();d=a.hbarchart(30,10,k.width()-60,40,[[uSt.space_used],[uSt.space_free]],{stacked:true,colors:[c,"#F4F4F4"]}).hover(h,f)})}function deleteItemDismiss(d,b,a,c){$(".ignoretitem").one("click",function(){var i=$(this).closest("div.thumbnail"),j=i.data("id"),h=a.find('input[name="value"]'),f=c.find(".box_title .count");h.val(removeVal(h.val(),j));selectedItems[dir.id]=jQuery.grep(selectedItems[dir.id],function(l,k){return l!==j});var e=$list.findItem(j,"selected");selectItem(e,true);var g=selectedItems[dir.id].length;if(g===0){c.modal("hide")}f.text(g);hideTip(i[0]);i.remove()})}function removeVal(d,b){var c=$.isArray(d)?d:d.split(","),a=c.indexOf(b);c.splice(a,1);return c.join(",")}function loadFolderEdit(h,e,i,a){var g=$("#icon_select"),d=a.find(".icon_select_btn"),c=$("#iconpreview"),b=$('<span class="iconselect" />').on("click",function(){var j=$(this);c.prop("src",j.find("img").prop("src"));g.find("span.active").removeClass("active");j.addClass("active");$("#foiconin").val(j.data("id"));$("#resetIcon").show()}),f=g.find('input[type="hidden"]:first').val();$("#resetIcon").on("click",function(){$("#foiconin").val("0");c.prop("src",ASSURI+"img/blank.png");$(this).hide();$("#icon_select").find("span.iconselect.active").removeClass("active")});$("#fopass").xswitch().on("change",function(){$(this).closest("div.form-group").find("#fopass_val").toggle()});$(".icon_select_btn").on("click",function(){if(!g.hasClass("loaded")){var j=$("<div/>");$.ajaxQueue({url:AJAX_PATH,type:"POST",dataType:"json",cache:true,data:{action:"pull_icons",current_icon:h.data("i")},beforeSend:function(){d.blockit({message:$indicator,simple:true,button:true,css:{top:"-1px"}})},success:function(l){var k=l.length;setTimeout(function(){$.each(l,function(m,o){var n=b.clone(true);n.data("id",o.value).append(createIconImage(o.value)).appendTo(j);if(o.selected){n.addClass("active")}});g.append(j);g.addClass("loaded");d.unblock()},100)}})}g.slideToggle("fast",function(){setTimeout(function(){$(window).resize()},50)});d.find("i.icon").toggleClass("icon-caret-down icon-caret-up");return false})}function liveSelectCount(c,b){if(b){var a=c.data("bs.popover")||0;if(a){c.attr("data-content",b);a.setContent();a.$tip.addClass(a.options.placement+" light-blue selectedTotalcountnumber");if(a.$tip.is(":hidden")){a.show()}$dirNav.addClass("shift")}else{c.popover({trigger:"manual",content:b,placement:"right"}).popover("show").on("hide.bs.popover",function(){$dirNav.removeClass("shift")}).on("shown.bs.popover",function(){}).addClass("sticky");$dirNav.addClass("shift")}}else{if(c.closest("label").find("div.popover").length){c.popover("hide")}}}function liveSelections(b,d,f){var a=$("#checkFiles"),c=$("#filecheck"),e=$("#phoneActDr");if(b){$topActBtns.addClass("selected");$wrap.addClass("itemSelected");if(e.is(":visible")){e.addClass("light-orange").popover({trigger:"manual",content:"Navigate to take action",placement:"right"}).popover("show").on("click",function(){e.popover("hide")}).on("shown.bs.popover",function(){$(this).data("bs.popover").$tip.addClass("orange").find(".popover-content").addClass("pl5 pr5")})}liveSelectCount(a,b)}else{$topActBtns.removeClass("selected");$wrap.removeClass("itemSelected");liveSelectCount(a,b);if(e.is(":visible")){e.removeClass("light-orange");if(e.data("bs.popover")){e.popover("hide")}}}if(b<=d&&b>0){a.prop("indeterminate",true);if(b==d){a.prop("indeterminate",false).prop("checked",true)}}else{a.prop("indeterminate",false).prop("checked",false)}}function qDirActions(c,a,e,d){if(c=="updatedir"){$topActBtns.find('a[data-action="updatedir"]').trigger("click");if($.isFunction(d)){d()}return}var b={action:c,value:a?$(a).data("value"):"",path:dir.path,dir:dir.id,hash:dir.hash};if(e){$.extend(true,b,e)}$.ajaxQueue({type:"POST",url:AJAX_PATH,data:b,dataType:"json",success:function(){if($.isFunction(d)){d()}}})}function checkforAlert(a){if(a.ppop){$(".modal").modal("hide");var b=a;setTimeout(function(){var e=b.ppop,d={};$.each(e.action,function(f,g){d[f]={};$.each(g,function(i,h){d[f][i]=(typeof h=="function"?h(e.items):h)})});var c=ppop.dialog({width:(e.width?e.width:360),message:e.message,title:e.title,buttons:d});c.on("shown.bs.modal",function(){$notify.jGrowl("close")});$notify.jGrowl("close")},50)}return true}function createIconImage(a){return'<img src="'+ASSURI+"img/icons/"+a+'"/>'}function createJElobj(a){var c=$("<div/>"),b={"data-s":"","data-c":dir.description,"data-t":dir.name,"data-parent":dir.parentid,"data-id":dir.id,"class":"folder"};if(a){$.extend(true,b,a)}$.each(b,function(d,e){c.attr(d,e)});return c}function strip(b){var a=document.createElement("DIV");a.innerHTML=b;return a.textContent||a.innerText||""}forceUpdate=false;