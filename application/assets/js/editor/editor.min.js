(function(a){a.fn.veditor=function(m){function e(u,l,v,q,f){var o=h.length+1;return h.push({name:u,cls:o,command:l,key:v,tag:q,emphasis:f})}var d=[{title:"Text Format"},{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"}];var b=[["p","Normal"],["h1","Header 1"],["h2","Header 2"],["h3","Header 3"],["h4","Header 4"],["h5","Header 5"],["h6","Header 6"],["pre","Preformatted"]];var g=["10","12","16","18","20","24","28"];var p=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255",null,"255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255",null,"244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"];var c=["Web Address","E-mail Address","Picture URL"];var k=a.extend({status:true,css:"veditor",title:true,titletext:d,button:"OK",format:true,formats:b,fsize:true,fsizes:g,funit:"px",color:true,linktypes:c,b:true,i:true,u:true,ol:true,ul:true,sub:true,sup:true,outdent:true,indent:true,left:true,center:true,right:true,strike:true,link:true,unlink:true,remove:true,rule:true,source:true,placeholder:false,br:true,p:true,change:"",focus:"",blur:""},m);a.fn.veditorVal=function(f){a(this).closest("."+k.css).find("."+k.css+"_editor").html(f)};var j=navigator.userAgent.toLowerCase();if(/msie [1-7]./.test(j)){k.title=false}var h=[];e("format","formats","","",false);e("fsize","fSize","","",false);e("color","colors","","",false);e("b","Bold","B",["b","strong"],true);e("i","Italic","I",["i","em"],true);e("u","Underline","U",["u"],true);e("ol","insertorderedlist","¾",["ol"],true);e("ul","insertunorderedlist","¼",["ul"],true);e("sub","subscript","(",["sub"],true);e("sup","superscript","&",["sup"],true);e("outdent","outdent","%",["blockquote"],false);e("indent","indent","'",["blockquote"],true);e("left","justifyLeft","","",false);e("center","justifyCenter","","",false);e("right","justifyRight","","",false);e("strike","strikeThrough","K",["strike"],true);e("link","linkcreator","L",["a"],true);e("unlink","unlink","",["a"],false);e("remove","removeformat",".","",false);e("rule","inserthorizontalrule","H",["hr"],false);e("source","displaysource","","",false);return this.each(function(){function ax(){if(window.getSelection){return window.getSelection()}else{if(document.selection&&document.selection.createRange&&document.selection.type!="None"){return document.selection.createRange()}}}function aS(o,i){var q,l=ax();if(window.getSelection){if(l.anchorNode&&l.getRangeAt){q=l.getRangeAt(0)}if(q){l.removeAllRanges();l.addRange(q)}if(!j.match(/msie/)){document.execCommand("StyleWithCSS",false,false)}document.execCommand(o,false,i)}else{if(document.selection&&document.selection.createRange&&document.selection.type!="None"){q=document.selection.createRange();q.execCommand(o,false,i)}}aJ(false,false)}function at(C,w,q){if(aG.not(":focus")){aG.focus()}if(window.getSelection){var y=ax(),D,v,B;if(y.anchorNode&&y.getRangeAt){D=y.getRangeAt(0);v=document.createElement(C);a(v).attr(w,q);B=D.extractContents();v.appendChild(B);D.insertNode(v);y.removeAllRanges();if(w=="style"){aJ(a(v),q)}else{aJ(a(v),false)}}}else{if(document.selection&&document.selection.createRange&&document.selection.type!="None"){var A=document.selection.createRange();var z=A.htmlText;var x="<"+C+" "+w+'="'+q+'">'+z+"</"+C+">";document.selection.createRange().pasteHTML(x)}}}function aJ(o,i){var q=ao();q=q?q:o;if(q&&i==false){if(q.parent().is("[style]")){q.attr("style",q.parent().attr("style"))}if(q.is("[style]")){q.find("*").attr("style",q.attr("style"))}}else{if(o&&i&&o.is("[style]")){var l=i.split(";");l=l[0].split(":");if(o.is("[style*="+l[0]+"]")){o.find("*").css(l[0],l[1])}af(o)}}}function af(i){if(i){var i=i[0];if(document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(i);o.select()}else{if(window.getSelection){var l=window.getSelection();var o=document.createRange();if(i!="undefined"&&i!=null){o.selectNodeContents(i);l.removeAllRanges();l.addRange(o);if(a(i).is(":empty")){a(i).append(" ");af(a(i))}}}}}}function ac(){if(!aL.data("sourceOpened")){var i=ao();var o="http://";aa(true);if(i){var l=i.prop("tagName").toLowerCase();if(l=="a"&&i.is("[href]")){o=i.attr("href");i.attr(ae,"")}else{at("a",ae,"")}}else{aD.val(o).focus()}aV.click(function(n){if(a(n.target).hasClass(k.css+"_linktypetext")||a(n.target).hasClass(k.css+"_linktypearrow")){u(true)}});aF.find("a").click(function(){var n=a(this).attr(k.css+"-linktype");aF.data("linktype",n);au.find("."+k.css+"_linktypetext").html(aF.find("a:eq("+aF.data("linktype")+")").text());ab(o);u()});ab(o);aD.focus().val(o).bind("keypress keyup",function(n){if(n.keyCode==13){aC(aU.find("["+ae+"]"));return false}});aZ.click(function(){aC(aU.find("["+ae+"]"))})}else{aa(false)}}function aC(i){aD.focus();af(i);i.removeAttr(ae);if(aF.data("linktype")!="2"){aS("createlink",aD.val())}else{aS("insertImage",aD.val());aG.find("img").each(function(){var l=a(this).prev("a");var o=a(this).next("a");if(l.length>0&&l.html()==""){l.remove()}else{if(o.length>0&&o.html()==""){o.remove()}}})}aa();aG.trigger("change")}function aa(i){ag("["+ae+"]:not([href])");aU.find("["+ae+"][href]").removeAttr(ae);if(i){aL.data("linkOpened",true);aX.show()}else{aL.data("linkOpened",false);aX.hide()}u()}function u(i){if(i){aF.show()}else{aF.hide()}}function ab(l){var i=aF.data("linktype");if(i=="1"&&(aD.val()=="http://"||aD.is("[value^=http://]")||!aD.is("[value^=mailto]"))){aD.val("mailto:")}else{if(i!="1"&&!aD.is("[value^=http://]")){aD.val("http://")}else{aD.val(l)}}}function an(i){if(!aL.data("sourceOpened")){if(i=="fSize"){styleField=ah}else{if(i=="colors"){styleField=ap}}am(styleField,true);styleField.find("a").unbind("click").click(function(){var o=a(this).attr(k.css+"-styleval");if(i=="fSize"){styleType="font-size";o=o+k.funit}else{if(i=="colors"){styleType="color";o="rgb("+o+")"}}var l=ar(styleType);at("span","style",styleType+":"+o+";"+l);am("",false);a("."+k.css+"_title").remove();aG.trigger("change")})}else{am(styleField,false)}aa(false)}function am(v,o){var w="",q=[{d:"fsizeOpened",f:ah},{d:"cpallOpened",f:ap}];if(v!=""){for(var l=0;l<q.length;l++){if(v==q[l]["f"]){w=q[l]}}}if(o){aL.data(w.d,true);w.f.slideDown(100);for(var l=0;l<q.length;l++){if(w.d!=q[l]["d"]){aL.data(q[l]["d"],false);q[l]["f"].slideUp(100)}}}else{for(var l=0;l<q.length;l++){aL.data(q[l]["d"],false);q[l]["f"].slideUp(100)}}}function ag(i){aU.find(i).each(function(){a(this).before(a(this).html()).remove()})}function ar(o){var i=ao();if(i&&i.is("[style]")&&i.css(o)!=""){var q=i.css(o);i.css(o,"");var l=i.attr("style");i.css(o,q);return l}else{return""}}function s(){f(true);av.find("a").click(function(){a("*",this).click(function(l){l.preventDefault();return false});aK(a(this).text());var i=a(this).attr(k.css+"-formatval");aS("formatBlock","<"+i+">");f(false)})}function f(l){var i=l?true:false;i=l&&av.data("status")?true:false;if(i||!l){av.data("status",false).slideUp(200)}else{av.data("status",true).slideDown(200)}}function aK(l){var i=av.closest("."+k.css+"_tool").find("."+k.css+"_tool_label").find("."+k.css+"_tool_text");if(l.length>10){l=l.substr(0,7)+"..."}i.html(l)}function aW(v){var o,w,q;o=v.replace(/\n/gim,"").replace(/\r/gim,"").replace(/\t/gim,"").replace(/ /gim," ");w=[/\<span(|\s+.*?)><span(|\s+.*?)>(.*?)<\/span><\/span>/gim,/<(\w*[^p])\s*[^\/>]*>\s*<\/\1>/gim,/\<div(|\s+.*?)>(.*?)\<\/div>/gim,/\<strong(|\s+.*?)>(.*?)\<\/strong>/gim,/\<em(|\s+.*?)>(.*?)\<\/em>/gim];q=["<span$2>$3</span>","","<p$1>$2</p>","<b$1>$2</b>","<i$1>$2</i>"];for(ay=0;ay<5;ay++){for(var l=0;l<w.length;l++){o=o.replace(w[l],q[l])}}if(!k.p){o=o.replace(/\<p(|\s+.*?)>(.*?)\<\/p>/ig,"<br/>$2")}if(!k.br){w=[/\<br>(.*?)/ig,/\<br\/>(.*?)/ig];q=["<p>$1</p>","<p>$1</p>"];for(var l=0;l<w.length;l++){o=o.replace(w[l],q[l])}}if(!k.p&&!k.br){o=o.replace(/\<p>(.*?)\<\/p>/ig,"<div>$1</div>")}return o}function aR(){var i=aG.text()==""&&aG.html().length<12?"":aG.html();aP.val(aW(i))}function aB(){aG.html(aW(aP.val()))}function az(o){var v=false,q=ao(),l;if(q){a.each(o,function(i,n){l=q.prop("tagName").toLowerCase();if(l==n){v=true}else{q.parents().each(function(){l=a(this).prop("tagName").toLowerCase();if(l==n){v=true}})}});return v}else{return false}}function aq(o){for(var w=0;w<h.length;w++){if(k[h[w].name]&&h[w].emphasis&&h[w].tag!=""){az(h[w].tag)?aL.find("."+k.css+"_tool_"+h[w].cls).addClass(aO):a("."+k.css+"_tool_"+h[w].cls).removeClass(aO)}}if(k.format&&a.isArray(k.formats)){var v=false;for(var l=0;l<k.formats.length;l++){var q=[];q[0]=k.formats[l][0];if(k.formats[l][0].length>0&&az(q)){aK(k.formats[l][1]);v=true;break}}if(!v){aK(k.formats[0][1])}}am("",false);f(false)}if(!a(this).data("veditor")||a(this).data("veditor")==null||a(this).data("veditor")=="undefined"){a(this).data("veditor",true)}else{a(this).data("veditor",false)}if(!k.status||!a(this).data("veditor")){if(a(this).closest("."+k.css).length>0){var aH=a(this).closest("."+k.css).find("."+k.css+"_editor").html();var aN="";a(a(this)[0].attributes).each(function(){if(this.nodeName!="style"){aN=aN+" "+this.nodeName+'="'+this.nodeValue+'"'}});var aI=a(this).is("[data-origin]")&&a(this).attr("data-origin")!=""?a(this).attr("data-origin"):"textarea";var aT=">"+aH;if(aI=="input"||aI=="option"){aH=aH.replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"<").replace(/>/g,">");aT='value="'+aH+'">'}var aM=a(this).clone();a(this).data("veditor",false).closest("."+k.css).before(aM).remove();aM.replaceWith("<"+aI+aN+aT+"</"+aI+">")}return}var aP=a(this);var aI=a(this).prop("tagName").toLowerCase();a(this).attr("data-origin",aI);var aY=a(this).is("[value]")||aI=="textarea"?a(this).val():a(this).html();aY=aY.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/</g,"<").replace(/>/g,">").replace(/&/g,"&");a(this).after('<div class="'+k.css+'"></div>');var aU=a(this).next("."+k.css);aU.html('<div class="'+k.css+'_toolbar" role="toolbar" unselectable></div><div class="'+k.css+'_linkform" style="display:none" role="dialog"></div><div class="'+k.css+'_editor"></div>');var aL=aU.find("."+k.css+"_toolbar");var aX=aU.find("."+k.css+"_linkform");var aG=aU.find("."+k.css+"_editor");var aO=k.css+"_tool_depressed";aX.append('<div class="'+k.css+'_linktypeselect" unselectable></div><input class="'+k.css+'_linkinput" type="text/css" value=""><div class="'+k.css+'_linkbutton" unselectable>'+k.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var aV=aX.find("."+k.css+"_linktypeselect");var aD=aX.find("."+k.css+"_linkinput");var aZ=aX.find("."+k.css+"_linkbutton");aV.append('<div class="'+k.css+'_linktypeview" unselectable></div><div class="'+k.css+'_linktypes" role="menu" unselectable></div>');var aF=aV.find("."+k.css+"_linktypes");var au=aV.find("."+k.css+"_linktypeview");var ae=k.css+"-setlink";aG.after('<div class="'+k.css+"_source "+k.css+'_hiddenField"></div>');var aE=aU.find("."+k.css+"_source");aP.appendTo(aE);if(aI!="textarea"){var aN="";a(aP[0].attributes).each(function(){if(this.nodeName!="type"&&this.nodeName!="value"){aN=aN+" "+this.nodeName+'="'+this.nodeValue+'"'}});aP.replaceWith("<textarea "+aN+">"+aY+"</textarea>");aP=aE.find("textarea")}aG.attr("contenteditable","true").html(aY);for(var ad=0;ad<h.length;ad++){if(k[h[ad].name]){var aj=h[ad].key.length>0?k.titletext[ad].hotkey!=null&&k.titletext[ad].hotkey!="undefined"&&k.titletext[ad].hotkey!=""?" (Ctrl+"+k.titletext[ad].hotkey+")":"":"";var aw=k.titletext[ad].title!=null&&k.titletext[ad].title!="undefined"&&k.titletext[ad].title!=""?k.titletext[ad].title+aj:"";aL.append('<div class="'+k.css+"_tool "+k.css+"_tool_"+h[ad].cls+'" role="button" data-tool="'+ad+'" unselectable><a class="'+k.css+'_tool_icon" unselectable></a></div>');aL.find("."+k.css+"_tool[data-tool="+ad+"]").data({tag:h[ad].tag,command:h[ad].command,emphasis:h[ad].emphasis,title:aw});if(h[ad].name=="format"&&a.isArray(k.formats)){var aQ=k.formats[0][1].length>0&&k.formats[0][1]!="undefined"?k.formats[0][1]:"";aL.find("."+k.css+"_tool_"+h[ad].cls).find("."+k.css+"_tool_icon").replaceWith('<a class="'+k.css+'_tool_label" unselectable><span class="'+k.css+'_tool_text" unselectable>'+aQ+'</span><span class="'+k.css+'_tool_icon" unselectable></span></a>');aL.find("."+k.css+"_tool_"+h[ad].cls).append('<div class="'+k.css+'_formats" unselectable></div>');for(var al=0;al<k.formats.length;al++){aL.find("."+k.css+"_formats").append("<a "+k.css+'-formatval="'+k.formats[al][0]+'" class="'+k.css+"_format "+k.css+"_format_"+al+'" role="menuitem" unselectable>'+k.formats[al][1]+"</a>")}aL.find("."+k.css+"_formats").data("status",false)}else{if(h[ad].name=="fsize"&&a.isArray(k.fsizes)){aL.find("."+k.css+"_tool_"+h[ad].cls).append('<div class="'+k.css+'_fontsizes" unselectable></div>');for(var al=0;al<k.fsizes.length;al++){aL.find("."+k.css+"_fontsizes").append("<a "+k.css+'-styleval="'+k.fsizes[al]+'" class="'+k.css+'_fontsize" style="font-size:'+k.fsizes[al]+k.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}}else{if(h[ad].name=="color"&&a.isArray(p)){aL.find("."+k.css+"_tool_"+h[ad].cls).append('<div class="'+k.css+'_cpalette" unselectable></div>');for(var ay=0;ay<p.length;ay++){if(p[ay]!=null){aL.find("."+k.css+"_cpalette").append("<a "+k.css+'-styleval="'+p[ay]+'" class="'+k.css+'_color" style="background-color: rgb('+p[ay]+')" role="gridcell" unselectable></a>')}else{aL.find("."+k.css+"_cpalette").append('<div class="'+k.css+'_colorSeperator"></div>')}}}}}}}aF.data("linktype","0");for(var ad=0;ad<3;ad++){aF.append("<a "+k.css+'-linktype="'+ad+'" unselectable>'+k.linktypes[ad]+"</a>");au.html('<div class="'+k.css+'_linktypearrow" unselectable></div><div class="'+k.css+'_linktypetext">'+aF.find("a:eq("+aF.data("linktype")+")").text()+"</div>")}var ai="";if(/msie/.test(j)){ai="-ms-"}else{if(/chrome/.test(j)||/safari/.test(j)||/yandex/.test(j)){ai="-webkit-"}else{if(/mozilla/.test(j)){ai="-moz-"}else{if(/opera/.test(j)){ai="-o-"}else{if(/konqueror/.test(j)){ai="-khtml-"}else{ai=""}}}}}if(k.placeholder&&k.placeholder!=""){aU.prepend('<div class="'+k.css+'_placeholder" unselectable><div class="'+k.css+'_placeholder_text">'+k.placeholder+"</div></div>");var ak=aU.find("."+k.css+"_placeholder");ak.click(function(){aG.focus()})}aU.find("[unselectable]").css(ai+"user-select","none").addClass("unselectable").attr("unselectable","on").on("selectstart mousedown",false);var a0=aL.find("."+k.css+"_tool");var av=aL.find("."+k.css+"_formats");var ah=aL.find("."+k.css+"_fontsizes");var ap=aL.find("."+k.css+"_cpalette");var ao=function(){var i,o;if(window.getSelection){o=getSelection();i=o.anchorNode}if(!i&&document.selection&&document.selection.createRange&&document.selection.type!="None"){o=document.selection;var l=o.getRangeAt?o.getRangeAt(0):o.createRange();i=l.commonAncestorContainer?l.commonAncestorContainer:l.parentElement?l.parentElement():l.item(0)}if(i){return i.nodeName=="#text"?a(i.parentNode):a(i)}else{return false}};a0.unbind("click").click(function(i){if(a(this).data("command")=="displaysource"&&!aL.data("sourceOpened")){aL.find("."+k.css+"_tool").addClass(k.css+"_hiddenField");a(this).removeClass(k.css+"_hiddenField");aL.data("sourceOpened",true);aP.css("height",aG.outerHeight());aE.removeClass(k.css+"_hiddenField");aG.addClass(k.css+"_hiddenField");aP.focus();aa(false);am("",false);f();if(k.placeholder&&k.placeholder!=""){ak.hide()}}else{if(!aL.data("sourceOpened")){if(a(this).data("command")=="linkcreator"){if(!aL.data("linkOpened")){ac()}else{aa(false);f(false)}}else{if(a(this).data("command")=="formats"){if(a(this).data("command")=="formats"&&!a(i.target).hasClass(k.css+"_format")){s()}am("",false);if(aG.not(":focus")){aG.focus()}}else{if(a(this).data("command")=="fSize"||a(this).data("command")=="colors"){if(a(this).data("command")=="fSize"&&!a(i.target).hasClass(k.css+"_fontsize")||a(this).data("command")=="colors"&&!a(i.target).hasClass(k.css+"_color")){an(a(this).data("command"))}f(false);if(aG.not(":focus")){aG.focus()}}else{if(aG.not(":focus")){aG.focus()}aS(a(this).data("command"),null);am("",false);f(false);u();a(this).data("emphasis")==true&&!a(this).hasClass(aO)?a(this).addClass(aO):a(this).removeClass(aO);aE.addClass(k.css+"_hiddenField");aG.removeClass(k.css+"_hiddenField")}}}}else{aL.data("sourceOpened",false);aL.find("."+k.css+"_tool").removeClass(k.css+"_hiddenField");aE.addClass(k.css+"_hiddenField");aG.removeClass(k.css+"_hiddenField")}if(k.placeholder&&k.placeholder!=""){aG.html()!=""?ak.hide():ak.show()}}aG.trigger("change")}).hover(function(q){if(k.title&&a(this).data("title")!=""&&(a(q.target).hasClass(k.css+"_tool")||a(q.target).hasClass(k.css+"_tool_icon"))){a("."+k.css+"_title").remove();aU.append('<div class="'+k.css+'_title"><div class="'+k.css+'_titleArrow"><div class="'+k.css+'_titleArrowIcon"></div></div><div class="'+k.css+'_titleText">'+a(this).data("title")+"</div></div>");var y=a("."+k.css+"_title:first");var w=y.find("."+k.css+"_titleArrowIcon");var l=a(this).position();var v=l.left+a(this).outerWidth()-y.outerWidth()/2-a(this).outerWidth()/2;var x=l.top+a(this).outerHeight()+5;y.delay(400).css({top:x,left:v}).fadeIn(200)}},function(){a("."+k.css+"_title").remove()});var aA=null;aG.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){if(!aL.data("sourceOpened")){a(this).trigger("change")}u();if(a.isFunction(k.change)){k.change()}if(k.placeholder&&k.placeholder!=""){a(this).text()!=""?ak.hide():ak.show()}}).bind("change",function(){if(!aL.data("sourceOpened")){clearTimeout(aA);aA=setTimeout(aR,10)}}).keydown(function(l){if(l.ctrlKey){for(var i=0;i<h.length;i++){if(k[h[i].name]&&l.keyCode==h[i].key.charCodeAt(0)){if(h[i].command!=""&&h[i].command!="linkcreator"){aS(h[i].command,null)}else{if(h[i].command=="linkcreator"){ac()}}return false}}}}).bind("mouseup keyup",aq).focus(function(){if(a.isFunction(k.focus)){k.focus()}aU.addClass(k.css+"_focused");if(/opera/.test(j)){var i=document.createRange();i.selectNodeContents(aG[0]);i.collapse(false);var l=window.getSelection();l.removeAllRanges();l.addRange(i)}}).focusout(function(){a0.removeClass(aO);am("",false);f(false);u();if(a.isFunction(k.blur)){k.blur()}aU.removeClass(k.css+"_focused");if(a.isArray(k.formats)){aK(k.formats[0][1])}});aP.bind("keydown keyup",function(){setTimeout(aB,0);a(this).height(a(this)[0].scrollHeight);if(a(this).val()==""){a(this).height(0)}}).focus(function(){aU.addClass(k.css+"_focused")}).focusout(function(){aU.removeClass(k.css+"_focused")})})}})(jQuery);