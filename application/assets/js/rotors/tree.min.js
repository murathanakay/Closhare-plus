(function(c,j,m,f){if(c.ui.fancytree&&c.ui.fancytree.version){c.ui.fancytree.warn("Fancytree: ignored duplicate include");return}function s(i){i=i||"";c.error("Not implemented: "+i)}function k(i,y){if(!i){y=y?": "+y:"";c.error("Assertion failed"+y)}}function u(C,y){var z,B,A=j.console?j.console[C]:null;if(A){if(A.apply){A.apply(j.console,y)}else{B="";for(z=0;z<y.length;z++){B+=y[z]}A(B)}}}function l(D,C,B,z){var A,E,G,F=c.map(c.trim(D).split("."),function(i){return parseInt(i,10)}),y=c.map(Array.prototype.slice.call(arguments,1),function(i){return parseInt(i,10)});for(A=0;A<y.length;A++){E=F[A]||0;G=y[A]||0;if(E!==G){return E>G}}return true}function t(y,i,B,C,A){var z=function(){var D=i[y],F=C[y],G=i.ext[A],E=function(){return D.apply(i,arguments)};return function(){var I=i._local,H=i._super;try{i._local=G;i._super=E;return F.apply(i,arguments)}finally{i._local=I;i._super=H}}}();return z}function d(i,A,B,z){for(var y in B){if(typeof B[y]==="function"){if(typeof i[y]==="function"){i[y]=t(y,i,A,B,z)}else{if(y.charAt(0)==="_"){i.ext[z][y]=t(y,i,A,B,z)}else{c.error("Could not override tree."+y+". Use prefix '_' to create tree."+z+"._"+y)}}}else{if(y!=="options"){i.ext[z][y]=B[y]}}}}function w(y,i){if(y===f){return c.Deferred(function(){this.resolve()}).promise()}else{return c.Deferred(function(){this.resolveWith(y,i)}).promise()}}function o(y,i){if(y===f){return c.Deferred(function(){this.reject()}).promise()}else{return c.Deferred(function(){this.rejectWith(y,i)}).promise()}}function r(i,y){return function(){i.resolveWith(y)}}function v(i){i=i.toLowerCase();return function(y){return y.title.toLowerCase().indexOf(i)>=0}}var p,a=null,x="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),e={},n="expanded extraClasses folder hideCheckbox key lazy selected title tooltip unselectable".split(" "),h={},q={active:true,children:true,data:true,focus:true};for(p=0;p<x.length;p++){e[x[p]]=true}for(p=0;p<n.length;p++){h[n[p]]=true}function b(C,D){var B,z,A,y;this.parent=C;this.tree=C.tree;this.ul=null;this.li=null;this.statusNodeType=null;this._isLoading=false;this.data={};for(B=0,z=n.length;B<z;B++){A=n[B];this[A]=D[A]}if(D.data){c.extend(this.data,D.data)}for(A in D){if(!h[A]&&(!c.isFunction(D[A])&&!q[A])){this.data[A]=D[A]}}if(this.key==null){this.key="_"+a._nextNodeKey++}if(D.active){k(this.tree.activeNode===null,"only one active node allowed");this.tree.activeNode=this}this.children=null;y=D.children;if(y&&y.length){this._setChildren(y)}}b.prototype={_findDirectChild:function(B){var A,z,y=this.children;if(y){if(typeof B==="string"){for(A=0,z=y.length;A<z;A++){if(y[A].key===B){return y[A]}}}else{if(typeof B==="number"){return this.children[B]}else{if(B.parent===this){return B}}}}return null},_setChildren:function(A){k(A&&(!this.children||this.children.length===0),"only init supported");this.children=[];for(var z=0,y=A.length;z<y;z++){this.children.push(new b(this,A[z]))}},addChildren:function(C,A){var B,y,E,D=null,z=[];if(c.isPlainObject(C)){C=[C]}if(!this.children){this.children=[]}for(B=0,y=C.length;B<y;B++){z.push(new b(this,C[B]))}D=z[0];if(A==null){this.children=this.children.concat(z)}else{A=this._findDirectChild(A);E=c.inArray(A,this.children);k(E>=0,"insertBefore must be an existing child");this.children.splice.apply(this.children,[E,0].concat(z))}if(!this.parent||(this.parent.ul||this.tr)){this.render()}if(this.tree.options.selectMode===3){this.fixSelection3FromEndNodes()}return D},addNode:function(i,y){if(y===f||y==="over"){y="child"}switch(y){case"after":return this.getParent().addChildren(i,this.getNextSibling());case"before":return this.getParent().addChildren(i,this);case"child":case"over":return this.addChildren(i)}k(false,"Invalid mode: "+y)},applyPatch:function(B){if(B===null){this.remove();return w(this)}var y,A,i,z={children:true,expanded:true,parent:true};for(y in B){i=B[y];if(!z[y]&&!c.isFunction(i)){if(h[y]){this[y]=i}else{this.data[y]=i}}}if(B.hasOwnProperty("children")){this.removeChildren();if(B.children){this._setChildren(B.children)}}if(this.isVisible()){this.renderTitle();this.renderStatus()}if(B.hasOwnProperty("expanded")){A=this.setExpanded(B.expanded)}else{A=w(this)}return A},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(i,z,y){return i.addNode(this.toDict(true,y),z)},countChildren:function(A){var z=this.children,B,y,C;if(!z){return 0}C=z.length;if(A!==false){for(B=0,y=C;B<y;B++){C+=z[B].countChildren()}}return C},debug:function(i){if(this.tree.options.debugLevel>=2){Array.prototype.unshift.call(arguments,this.toString());u("debug",arguments)}},discard:function(){this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead.");return this.resetLazy()},findAll:function(i){i=c.isFunction(i)?i:v(i);var y=[];this.visit(function(z){if(i(z)){y.push(z)}});return y},findFirst:function(i){i=c.isFunction(i)?i:v(i);var y=null;this.visit(function(z){if(i(z)){y=z;return false}});return y},_changeSelectStatusAttrs:function(i){var y=false;switch(i){case false:y=this.selected||this.partsel;this.selected=false;this.partsel=false;break;case true:y=!this.selected||!this.partsel;this.selected=true;this.partsel=true;break;case f:y=this.selected||!this.partsel;this.selected=false;this.partsel=true;break;default:k(false,"invalid state: "+i)}if(y){this.renderStatus()}return y},fixSelection3AfterClick:function(){var i=this.isSelected();this.visit(function(y){y._changeSelectStatusAttrs(i)});this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){k(this.tree.options.selectMode===3,"expected selectMode 3");function i(B){var E,C,A,G,y,F,D,z=B.children;if(z){F=true;D=false;for(E=0,C=z.length;E<C;E++){A=z[E];G=i(A);if(G!==false){D=true}if(G!==true){F=false}}y=F?true:D?f:false}else{y=!!B.selected}B._changeSelectStatusAttrs(y);return y}i(this);this.visitParents(function(D){var C,z,F,E,B=D.children,A=true,y=false;for(C=0,z=B.length;C<z;C++){F=B[C];if(F.selected||F.partsel){y=true}if(!F.unselectable&&!F.selected){A=false}}E=A?true:y?f:false;D._changeSelectStatusAttrs(E)})},fromDict:function(y){for(var i in y){if(h[i]){this[i]=y[i]}else{if(i==="data"){c.extend(this.data,y.data)}else{if(!c.isFunction(y[i])&&!q[i]){this.data[i]=y[i]}}}}if(y.children){this.removeChildren();this.addChildren(y.children)}else{this.renderTitle()}},getChildren:function(){if(this.hasChildren()===f){return f}return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return c.inArray(this,this.parent.children)},getIndexHier:function(y){y=y||".";var i=[];c.each(this.getParentList(false,true),function(z,A){i.push(A.getIndex()+1)});return i.join(y)},getKeyPath:function(z){var y=[],i=this.tree.options.keyPathSeparator;this.visitParents(function(A){if(A.parent){y.unshift(A.key)}},!z);return i+y.join(i)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){var y=0,i=this.parent;while(i){y++;i=i.parent}return y},getNextSibling:function(){if(this.parent){var z,y,A=this.parent.children;for(z=0,y=A.length-1;z<y;z++){if(A[z]===this){return A[z+1]}}}return null},getParent:function(){return this.parent},getParentList:function(y,z){var i=[],A=z?this:this.parent;while(A){if(y||A.parent){i.unshift(A)}A=A.parent}return i},getPrevSibling:function(){if(this.parent){var z,y,A=this.parent.children;for(z=1,y=A.length;z<y;z++){if(A[z]===this){return A[z-1]}}}return null},hasChildren:function(){if(this.lazy){if(this.children==null){return f}else{if(this.children.length===0){return false}else{if(this.children.length===1&&this.children[0].isStatusNode()){return f}}}return true}return !!this.children},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},isActive:function(){return this.tree.activeNode===this},isChildOf:function(i){return this.parent&&this.parent===i},isDescendantOf:function(i){if(!i||i.tree!==this.tree){return false}var y=this.parent;while(y){if(y===i){return true}y=y.parent}return false},isExpanded:function(){return !!this.expanded},isFirstSibling:function(){var i=this.parent;return !i||i.children[0]===this},isFolder:function(){return !!this.folder},isLastSibling:function(){var i=this.parent;return !i||i.children[i.children.length-1]===this},isLazy:function(){return !!this.lazy},isLoaded:function(){return !this.lazy||this.hasChildren()!==f},isLoading:function(){return !!this._isLoading},isRoot:function(){return this.tree.rootNode===this},isSelected:function(){return !!this.selected},isStatusNode:function(){return !!this.statusNodeType},isUndefined:function(){return this.hasChildren()===f},isVisible:function(){var A,y,z=this.getParentList(false,false);for(A=0,y=z.length;A<y;A++){if(!z[A].expanded){return false}}return true},lazyLoad:function(i){this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead.");return this.load(i)},load:function(A){var i,z,y=this;k(this.isLazy(),"load() requires a lazy node");k(A||this.isUndefined(),"Pass forceReload=true to re-load a lazy node");if(this.isLoaded()){this.resetLazy()}z=this.tree._triggerNodeEvent("lazyLoad",this);k(typeof z!=="boolean","lazyLoad event must return source in data.result");i=this.tree._callHook("nodeLoadChildren",this,z);if(this.expanded){i.always(function(){y.render()})}return i},makeVisible:function(y){var A,B=this,G=[],F=new c.Deferred,E=this.getParentList(false,false),C=E.length,z=!(y&&y.noAnimation===true),D=!(y&&y.scrollIntoView===false);for(A=C-1;A>=0;A--){G.push(E[A].setExpanded(true,y))}c.when.apply(c,G).done(function(){if(D){B.scrollIntoView(z).done(function(){F.resolve()})}else{F.resolve()}});return F.promise()},moveTo:function(A,B,z){if(B===f||B==="over"){B="child"}var C,i=this.parent,y=B==="child"?A:A.parent;if(this===A){return}else{if(!this.parent){throw"Cannot move system root"}else{if(y.isDescendantOf(this)){throw"Cannot move a node to its own descendant"}}}if(this.parent.children.length===1){this.parent.children=this.parent.lazy?[]:null;this.parent.expanded=false}else{C=c.inArray(this,this.parent.children);k(C>=0);this.parent.children.splice(C,1)}this.parent=y;if(y.hasChildren()){switch(B){case"child":y.children.push(this);break;case"before":C=c.inArray(A,y.children);k(C>=0);y.children.splice(C,0,this);break;case"after":C=c.inArray(A,y.children);k(C>=0);y.children.splice(C+1,0,this);break;default:throw"Invalid mode "+B}}else{y.children=[this]}if(z){A.visit(z,true)}if(this.tree!==A.tree){this.warn("Cross-tree moveTo is experimantal!");this.visit(function(D){D.tree=A.tree},true)}if(!i.isDescendantOf(y)){i.render()}if(!y.isDescendantOf(i)&&y!==i){y.render()}},navigate:function(B,E){var C,A,F=true,D=c.ui.keyCode,z=null;function y(i){if(i){i.makeVisible();if(!c(i.span).is(":visible")){i.debug("Navigate: skipping hidden node");i.navigate(B,E);return}return E===false?i.setFocus():i.setActive()}}switch(B){case D.BACKSPACE:if(this.parent&&this.parent.parent){y(this.parent)}break;case D.LEFT:if(this.expanded){this.setExpanded(false);y(this)}else{if(this.parent&&this.parent.parent){y(this.parent)}}break;case D.RIGHT:if(!this.expanded&&(this.children||this.lazy)){this.setExpanded();y(this)}else{if(this.children&&this.children.length){y(this.children[0])}}break;case D.UP:z=this.getPrevSibling();while(z&&(z.expanded&&(z.children&&z.children.length))){z=z.children[z.children.length-1]}if(!z&&(this.parent&&this.parent.parent)){z=this.parent}y(z);break;case D.DOWN:if(this.expanded&&(this.children&&this.children.length)){z=this.children[0]}else{A=this.getParentList(false,true);for(C=A.length-1;C>=0;C--){z=A[C].getNextSibling();if(z){break}}}y(z);break;default:F=false}},remove:function(){return this.parent.removeChild(this)},removeChild:function(i){return this.tree._callHook("nodeRemoveChild",this,i)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},render:function(y,i){return this.tree._callHook("nodeRender",this,y,i)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},resetLazy:function(){this.removeChildren();this.expanded=false;this.lazy=true;this.children=f;this.renderStatus()},scheduleAction:function(z,y){if(this.tree.timer){clearTimeout(this.tree.timer)}this.tree.timer=null;var i=this;switch(z){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger expand");i.setExpanded(true)},y);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger activate");i.setActive(true)},y);break;default:throw"Invalid mode "+z}},scrollIntoView:function(z,F){z=z===true?{duration:200,queue:false}:z;var E,G=new c.Deferred,C=this,B=c(this.span).position().top,y=c(this.span).height(),H=this.tree.$container,A=H[0].scrollTop,D=Math.max(0,H.innerHeight()-H[0].clientHeight),I=H.height()-D,i=null;if(B<0){i=A+B}else{if(B+y>I){i=A+B-I+y;if(F){E=F?c(F.span).position().top:0;if(B-E>I){i=A+E}}}}if(i!==null){if(z){z.complete=function(){G.resolveWith(C)};H.animate({scrollTop:i},z)}else{H[0].scrollTop=i;G.resolveWith(this)}}else{G.resolveWith(this)}return G.promise()},setActive:function(i,y){return this.tree._callHook("nodeSetActive",this,i,y)},setExpanded:function(i,y){return this.tree._callHook("nodeSetExpanded",this,i,y)},setFocus:function(i){return this.tree._callHook("nodeSetFocus",this,i)},setSelected:function(i){return this.tree._callHook("nodeSetSelected",this,i)},setTitle:function(i){this.title=i;this.renderTitle()},sortChildren:function(C,A){var B,z,y=this.children;if(!y){return}C=C||function(E,D){var i=E.title.toLowerCase(),F=D.title.toLowerCase();return i===F?0:i>F?1:-1};y.sort(C);if(A){for(B=0,z=y.length;B<z;B++){if(y[B].children){y[B].sortChildren(C,"$norender$")}}}if(A!=="$norender$"){this.render()}},toDict:function(A,E){var B,y,C,D={},z=this;c.each(n,function(G,F){if(z[F]||z[F]===false){D[F]=z[F]}});if(!c.isEmptyObject(this.data)){D.data=c.extend({},this.data);if(c.isEmptyObject(D.data)){delete D.data}}if(E){E(D)}if(A){if(this.hasChildren()){D.children=[];for(B=0,y=this.children.length;B<y;B++){C=this.children[B];if(!C.isStatusNode()){D.children.push(C.toDict(true,E))}}}else{}}return D},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(D,z){var C,y,B=true,A=this.children;if(z===true){B=D(this);if(B===false||B==="skip"){return B}}if(A){for(C=0,y=A.length;C<y;C++){B=A[C].visit(D,true);if(B===false){break}}}return B},visitParents:function(y,i){if(i&&y(this)===false){return false}var z=this.parent;while(z){if(y(z)===false){return false}z=z.parent}return true},warn:function(i){Array.prototype.unshift.call(arguments,this.toString());u("warn",arguments)}};function g(z){this.widget=z;this.$div=z.element;this.options=z.options;if(this.options&&c.isFunction(this.options.lazyload)){if(!c.isFunction(this.options.lazyLoad)){this.options.lazyLoad=function(){a.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead.");z.options.lazyload.apply(this,arguments)}}}this.ext={};this.data={};this._id=c.ui.fancytree._nextId++;this._ns=".fancytree-"+this._id;this.activeNode=null;this.focusNode=null;this._hasFocus=null;this.lastSelectedNode=null;this.systemFocusElement=null,this.statusClassPropName="span";this.ariaPropName="li";this.nodeContainerAttrName="li";this.$div.find(">ul.fancytree-container").remove();var i={tree:this},y;this.rootNode=new b(i,{title:"root",key:"root_"+this._id,children:null,expanded:true});this.rootNode.parent=null;y=c("<ul>",{"class":"ui-fancytree fancytree-container"}).appendTo(this.$div);this.$container=y;this.rootNode.ul=y[0];if(this.options.debugLevel==null){this.options.debugLevel=a.debugLevel}this.$container.attr("tabindex",this.options.tabbable?"0":"-1");if(this.options.aria){this.$container.attr("role","tree").attr("aria-multiselectable",true)}}g.prototype={_makeHookContext:function(B,z,y){var A,i;if(B.node!==f){if(z&&B.originalEvent!==z){c.error("invalid args")}A=B}else{if(B.tree){i=B.tree;A={node:B,tree:i,widget:i.widget,options:i.widget.options,originalEvent:z}}else{if(B.widget){A={node:null,tree:B,widget:B.widget,options:B.widget.options,originalEvent:z}}else{c.error("invalid args")}}}if(y){c.extend(A,y)}return A},_callHook:function(C,B,z){var i=this._makeHookContext(B),A=this[C],y=Array.prototype.slice.call(arguments,2);if(!c.isFunction(A)){c.error("_callHook('"+C+"') is not a function")}y.unshift(i);return A.apply(this,y)},_requireExtension:function(i,C,D,F){D=!!D;var y=this._local.name,A=this.options.extensions,z=c.inArray(i,A)<c.inArray(y,A),E=C&&this.ext[i]==null,B=!E&&(D!=null&&D!==z);k(y&&y!==i);if(E||B){if(!F){if(E||C){F="'"+y+"' extension requires '"+i+"'";if(B){F+=" to be registered "+(D?"before":"after")+" itself"}}else{F="If used together, `"+i+"` must be registered "+(D?"before":"after")+" `"+y+"`"}}c.error(F);return false}return true},activateKey:function(i){var y=this.getNodeByKey(i);if(y){y.setActive()}else{if(this.activeNode){this.activeNode.setActive(false)}}return y},applyPatch:function(z){var G,D,E,F,A,B,y=z.length,C=[];for(D=0;D<y;D++){E=z[D];k(E.length===2,"patchList must be an array of length-2-arrays");F=E[0];A=E[1];B=F===null?this.rootNode:this.getNodeByKey(F);if(B){G=new c.Deferred;C.push(G);B.applyPatch(A).always(r(G,B))}else{this.warn("could not find node with key '"+F+"'")}}return c.when.apply(c,C).promise()},count:function(){return this.rootNode.countChildren()},debug:function(i){if(this.options.debugLevel>=2){Array.prototype.unshift.call(arguments,this.toString());u("debug",arguments)}},generateFormElements:function(A,C){var y,z=A!==false?"ft_"+this._id:A,B=C!==false?"ft_"+this._id+"_active":C,D="fancytree_result_"+this._id,i=this.$container.find("div#"+D);if(i.length){i.empty()}else{i=c("<div>",{id:D}).hide().appendTo(this.$container)}if(z){y=this.getSelectedNodes(this.options.selectMode===3);c.each(y,function(E,F){i.append(c("<input>",{type:"checkbox",name:z,value:F.key,checked:true}))})}if(B&&this.activeNode){i.append(c("<input>",{type:"radio",name:B,value:this.activeNode.key,checked:true}))}},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(i){return this.focusNode},getNodeByKey:function(y,A){var z,i;if(!A){z=m.getElementById(this.options.idPrefix+y);if(z){return z.ftnode?z.ftnode:null}}A=A||this.rootNode;i=null;A.visit(function(B){if(B.key===y){i=B;return false}},true);return i},getSelectedNodes:function(i){var y=[];this.rootNode.visit(function(z){if(z.selected){y.push(z);if(i===true){return"skip"}}});return y},hasFocus:function(){return !!this._hasFocus},info:function(i){if(this.options.debugLevel>=1){Array.prototype.unshift.call(arguments,this.toString());u("info",arguments)}},loadKeyPath:function(F,I,B){var D,J,E,M,H,C,A,z,G=B||this.rootNode,L=this.options.keyPathSeparator,K=this;if(!c.isArray(F)){F=[F]}C={};for(E=0;E<F.length;E++){M=F[E];if(M.charAt(0)===L){M=M.substr(1)}z=M.split(L);while(z.length){H=z.shift();A=G._findDirectChild(H);if(!A){this.warn("loadKeyPath: key not found: "+H+" (parent: "+G+")");I.call(this,H,"error");break}else{if(z.length===0){I.call(this,A,"ok");break}else{if(!A.lazy||A.hasChildren()!==f){I.call(this,A,"loaded");G=A}else{I.call(this,A,"loaded");if(C[H]){C[H].push(z.join(L))}else{C[H]=[z.join(L)]}break}}}}}D=[];function y(N,O,i){I.call(K,O,"loading");O.load().done(function(){K.loadKeyPath.call(K,C[N],I,O).always(r(i,K))}).fail(function(P){K.warn("loadKeyPath: error loading: "+N+" (parent: "+G+")");I.call(K,O,"error");i.reject()})}for(H in C){A=G._findDirectChild(H);J=new c.Deferred;D.push(J);y(H,A,J)}return c.when.apply(c,D).promise()},reactivate:function(i){var y=this.activeNode;if(y){this.activeNode=null;y.setActive();if(i){y.setFocus()}}},reload:function(i){this._callHook("treeClear",this);return this._callHook("treeLoad",this,i)},render:function(y,i){return this.rootNode.render(y,i)},setFocus:function(i){return this._callHook("treeSetFocus",this,i)},toDict:function(i,z){var y=this.rootNode.toDict(true,z);return i?y:y.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(B,C,y,i){var z=this._makeHookContext(C,y,i),A=this.widget._trigger(B,y,z);if(A!==false&&z.result!==f){return z.result}return A},_triggerTreeEvent:function(A,i){var y=this._makeHookContext(this,i),z=this.widget._trigger(A,i,y);if(z!==false&&y.result!==f){return y.result}return z},visit:function(i){return this.rootNode.visit(i,false)},warn:function(i){Array.prototype.unshift.call(arguments,this.toString());u("warn",arguments)}};c.extend(g.prototype,{nodeClick:function(i){var z,y,B=i.originalEvent,C=i.targetType,A=i.node;if(C==="expander"){this._callHook("nodeToggleExpanded",i)}else{if(C==="checkbox"){this._callHook("nodeToggleSelected",i);this._callHook("nodeSetFocus",i,true)}else{y=false;z=true;if(A.folder){switch(i.options.clickFolderMode){case 2:y=true;z=false;break;case 3:z=true;y=true;break}}if(z){this.nodeSetFocus(i);this._callHook("nodeSetActive",i,true)}if(y){if(!z){}this._callHook("nodeToggleExpanded",i)}}}if(B.target.localName==="a"&&B.target.className==="fancytree-title"){B.preventDefault()}},nodeCollapseSiblings:function(A,y){var D,B,z,C=A.node;if(C.parent){D=C.parent.children;for(B=0,z=D.length;B<z;B++){if(D[B]!==C&&D[B].expanded){this._callHook("nodeSetExpanded",D[B],false,y)}}}},nodeDblclick:function(i){if(i.targetType==="title"&&i.options.clickFolderMode===4){this._callHook("nodeToggleExpanded",i)}if(i.targetType==="title"){i.originalEvent.preventDefault()}},nodeKeydown:function(D){var C,y=D.originalEvent,z=D.node,F=D.tree,i=D.options,B=true,A=!(y.ctrlKey||!i.autoActivate),E=c.ui.keyCode;if(!z){this.rootNode.getFirstChild().setFocus();z=D.node=this.focusNode;z.debug("Keydown force focus on first node")}switch(y.which){case E.NUMPAD_ADD:case 187:F.nodeSetExpanded(D,true);break;case E.NUMPAD_SUBTRACT:case 189:F.nodeSetExpanded(D,false);break;case E.SPACE:if(i.checkbox){F.nodeToggleSelected(D)}else{F.nodeSetActive(D,true)}break;case E.ENTER:F.nodeSetActive(D,true);break;case E.BACKSPACE:case E.LEFT:case E.RIGHT:case E.UP:case E.DOWN:C=z.navigate(y.which,A);break;default:B=false}if(B){y.preventDefault()}},nodeLoadChildren:function(y,C){var B,z,i=y.tree,A=y.node;if(c.isFunction(C)){C=C()}if(C.url){B=c.extend({},y.options.ajax,C);if(B.debugDelay){z=B.debugDelay;if(c.isArray(z)){z=z[0]+Math.random()*(z[1]-z[0])}A.debug("nodeLoadChildren waiting debug delay "+Math.round(z)+"ms");B.debugDelay=false;C=c.Deferred(function(D){setTimeout(function(){c.ajax(B).done(function(){D.resolveWith(this,arguments)}).fail(function(){D.rejectWith(this,arguments)})},z)})}else{C=c.ajax(B)}C=C.pipe(function(F,G,E){var D;if(typeof F==="string"){c.error("Ajax request returned a string (did you get the JSON dataType wrong?).")}if(y.options.postProcess){D=i._triggerNodeEvent("postProcess",y,y.originalEvent,{response:F,dataType:this.dataType});F=c.isArray(D)?D:F}else{if(F&&(F.hasOwnProperty("d")&&y.options.enableAspx)){F=typeof F.d==="string"?c.parseJSON(F.d):F.d}}return F},function(D,F,E){return i._makeHookContext(A,null,{error:D,args:Array.prototype.slice.call(arguments),message:E,details:D.status+": "+E})})}if(c.isFunction(C.promise)){k(!A.isLoading());A._isLoading=true;i.nodeSetStatus(y,"loading");C.done(function(){i.nodeSetStatus(y,"ok")}).fail(function(D){var E;if(D.node&&(D.error&&D.message)){E=D}else{E=i._makeHookContext(A,null,{error:D,args:Array.prototype.slice.call(arguments),message:D?D.message||D.toString():""})}i._triggerNodeEvent("loaderror",E,null);i.nodeSetStatus(y,"error",E.message,E.details)})}return c.when(C).done(function(E){var D;if(c.isPlainObject(E)){k(c.isArray(E.children),"source must contain (or be) an array of children");k(A.isRoot(),"source may only be an object for root nodes");D=E;E=E.children;delete D.children;c.extend(i.data,D)}k(c.isArray(E),"expected array of children");A._setChildren(E);i._triggerNodeEvent("loadChildren",A)}).always(function(){A._isLoading=false})},nodeLoadKeyPath:function(i,y){},nodeRemoveChild:function(y,A){var i,D=y.node,C=y.options,B=c.extend({},y,{node:A}),z=D.children;if(z.length===1){k(A===z[0]);return this.nodeRemoveChildren(y)}if(this.activeNode&&(A===this.activeNode||this.activeNode.isDescendantOf(A))){this.activeNode.setActive(false)}if(this.focusNode&&(A===this.focusNode||this.focusNode.isDescendantOf(A))){this.focusNode=null}this.nodeRemoveMarkup(B);this.nodeRemoveChildren(B);i=c.inArray(A,z);k(i>=0);A.visit(function(E){E.parent=null},true);if(C.removeNode){C.removeNode.call(y.tree,{type:"removeNode"},B)}z.splice(i,1)},nodeRemoveChildMarkup:function(i){var y=i.node;if(y.ul){if(y.isRoot()){c(y.ul).empty()}else{c(y.ul).remove();y.ul=null}y.visit(function(z){z.li=z.ul=null})}},nodeRemoveChildren:function(i){var B,A=i.node,y=A.children,z=i.options;if(!y){return}if(this.activeNode&&this.activeNode.isDescendantOf(A)){this.activeNode.setActive(false)}if(this.focusNode&&this.focusNode.isDescendantOf(A)){this.focusNode=null}this.nodeRemoveChildMarkup(i);B=c.extend({},i);A.visit(function(C){C.parent=null;if(z.removeNode){B.node=C;z.removeNode.call(i.tree,{type:"removeNode"},B)}});if(A.lazy){A.children=[]}else{A.children=null}this.nodeRenderStatus(i)},nodeRemoveMarkup:function(i){var y=i.node;if(y.li){c(y.li).remove();y.li=null}this.nodeRemoveChildMarkup(i)},nodeRender:function(N,y,P,C,A){var D,H,G,Q,O,K,R,M=N.node,J=N.tree,I=N.options,z=I.aria,E=false,F=M.parent,L=!F,B=M.children;if(!L&&!F.ul){return}k(L||F.ul,"parent UL must exist");if(!L){if(M.li&&(y||M.li.parentNode!==M.parent.ul)){if(M.li.parentNode!==M.parent.ul){this.warn("unlink "+M+" (must be child of "+M.parent+")")}this.nodeRemoveMarkup(N)}if(!M.li){E=true;M.li=m.createElement("li");M.li.ftnode=M;if(z){}if(M.key&&I.generateIds){M.li.id=I.idPrefix+M.key}M.span=m.createElement("span");M.span.className="fancytree-node";if(z){c(M.span).attr("aria-labelledby","ftal_"+M.key)}M.li.appendChild(M.span);this.nodeRenderTitle(N);if(I.createNode){I.createNode.call(J,{type:"createNode"},N)}}else{this.nodeRenderStatus(N)}if(I.renderNode){I.renderNode.call(J,{type:"renderNode"},N)}}if(B){if(L||(M.expanded||P===true)){if(!M.ul){M.ul=m.createElement("ul");if(C===true&&!A||!M.expanded){M.ul.style.display="none"}if(z){c(M.ul).attr("role","group")}if(M.li){M.li.appendChild(M.ul)}else{M.tree.$div.append(M.ul)}}for(Q=0,O=B.length;Q<O;Q++){R=c.extend({},N,{node:B[Q]});this.nodeRender(R,y,P,false,true)}D=M.ul.firstChild;while(D){G=D.ftnode;if(G&&G.parent!==M){M.debug("_fixParent: remove missing "+G,D);K=D.nextSibling;D.parentNode.removeChild(D);D=K}else{D=D.nextSibling}}D=M.ul.firstChild;for(Q=0,O=B.length-1;Q<O;Q++){H=B[Q];G=D.ftnode;if(H!==G){M.ul.insertBefore(H.li,G.li)}else{D=D.nextSibling}}}}else{if(M.ul){this.warn("remove child markup for "+M);this.nodeRemoveChildMarkup(N)}}if(!L){if(E){F.ul.appendChild(M.li)}}},nodeRenderTitle:function(J,H){var z,I,E,D,C,L,A=J.node,K=J.tree,i=J.options,G=i.aria,y=A.getLevel(),B=[],F=A.data.icon;if(H!==f){A.title=H}if(!A.span){return}if(y<i.minExpandLevel){if(y>1){if(G){B.push("<span role='button' class='fancytree-expander'></span>")}else{B.push("<span class='fancytree-expander'></span>")}}}else{if(G){B.push("<span role='button' class='fancytree-expander'></span>")}else{B.push("<span class='fancytree-expander'></span>")}}if(i.checkbox&&(A.hideCheckbox!==true&&!A.isStatusNode())){if(G){B.push("<span role='checkbox' class='fancytree-checkbox'></span>")}else{B.push("<span class='fancytree-checkbox'></span>")}}D=G?" role='img'":"";if(F&&typeof F==="string"){I=F.charAt(0)==="/"?F:i.imagePath+F;B.push("<img src='"+I+"' alt='' />")}else{if(A.data.iconclass){B.push("<span "+D+" class='fancytree-custom-icon "+A.data.iconclass+"'></span>")}else{if(F===true||F!==false&&i.icons!==false){B.push("<span "+D+" class='fancytree-icon'></span>")}}}E="";if(i.renderTitle){E=i.renderTitle.call(K,{type:"renderTitle"},J)||""}if(!E){L=A.tooltip?" title='"+A.tooltip.replace(/\"/g,"&quot;")+"'":"";z=G?" id='ftal_"+A.key+"'":"";D=G?" role='treeitem'":"";C=i.titlesTabbable?" tabindex='0'":"";E="<span "+D+" class='fancytree-title'"+z+L+C+">"+A.title+"</span>"}B.push(E);A.span.innerHTML=B.join("");this.nodeRenderStatus(J)},nodeRenderStatus:function(G){var y=G.node,H=G.tree,i=G.options,A=y.hasChildren(),C=y.isLastSibling(),D=i.aria,z=c(y.span).find(".fancytree-title"),F=i._classNames,E=[],B=y[H.statusClassPropName];if(!B){return}E.push(F.node);if(H.activeNode===y){E.push(F.active)}else{}if(H.focusNode===y){E.push(F.focused);if(D){z.attr("aria-activedescendant",true)}}else{if(D){z.removeAttr("aria-activedescendant")}}if(y.expanded){E.push(F.expanded);if(D){z.attr("aria-expanded",true)}}else{if(D){z.removeAttr("aria-expanded")}}if(y.folder){E.push(F.folder)}if(A!==false){E.push(F.hasChildren)}if(C){E.push(F.lastsib)}if(y.lazy&&y.children==null){E.push(F.lazy)}if(y.partsel){E.push(F.partsel)}if(y.selected){E.push(F.selected);if(D){z.attr("aria-selected",true)}}else{if(D){z.attr("aria-selected",false)}}if(y.extraClasses){E.push(y.extraClasses)}if(A===false){E.push(F.combinedExpanderPrefix+"n"+(C?"l":""))}else{E.push(F.combinedExpanderPrefix+(y.expanded?"e":"c")+(y.lazy&&y.children==null?"d":"")+(C?"l":""))}E.push(F.combinedIconPrefix+(y.expanded?"e":"c")+(y.folder?"f":""));B.className=E.join(" ");if(y.li){y.li.className=C?F.lastsib:""}},nodeSetActive:function(E,A,C){C=C||{};var z,y=E.node,F=E.tree,i=E.options,B=C.noEvents===true,D=y===F.activeNode;A=A!==false;if(D===A){return w(y)}else{if(A&&(!B&&this._triggerNodeEvent("beforeActivate",y,E.originalEvent)===false)){return o(y,["rejected"])}}if(A){if(F.activeNode){k(F.activeNode!==y,"node was active (inconsistency)");z=c.extend({},E,{node:F.activeNode});F.nodeSetActive(z,false);k(F.activeNode===null,"deactivate was out of sync?")}if(i.activeVisible){y.makeVisible()}F.activeNode=y;F.nodeRenderStatus(E);F.nodeSetFocus(E);if(!B){F._triggerNodeEvent("activate",y)}}else{k(F.activeNode===y,"node was not active (inconsistency)");F.activeNode=null;this.nodeRenderStatus(E);if(!B){E.tree._triggerNodeEvent("deactivate",y)}}},nodeSetExpanded:function(K,F,I){I=I||{};var H,J,D,B,G,z,A=K.node,L=K.tree,y=K.options,C=I.noAnimation===true,E=I.noEvents===true;F=F!==false;if(A.expanded&&F||!A.expanded&&!F){return w(A)}else{if(F&&(!A.lazy&&!A.hasChildren())){return w(A)}else{if(!F&&A.getLevel()<y.minExpandLevel){return o(A,["locked"])}else{if(!E&&this._triggerNodeEvent("beforeExpand",A,K.originalEvent)===false){return o(A,["rejected"])}}}}if(!C&&!A.isVisible()){C=I.noAnimation=true}J=new c.Deferred;if(F&&(!A.expanded&&y.autoCollapse)){G=A.getParentList(false,true);z=y.autoCollapse;try{y.autoCollapse=false;for(D=0,B=G.length;D<B;D++){this._callHook("nodeCollapseSiblings",G[D],I)}}finally{y.autoCollapse=z}}J.done(function(){if(!E){K.tree._triggerNodeEvent(F?"expand":"collapse",K)}if(y.autoScroll&&(!C&&A.hasChildren())){A.getLastChild().scrollIntoView(true,A)}});H=function(P){var M,O,i,N;A.expanded=F;L._callHook("nodeRender",K,false,false,true);if(A.ul){i=A.ul.style.display!=="none";N=!!A.expanded;if(i===N){A.warn("nodeSetExpanded: UL.style.display already set")}else{if(!y.fx||C){A.ul.style.display=A.expanded||!parent?"":"none"}else{M=y.fx.duration||200;O=y.fx.easing;c(A.ul).animate(y.fx,M,O,function(){P()});return}}}P()};if(F&&(A.lazy&&A.hasChildren()===f)){A.load().done(function(){if(J.notifyWith){J.notifyWith(A,["loaded"])}H(function(){J.resolveWith(A)})}).fail(function(i){H(function(){J.rejectWith(A,["load failed ("+i+")"])})})}else{H(function(){J.resolveWith(A)})}return J.promise()},nodeSetFocus:function(A,z){var y,i=A.tree,B=A.node;z=z!==false;if(i.focusNode){if(i.focusNode===B&&z){return}y=c.extend({},A,{node:i.focusNode});i.focusNode=null;this._triggerNodeEvent("blur",y);this._callHook("nodeRenderStatus",y)}if(z){if(!this.hasFocus()){B.debug("nodeSetFocus: forcing container focus");this._callHook("treeSetFocus",A,true,true)}B.makeVisible();i.focusNode=B;this._triggerNodeEvent("focus",A);if(A.options.autoScroll){B.scrollIntoView()}this._callHook("nodeRenderStatus",A)}},nodeSetSelected:function(z,y){var B=z.node,i=z.tree,A=z.options;y=y!==false;B.debug("nodeSetSelected("+y+")",z);if(B.unselectable){return}if(B.selected&&y||!B.selected&&!y){return !!B.selected}else{if(this._triggerNodeEvent("beforeSelect",B,z.originalEvent)===false){return !!B.selected}}if(y&&A.selectMode===1){if(i.lastSelectedNode){i.lastSelectedNode.setSelected(false)}}else{if(A.selectMode===3){B.selected=y;B.fixSelection3AfterClick()}}B.selected=y;this.nodeRenderStatus(z);i.lastSelectedNode=y?B:null;i._triggerNodeEvent("select",z)},nodeSetStatus:function(D,z,E,i){var y=D.node,F=D.tree,B=D.options._classNames;function C(){var H=y.children?y.children[0]:null;if(H&&H.isStatusNode()){try{if(y.ul){y.ul.removeChild(H.li);H.li=null}}catch(G){}if(y.children.length===1){y.children=[]}else{y.children.shift()}}}function A(H,G){var I=y.children?y.children[0]:null;if(I&&I.isStatusNode()){c.extend(I,H);F._callHook("nodeRender",I)}else{H.key="_statusNode";y._setChildren([H]);y.children[0].statusNodeType=G;F.render()}return y.children[0]}switch(z){case"ok":C();c(y.span).removeClass(B.loading);c(y.span).removeClass(B.error);break;case"loading":c(y.span).removeClass(B.error);c(y.span).addClass(B.loading);if(!y.parent){A({title:F.options.strings.loading+(E?" ("+E+") ":""),tooltip:i,extraClasses:"fancytree-statusnode-wait"},z)}break;case"error":c(y.span).removeClass(B.loading);c(y.span).addClass(B.error);A({title:F.options.strings.loadError+(E?" ("+E+") ":""),tooltip:i,extraClasses:"fancytree-statusnode-error"},z);break;default:c.error("invalid status "+z)}},nodeToggleExpanded:function(i){return this.nodeSetExpanded(i,!i.node.expanded)},nodeToggleSelected:function(i){return this.nodeSetSelected(i,!i.node.selected)},treeClear:function(y){var i=y.tree;i.activeNode=null;i.focusNode=null;i.$div.find(">ul.fancytree-container").empty();i.rootNode.children=null},treeCreate:function(i){},treeDestroy:function(i){},treeInit:function(i){this.treeLoad(i)},treeLoad:function(A,D){var C,B,z=A.tree,E=A.widget.element,y,i=c.extend({},A,{node:this.rootNode});if(z.rootNode.children){this.treeClear(A)}D=D||this.options.source;if(!D){C=E.data("type")||"html";switch(C){case"html":B=E.find(">ul:first");B.addClass("ui-fancytree-source ui-helper-hidden");D=c.ui.fancytree.parseHtml(B);break;case"json":D=c.parseJSON(E.text());if(D.children){if(D.title){z.title=D.title}D=D.children}break;default:c.error("Invalid data-type: "+C)}}else{if(typeof D==="string"){s()}}y=this.nodeLoadChildren(i,D).done(function(){z.render();if(A.options.selectMode===3){z.rootNode.fixSelection3FromEndNodes()}z._triggerTreeEvent("init",true)}).fail(function(){z.render();z._triggerTreeEvent("init",false)});return y},treeSetFocus:function(y,i,z){i=i!==false;if(i!==this.hasFocus()){this._hasFocus=i;this.$container.toggleClass("fancytree-treefocus",i);this._triggerTreeEvent(i?"focusTree":"blurTree")}}});c.widget("ui.fancytree",{options:{activeVisible:true,ajax:{type:"GET",cache:false,dataType:"json"},aria:false,autoActivate:true,autoCollapse:false,autoScroll:false,checkbox:false,clickFolderMode:4,debugLevel:null,disabled:false,enableAspx:true,extensions:[],fx:{height:"toggle",duration:200},generateIds:false,icons:true,idPrefix:"ft_",keyboard:true,keyPathSeparator:"/",minExpandLevel:1,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!"},tabbable:true,titlesTabbable:false,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partsel:"fancytree-partsel",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new g(this);this.$source=this.source||this.element.data("type")==="json"?this.element:this.element.find(">ul:first");var C,A,y,z=this.options.extensions,B=this.tree;for(y=0;y<z.length;y++){A=z[y];C=c.ui.fancytree._extensions[A];if(!C){c.error("Could not apply extension '"+A+"' (it is not registered, did you forget to include it?)")}this.tree.options[A]=c.extend(true,{},C.options,this.tree.options[A]);k(this.tree.ext[A]===f,"Extension name must not exist as Fancytree.ext attribute: '"+A+"'");this.tree.ext[A]={};d(this.tree,B,C,A);B=C}this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree);this._bind()},_setOption:function(i,z){var A=true,y=false;switch(i){case"aria":case"checkbox":case"icons":case"minExpandLevel":case"tabbable":this.tree._callHook("treeCreate",this.tree);y=true;break;case"source":A=false;this.tree._callHook("treeLoad",this.tree,z);break}this.tree.debug("set option "+i+"="+z+" <"+typeof z+">");if(A){c.Widget.prototype._setOption.apply(this,arguments)}if(y){this.tree.render(true,false)}},destroy:function(){this._unbind();this.tree._callHook("treeDestroy",this.tree);this.tree.$div.find(">ul.fancytree-container").remove();this.$source&&this.$source.removeClass("ui-helper-hidden");c.Widget.prototype.destroy.call(this)},_unbind:function(){var i=this.tree._ns;this.element.unbind(i);this.tree.$container.unbind(i);c(m).unbind(i)},_bind:function(){var A=this,z=this.options,i=this.tree,y=i._ns;this._unbind();i.$container.on("focusin"+y+" focusout"+y,function(D){var C=a.getNode(D),B=D.type==="focusin";if(C){i._callHook("nodeSetFocus",C,B)}else{i._callHook("treeSetFocus",i,B)}}).on("selectstart"+y,"span.fancytree-title",function(B){B.preventDefault()}).on("keydown"+y,function(F){if(z.disabled||z.keyboard===false){return true}var D,E=i.focusNode,B=i._makeHookContext(E||i,F),C=i.phase;try{i.phase="userEvent";if(E){D=i._triggerNodeEvent("keydown",E,F)}else{D=i._triggerTreeEvent("keydown",F)}if(D==="preventNav"){D=true}else{if(D!==false){D=i._callHook("nodeKeydown",B)}}return D}finally{i.phase=C}}).on("click"+y+" dblclick"+y,function(F){if(z.disabled){return true}var C,G=a.getEventTarget(F),E=G.node,B=A.tree,D=B.phase;if(!E){return true}C=B._makeHookContext(E,F);try{B.phase="userEvent";switch(F.type){case"click":C.targetType=G.type;return B._triggerNodeEvent("click",C,F)===false?false:B._callHook("nodeClick",C);case"dblclick":C.targetType=G.type;return B._triggerNodeEvent("dblclick",C,F)===false?false:B._callHook("nodeDblclick",C)}}finally{B.phase=D}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(i){return this.tree.getNodeByKey(i)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}});a=c.ui.fancytree;c.extend(c.ui.fancytree,{version:"development",buildType:"develop",debugLevel:2,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:g,_FancytreeNodeClass:b,jquerySupports:{positionMyOfs:l(c.ui.version,1,9)},assert:function(i,y){return k(i,y)},debug:function(i){c.ui.fancytree.debugLevel>=2&&u("log",arguments)},error:function(i){u("error",arguments)},getEventTargetType:function(i){return this.getEventTarget(i).type},getEventTarget:function(y){var z=y&&y.target?y.target.className:"",i={node:this.getNode(y.target),type:f};if(/\bfancytree-title\b/.test(z)){i.type="title"}else{if(/\bfancytree-expander\b/.test(z)){i.type=i.node.hasChildren()===false?"prefix":"expander"}else{if(/\bfancytree-checkbox\b/.test(z)||/\bfancytree-radio\b/.test(z)){i.type="checkbox"}else{if(/\bfancytree-icon\b/.test(z)){i.type="icon"}else{if(/\bfancytree-node\b/.test(z)){i.type="title"}}}}}return i},getNode:function(i){if(i instanceof b){return i}else{if(i.selector!==f){i=i[0]}else{if(i.originalEvent!==f){i=i.target}}}while(i){if(i.ftnode){return i.ftnode}i=i.parentNode}return null},info:function(i){c.ui.fancytree.debugLevel>=1&&u("info",arguments)},parseHtml:function(F){var H=F.find(">li"),B,D,A,C,E,z,G,y=[];H.each(function(){var K,J,M=c(this),I=M.find(">span:first",this),i=I.length?null:M.find(">a:first"),L={tooltip:null,data:{}};if(I.length){L.title=I.html()}else{if(i&&i.length){L.title=i.html();L.data.href=i.attr("href");L.data.target=i.attr("target");L.tooltip=i.attr("title")}else{L.title=M.html();C=L.title.search(/<ul/i);if(C>=0){L.title=L.title.substring(0,C)}}}L.title=c.trim(L.title);for(D=0,A=x.length;D<A;D++){L[x[D]]=f}z=this.className.split(" ");B=[];for(D=0,A=z.length;D<A;D++){G=z[D];if(e[G]){L[G]=true}else{B.push(G)}}L.extraClasses=B.join(" ");E=M.attr("title");if(E){L.tooltip=E}E=M.attr("id");if(E){L.key=E}K=M.data();if(K&&!c.isEmptyObject(K)){J=K.json;delete K.json;c.extend(L.data,K);if(J){c.extend(L.data,J)}}F=M.find(">ul:first");if(F.length){L.children=c.ui.fancytree.parseHtml(F)}else{L.children=L.lazy?f:null}y.push(L)});return y},registerExtension:function(i){k(i.name!=null,"extensions must have a `name` property.");k(i.version!=null,"extensions must have a `version` property.");c.ui.fancytree._extensions[i.name]=i},warn:function(i){u("warn",arguments)}})})(jQuery,window,document);(function(c,b,a,e){function d(g,f){return g.map[f]}c.ui.fancytree.registerExtension({name:"glyph",version:"0.0.1",options:{prefix:"icon-",extra:null,map:{doc:"icon-file-alt",docOpen:"icon-file-alt",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt",loading:"icon-refresh icon-spin"},icon:null},treeInit:function(g){var f=g.tree;this._super(g);f.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(f){var h,g,j=f.node,i=f.options.glyph,k=i.map;this._super(f);if(j.isRoot()){return}g=c("span.fancytree-expander",j.span).get(0);if(g){if(j.isLoading()){h="loading"}else{if(j.expanded){h="expanderOpen"}else{if(j.isUndefined()){h="expanderLazy"}else{h="expanderClosed"}}}g.className="fancytree-expander "+k[h]}g=c("span.fancytree-checkbox",j.span).get(0);if(g){h=j.selected?"checkboxSelected":j.partsel?"checkboxUnknown":"checkbox";g.className="fancytree-checkbox "+k[h]}g=c("span.fancytree-icon",j.span).get(0);if(g){if(j.folder){h=j.expanded?d(i,"folderOpen"):d(i,"folder")}else{h=j.expanded?d(i,"docOpen"):d(i,"doc")}g.className="fancytree-icon "+h}},nodeSetStatus:function(g,f,l,h){var i,k=g.options.glyph,j=g.node;this._super(g,f,l,h);if(j.parent){i=c("span.fancytree-expander",j.span).get(0)}else{i=c("span.fancytree-statusnode-wait, span.fancytree-statusnode-error",j.span).find("span.fancytree-expander").get(0)}if(f==="loading"){i.className="fancytree-expander "+d(k,"loading")}else{if(f==="error"){i.className="fancytree-expander "+d(k,"error")}}}})})(jQuery,window,document);(function(a,b){a.ui.fancytree._FancytreeClass.prototype.countSelected=function(d){var c=this,e=c.options;return c.getSelectedNodes(d).length};a.ui.fancytree._FancytreeNodeClass.prototype.toUpper=function(){var c=this;return c.setTitle(c.title.toUpperCase())};a.ui.fancytree.prototype.widgetMethod1=function(d){var c=this.tree;return d};a.ui.fancytree.registerExtension({name:"childcounter",version:"1.0.0",options:{deep:true,hideZeros:true,hideExpanded:false},foo:42,_appendCounter:function(d){var c=this},treeInit:function(d){var c=this,e=d.options,f=d.options.childcounter;this._super(d);this.$container.addClass("fancytree-ext-childcounter")},treeDestroy:function(c){this._super(c)},nodeRenderTitle:function(c,g){var e=c.node,f=c.options.childcounter,d=e.countChildren(f.deep);this._super(c,g);if((d||!f.hideZeros)&&(!e.isExpanded()||!f.hideExpanded)){a("span.fancytree-icon",e.span).append(a("<span class='fancytree-childcounter'/>").text(d))}},nodeSetExpanded:function(e,d,g){var c=e.tree,f=e.node;return this._super(e,d,g).always(function(){c.nodeRenderTitle(e)})}})})(jQuery);(function(d,e,f,b){var i=d.ui.fancytree.debug,c=false;function h(j){return j===0?"":j>0?"+"+j:""+j}function g(j){var k=j.options.dnd||null;if(k){a()}if(k&&k.dragStart){j.widget.element.draggable({addClasses:false,appendTo:"body",containment:false,delay:0,distance:4,revert:false,scroll:true,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:true,helper:function(m){var l=d.ui.fancytree.getNode(m.target);if(!l){return"<div>ERROR?: helper requested but sourceNode not found</div>"}return l.tree.ext.dnd._onDragEvent("helper",l,null,m,null,null)},start:function(m,n){var l=n.helper.data("ftSourceNode");return !!l}})}if(k&&k.dragDrop){j.widget.element.droppable({addClasses:false,tolerance:"intersect",greedy:false})}}function a(){if(c){return}d.ui.plugin.add("draggable","connectToFancytree",{start:function(l,m){var j=d(this).data("ui-draggable")||d(this).data("draggable"),k=m.helper.data("ftSourceNode")||null;if(k){j.offset.click.top=-2;j.offset.click.left=+16;return k.tree.ext.dnd._onDragEvent("start",k,null,l,m,j)}},drag:function(m,n){var k,j=d(this).data("ui-draggable")||d(this).data("draggable"),l=n.helper.data("ftSourceNode")||null,p=n.helper.data("ftTargetNode")||null,o=d.ui.fancytree.getNode(m.target);if(m.target&&!o){k=d(m.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0;if(k){i("Drag event over helper: ignored.");return}}n.helper.data("ftTargetNode",o);if(p&&p!==o){p.tree.ext.dnd._onDragEvent("leave",p,l,m,n,j)}if(o){if(!o.tree.options.dnd.dragDrop){}else{if(o===p){o.tree.ext.dnd._onDragEvent("over",o,l,m,n,j)}else{o.tree.ext.dnd._onDragEvent("enter",o,l,m,n,j)}}}},stop:function(m,n){var j=d(this).data("ui-draggable")||d(this).data("draggable"),l=n.helper.data("ftSourceNode")||null,o=n.helper.data("ftTargetNode")||null,k=m.type,p=k==="mouseup"&&m.which===1;if(!p){i("Drag was cancelled")}if(o){if(p){o.tree.ext.dnd._onDragEvent("drop",o,l,m,n,j)}o.tree.ext.dnd._onDragEvent("leave",o,l,m,n,j)}if(l){l.tree.ext.dnd._onDragEvent("stop",l,null,m,n,j)}}});c=true}d.ui.fancytree.registerExtension({name:"dnd",version:"0.1.0",options:{dragStart:null,dragStop:null,autoExpandMS:1000,preventVoidMoves:true,preventRecursiveMoves:true,dragEnter:null,dragOver:null,dragDrop:null,dragLeave:null},treeInit:function(k){var j=k.tree;this._super(k);g(j)},nodeKeydown:function(j){var k=j.originalEvent;if(k.which===d.ui.keyCode.ESCAPE){this._local._cancelDrag()}return this._super(j)},_setDndStatus:function(m,r,l,o,n){var j,p=0,s="center",t=this._local,q=m?d(m.span):null,k=d(r.span);if(!t.$dropMarker){t.$dropMarker=d("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1000}).prependTo(d(this.$div).parent())}if(o==="after"||(o==="before"||o==="over")){switch(o){case"before":t.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-over");t.$dropMarker.addClass("fancytree-drop-before");s="top";break;case"after":t.$dropMarker.removeClass("fancytree-drop-before fancytree-drop-over");t.$dropMarker.addClass("fancytree-drop-after");s="bottom";break;default:t.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-before");t.$dropMarker.addClass("fancytree-drop-over");k.addClass("fancytree-drop-target");p=8}if(d.ui.fancytree.jquerySupports.positionMyOfs){j={my:"left"+h(p)+" center",at:"left "+s,of:k}}else{j={my:"left center",at:"left "+s,of:k,offset:""+p+" 0"}}t.$dropMarker.show().position(j)}else{k.removeClass("fancytree-drop-target");t.$dropMarker.hide()}if(o==="after"){k.addClass("fancytree-drop-after")}else{k.removeClass("fancytree-drop-after")}if(o==="before"){k.addClass("fancytree-drop-before")}else{k.removeClass("fancytree-drop-before")}if(n===true){if(q){q.addClass("fancytree-drop-accept")}k.addClass("fancytree-drop-accept");l.addClass("fancytree-drop-accept")}else{if(q){q.removeClass("fancytree-drop-accept")}k.removeClass("fancytree-drop-accept");l.removeClass("fancytree-drop-accept")}if(n===false){if(q){q.addClass("fancytree-drop-reject")}k.addClass("fancytree-drop-reject");l.addClass("fancytree-drop-reject")}else{if(q){q.removeClass("fancytree-drop-reject")}k.removeClass("fancytree-drop-reject");l.removeClass("fancytree-drop-reject")}},_onDragEvent:function(n,v,u,x,s,l){if(n!=="over"){i("tree.ext.dnd._onDragEvent(%s, %o, %o) - %o",n,v,u,this)}var m,y,A,o,k,z,q,p=this.options,t=p.dnd,w=this._makeHookContext(v,x,{otherNode:u,ui:s,draggable:l}),B=null,j=d(v.span);switch(n){case"helper":m=d("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").append(j.find("span.fancytree-title").clone());d("ul.fancytree-container",v.tree.$div).append(m);m.data("ftSourceNode",v);B=m;break;case"start":if(v.isStatusNode()){B=false}else{if(t.dragStart){B=t.dragStart(v,w)}}if(B===false){this.debug("tree.dragStart() cancelled");s.helper.trigger("mouseup");s.helper.hide()}else{j.addClass("fancytree-drag-source")}break;case"enter":if(t.preventRecursiveMoves&&v.isDescendantOf(u)){q=false}else{q=t.dragEnter?t.dragEnter(v,w):null}if(!q){B=false}else{if(d.isArray(q)){B={over:d.inArray("over",q)>=0,before:d.inArray("before",q)>=0,after:d.inArray("after",q)>=0}}else{B={over:q===true||q==="over",before:q===true||q==="before",after:q===true||q==="after"}}}s.helper.data("enterResponse",B);i("helper.enterResponse: %o",B);break;case"over":k=s.helper.data("enterResponse");z=null;if(k===false){}else{if(typeof k==="string"){z=k}else{y=j.offset();A={x:x.pageX-y.left,y:x.pageY-y.top};o={x:A.x/j.width(),y:A.y/j.height()};if(k.after&&o.y>0.75){z="after"}else{if(!k.over&&(k.after&&o.y>0.5)){z="after"}else{if(k.before&&o.y<=0.25){z="before"}else{if(!k.over&&(k.before&&o.y<=0.5)){z="before"}else{if(k.over){z="over"}}}}}if(t.preventVoidMoves){if(v===u){i("    drop over source node prevented");z=null}else{if(z==="before"&&(u&&v===u.getNextSibling())){i("    drop after source node prevented");z=null}else{if(z==="after"&&(u&&v===u.getPrevSibling())){i("    drop before source node prevented");z=null}else{if(z==="over"&&(u&&(u.parent===v&&u.isLastSibling()))){i("    drop last child over own parent prevented");z=null}}}}}s.helper.data("hitMode",z)}}if(z==="over"&&(t.autoExpandMS&&(v.hasChildren()!==false&&!v.expanded))){v.scheduleAction("expand",t.autoExpandMS)}if(z&&t.dragOver){w.hitMode=z;B=t.dragOver(v,w)}this._local._setDndStatus(u,v,s.helper,z,B!==false&&z!==null);break;case"drop":z=s.helper.data("hitMode");if(z&&t.dragDrop){w.hitMode=z;t.dragDrop(v,w)}break;case"leave":v.scheduleAction("cancel");s.helper.data("enterResponse",null);s.helper.data("hitMode",null);this._local._setDndStatus(u,v,s.helper,"out",b);if(t.dragLeave){t.dragLeave(v,w)}break;case"stop":j.removeClass("fancytree-drag-source");if(t.dragStop){t.dragStop(v,w)}break;default:throw"Unsupported drag event: "+n}return B},_cancelDrag:function(){var j=d.ui.ddmanager.current;if(j){j.cancel()}}})})(jQuery,window,document);(function(d,c,b,e){function a(f){return(f+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}d.ui.fancytree._FancytreeClass.prototype.applyFilter=function(i){var f,h,j=0,g=this.options.filter.leavesOnly;if(typeof i==="string"){f=a(i);h=new RegExp(".*"+f+".*","i");i=function(k){return !!h.exec(k.title)}}this.enableFilter=true;this.$div.addClass("fancytree-ext-filter");if(this.options.filter.mode==="hide"){this.$div.addClass("fancytree-ext-filter-hide")}else{this.$div.addClass("fancytree-ext-filter-dimm")}this.visit(function(k){k.hide=true;delete k.match;delete k.subMatch});this.visit(function(k){if((!g||k.children==null)&&i(k)){j++;k.hide=false;k.match=true;k.visitParents(function(l){l.hide=false;l.subMatch=true})}});this.render();return j};d.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){this.visit(function(f){delete f.hide;delete f.match;delete f.subMatch});this.enableFilter=false;this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide");this.render()};d.ui.fancytree.registerExtension({name:"filter",version:"0.0.2",options:{mode:"dimm",leavesOnly:false},treeInit:function(f){this._super(f)},treeDestroy:function(f){this._super(f)},nodeRenderStatus:function(h){var i,j=h.node,f=h.tree,g=d(j[f.statusClassPropName]);i=this._super(h);if(!g.length){return i}if(!f.enableFilter){return i}g.toggleClass("fancytree-match",!!j.match);g.toggleClass("fancytree-submatch",!!j.subMatch);g.toggleClass("fancytree-hide",!!j.hide);return i}})})(jQuery,window,document);