/*!
 * Justified Gallery - v3.4.0
 * http://miromannino.com/projects/justified-gallery/
 * Copyright (c) 2014 Miro Mannino
 * Licensed under the MIT license.
 */
!function(b){b.fn.justifiedGallery=function(R){function Q(f,e,h){var g;return g=f>e?f:e,100>=g?h.settings.sizeRangeSuffixes.lt100:240>=g?h.settings.sizeRangeSuffixes.lt240:320>=g?h.settings.sizeRangeSuffixes.lt320:500>=g?h.settings.sizeRangeSuffixes.lt500:640>=g?h.settings.sizeRangeSuffixes.lt640:h.settings.sizeRangeSuffixes.lt1024}function P(d,c){return -1!==d.indexOf(c,d.length-c.length)}function O(d,c){return d.substring(0,d.length-c.length)}function N(f,d){var h=!1;for(var g in d.settings.sizeRangeSuffixes){if(0!==d.settings.sizeRangeSuffixes[g].length){if(P(f,d.settings.sizeRangeSuffixes[g])){return d.settings.sizeRangeSuffixes[g]}}else{h=!0}}if(h){return""}throw"unknown suffix for "+f}function M(e,c,n,m){var l=e.match(m.settings.extension),k=null!=l?l[0]:"",f=e.replace(m.settings.extension,"");return f=O(f,N(f,m)),f+=Q(c,n,m)+k}function L(d){var e=b(d.currentTarget).find(".caption");d.data.settings.cssAnimation?e.addClass("caption-visible").removeClass("caption-hidden"):e.stop().fadeTo(d.data.settings.captionSettings.animationDuration,d.data.settings.captionSettings.visibleOpacity)}function K(d){var e=b(d.currentTarget).find(".caption");d.data.settings.cssAnimation?e.removeClass("caption-visible").removeClass("caption-hidden"):e.stop().fadeTo(d.data.settings.captionSettings.animationDuration,d.data.settings.captionSettings.nonVisibleOpacity)}function J(e,d,f){f.settings.cssAnimation?(e.addClass("entry-visible"),d()):e.stop().fadeTo(f.settings.imagesAnimationDuration,1,d)}function I(d,c){c.settings.cssAnimation?d.removeClass("entry-visible"):d.stop().fadeTo(0,0)}function H(W,V,U,T,S,w,v){function u(){j!==i&&t.attr("src",i)}var t=W.find("img");t.css("width",T),t.css("height",S),t.css("margin-left",-T/2),t.css("margin-top",-S/2),W.width(T),W.height(w),W.css("top",U),W.css("left",V);var j=t.attr("src"),i=M(j,T,S,v);t.one("error",function(){t.attr("src",t.data("jg.originalSrc"))}),"skipped"===t.data("jg.loaded")?t.one("load",function(){J(W,u,v),t.data("jg.loaded","loaded")}):J(W,u,v);var h=W.data("jg.captionMouseEvents");if(v.settings.captions===!0){var g=W.find(".caption");if(0===g.length){var X=t.attr("alt");"undefined"==typeof X&&(X=W.attr("title")),"undefined"!=typeof X&&(g=b('<div class="caption">'+X+"</div>"),W.append(g))}0!==g.length&&(v.settings.cssAnimation||g.stop().fadeTo(v.settings.imagesAnimationDuration,v.settings.captionSettings.nonVisibleOpacity),"undefined"==typeof h&&(h={mouseenter:L,mouseleave:K},W.on("mouseenter",void 0,v,h.mouseenter),W.on("mouseleave",void 0,v,h.mouseleave),W.data("jg.captionMouseEvents",h)))}else{"undefined"!=typeof h&&(W.off("mouseenter",void 0,v,h.mouseenter),W.off("mouseleave",void 0,v,h.mouseleave),W.removeData("jg.captionMouseEvents"))}}function G(W,V){var U,T,S,w,v,u,t=W.settings,s=!0,r=0,q=W.galleryWidth-(W.buildingRow.entriesBuff.length-1)*t.margins,p=q/W.buildingRow.aspectRatio,o=W.buildingRow.width/q>t.justifyThreshold;if(V&&"hide"===t.lastRow&&!o){for(U=0;U<W.buildingRow.entriesBuff.length;U++){T=W.buildingRow.entriesBuff[U],t.cssAnimation?T.removeClass("entry-visible"):T.stop().fadeTo(0,0)}return -1}for(V&&!o&&"nojustify"===t.lastRow&&(s=!1),U=0;U<W.buildingRow.entriesBuff.length;U++){S=W.buildingRow.entriesBuff[U].find("img"),w=S.data("jg.imgw")/S.data("jg.imgh"),s?(v=p*w,u=p):(v=t.rowHeight*w,u=t.rowHeight),S.data("jg.jimgw",Math.ceil(v)),S.data("jg.jimgh",Math.ceil(u)),(0===U||r>u)&&(r=u)}return t.fixedHeight&&r>t.rowHeight&&(r=t.rowHeight),{minHeight:r,justify:s}}function F(c){c.lastAnalyzedIndex=-1,c.buildingRow.entriesBuff=[],c.buildingRow.aspectRatio=0,c.buildingRow.width=0,c.offY=0}function E(r,q){var p,o,n,m,l=r.settings,k=0;if(m=G(r,q),n=m.minHeight,q&&"hide"===l.lastRow&&-1===n){return r.buildingRow.entriesBuff=[],r.buildingRow.aspectRatio=0,void (r.buildingRow.width=0)}l.maxRowHeight>0&&l.maxRowHeight<n?n=l.maxRowHeight:0===l.maxRowHeight&&1.5*l.rowHeight<n&&(n=1.5*l.rowHeight);for(var j=0;j<r.buildingRow.entriesBuff.length;j++){p=r.buildingRow.entriesBuff[j],o=p.find("img"),H(p,k,r.offY,o.data("jg.jimgw"),o.data("jg.jimgh"),n,r),k+=o.data("jg.jimgw")+l.margins}r.$gallery.height(r.offY+n+(r.spinner.active?r.spinner.$el.innerHeight():0)),(!q||n<=r.settings.rowHeight&&m.justify)&&(r.offY+=n+r.settings.margins,r.buildingRow.entriesBuff=[],r.buildingRow.aspectRatio=0,r.buildingRow.width=0,r.$gallery.trigger("jg.rowflush"))}function D(c){c.checkWidthIntervalId=setInterval(function(){var d=parseInt(c.$gallery.width(),10);c.galleryWidth!==d&&(c.galleryWidth=d,F(c),z(c,!0))},c.settings.refreshTime)}function C(c){clearInterval(c.intervalId),c.intervalId=setInterval(function(){c.phase<c.$points.length?c.$points.eq(c.phase).fadeTo(c.timeslot,1):c.$points.eq(c.phase-c.$points.length).fadeTo(c.timeslot,0),c.phase=(c.phase+1)%(2*c.$points.length)},c.timeslot)}function B(c){clearInterval(c.intervalId),c.intervalId=null}function A(c){c.yield.flushed=0,null!==c.imgAnalyzerTimeout&&clearTimeout(c.imgAnalyzerTimeout)}function z(d,c){A(d),d.imgAnalyzerTimeout=setTimeout(function(){y(d,c)},0.001),y(d,c)}function y(s,r){for(var q,p=s.settings,o=s.lastAnalyzedIndex+1;o<s.entries.length;o++){var n=b(s.entries[o]),m=n.find("img");if(m.data("jg.loaded")===!0||"skipped"===m.data("jg.loaded")){q=o>=s.entries.length-1;var l=s.galleryWidth-(s.buildingRow.entriesBuff.length-1)*p.margins,k=m.data("jg.imgw")/m.data("jg.imgh");if(l/(s.buildingRow.aspectRatio+k)<p.rowHeight&&(E(s,q),++s.yield.flushed>=s.yield.every)){return void z(s,r)}s.buildingRow.entriesBuff.push(n),s.buildingRow.aspectRatio+=k,s.buildingRow.width+=k*p.rowHeight,s.lastAnalyzedIndex=o}else{if("error"!==m.data("jg.loaded")){return}}}s.buildingRow.entriesBuff.length>0&&E(s,!0),s.spinner.active&&(s.spinner.active=!1,s.$gallery.height(s.$gallery.height()-s.spinner.$el.innerHeight()),s.spinner.$el.detach(),B(s.spinner)),A(s),s.$gallery.trigger(r?"jg.resize":"jg.complete")}function x(f){function e(c){if("string"!=typeof g.sizeRangeSuffixes[c]){throw"sizeRangeSuffixes."+c+" must be a string"}}function h(d,c){if("string"==typeof d[c]){if(d[c]=parseFloat(d[c],10),isNaN(d[c])){throw"invalid number for "+c}}else{if("number"!=typeof d[c]){throw c+" must be a number"}if(isNaN(d[c])){throw"invalid number for "+c}}}var g=f.settings;if("object"!=typeof g.sizeRangeSuffixes){throw"sizeRangeSuffixes must be defined and must be an object"}if(e("lt100"),e("lt240"),e("lt320"),e("lt500"),e("lt640"),e("lt1024"),h(g,"rowHeight"),h(g,"maxRowHeight"),g.maxRowHeight>0&&g.maxRowHeight<g.rowHeight&&(g.maxRowHeight=g.rowHeight),h(g,"margins"),"nojustify"!==g.lastRow&&"justify"!==g.lastRow&&"hide"!==g.lastRow){throw'lastRow must be "nojustify", "justify" or "hide"'}if(h(g,"justifyThreshold"),g.justifyThreshold<0||g.justifyThreshold>1){throw"justifyThreshold must be in the interval [0,1]"}if("boolean"!=typeof g.cssAnimation){throw"cssAnimation must be a boolean"}if(h(g.captionSettings,"animationDuration"),h(g,"imagesAnimationDuration"),h(g.captionSettings,"visibleOpacity"),g.captionSettings.visibleOpacity<0||g.captionSettings.visibleOpacity>1){throw"captionSettings.visibleOpacity must be in the interval [0, 1]"}if(h(g.captionSettings,"nonVisibleOpacity"),g.captionSettings.visibleOpacity<0||g.captionSettings.visibleOpacity>1){throw"captionSettings.nonVisibleOpacity must be in the interval [0, 1]"}if("boolean"!=typeof g.fixedHeight){throw"fixedHeight must be a boolean"}if("boolean"!=typeof g.captions){throw"captions must be a boolean"}if(h(g,"refreshTime"),"boolean"!=typeof g.randomize){throw"randomize must be a boolean"}}var a={sizeRangeSuffixes:{lt100:"_t",lt240:"_m",lt320:"_n",lt500:"",lt640:"_z",lt1024:"_b"},rowHeight:120,maxRowHeight:0,margins:1,lastRow:"nojustify",justifyThreshold:0.75,fixedHeight:!1,waitThumbnailsLoad:!0,captions:!0,cssAnimation:!1,imagesAnimationDuration:500,captionSettings:{animationDuration:500,visibleOpacity:0.7,nonVisibleOpacity:0},rel:null,target:null,extension:/\.[^.\\/]+$/,refreshTime:100,randomize:!1};return this.each(function(p,o){var n=b(o);n.addClass("justified-gallery");var m=n.data("jg.context");if("undefined"==typeof m){if("undefined"!=typeof R&&null!==R&&"object"!=typeof R){throw"The argument must be an object"}var l=b('<div class="spinner"><span></span><span></span><span></span></div>');m={settings:b.extend({},a,R),imgAnalyzerTimeout:null,entries:null,buildingRow:{entriesBuff:[],width:0,aspectRatio:0},lastAnalyzedIndex:-1,yield:{every:2,flushed:0},offY:0,spinner:{active:!1,phase:0,timeslot:150,$el:l,$points:l.find("span"),intervalId:null},checkWidthIntervalId:null,galleryWidth:n.width(),$gallery:n},n.data("jg.context",m)}else{if("norewind"===R){for(var k=0;k<m.buildingRow.entriesBuff.length;k++){I(m.buildingRow.entriesBuff[k],m)}}else{m.settings=b.extend({},m.settings,R),F(m)}}if(x(m),m.entries=n.find("> a, > div:not(.spinner)").toArray(),0!==m.entries.length){m.settings.randomize&&(m.entries.sort(function(){return 2*Math.random()-1}),b.each(m.entries,function(){b(this).appendTo(n)}));var j=!1;b.each(m.entries,function(v,u){var t=b(u),s=t.find("img");if(s.data("jg.loaded")!==!0&&"skipped"!==s.data("jg.loaded")){null!==m.settings.rel&&t.attr("rel",m.settings.rel),null!==m.settings.target&&t.attr("target",m.settings.target);var r="undefined"!=typeof s.data("safe-src")?s.data("safe-src"):s.attr("src");s.data("jg.originalSrc",r),s.attr("src",r);var q=parseInt(s.attr("width"),10),i=parseInt(s.attr("height"),10);if(m.settings.waitThumbnailsLoad!==!0&&!isNaN(q)&&!isNaN(i)){return s.data("jg.imgw",q),s.data("jg.imgh",i),s.data("jg.loaded","skipped"),z(m,!1),!0}s.data("jg.loaded",!1),j=!0,m.spinner.active===!1&&(m.spinner.active=!0,n.append(m.spinner.$el),n.height(m.offY+m.spinner.$el.innerHeight()),C(m.spinner));var f=new Image,e=b(f);e.one("load",function(){s.off("load error"),s.data("jg.imgw",f.width),s.data("jg.imgh",f.height),s.data("jg.loaded",!0),z(m,!1)}),e.one("error",function(){s.off("load error"),s.data("jg.loaded","error"),z(m,!1)}),f.src=r}}),j||z(m,!1),D(m)}})}}(jQuery);(function(a){a.fn.imgLoader=function(h,k){var d=a(window),c=h||0,f="data-src",j=this,g=[],e,b;this.one("imgLoader",function(){var l=this.getAttribute(f),l=l||this.getAttribute("data-src");if(l){var m=a(this);m.removeAttr(f).attr("src",l)}});function i(){e=j.filter(function(){var n=a(this),m=d.scrollTop(),p=m+d.height(),q=n.offset().top,o=q+n.outerHeight();return(o>=m-c&&q<=p+c)});(function l(m){if(m>=e.length){return m}a(e[m]).trigger("imgLoader");setTimeout(function(){l(m+1)},50);if(m+1==e.length){if(typeof k==="function"){k.call(e)}}})(0)}d.on("scroll.imgLoader resize.imgLoader lookup.imgLoader",i);i();return this}})(window.jQuery);