(function(b,a,c,d){c.vobox=function(g,t){var k={useCSS:true,initialIndexOnArray:0,hideBarsDelay:4000,videoMaxWidth:1140,beforeOpen:null,afterClose:null},o=this,e=[],g=g,h=g.selector,s=c(h),m={index:null,type:null},r=false,j=a.createTouch!==d||("ontouchstart" in b)||("onmsgesturechange" in b)||navigator.msMaxTouchPoints,l=!!(b.SVGSVGElement),f=b.innerWidth?b.innerWidth:c(b).width(),i=b.innerHeight?b.innerHeight:c(b).height(),n='<div id="vobox-overlay">                        <div id="vobox-container">				<div id="vobox-slider"></div>				<div class="navbar navbar-inverse mb0" id="vobox-caption">                        <div class="container-fluid">                        <ul class="nav pull-left">                        <li id="vobox-title"><span class="icon large"></span> <b></b></li>                        </ul>                        <ul class="nav navbar-nav midaction">                        <li><a href="javascript:;" id="vobox-download" title="Download" rel="tip" data-container="item" data-placement="bottom"><i class="icon icon-download"></i></a></li>                        <li><a href="javascript:;" id="vobox-email" title="Email" rel="tip" data-container="item" data-placement="bottom"><i class="icon icon-envelope"></i></a></li>                        <li><a href="javascript:;" id="vobox-share" title="Share" rel="tip" data-container="item" data-placement="bottom"><i class="icon icon-share-alt"></i></a></li>                        </ul>                        <ul class="nav navbar-nav pull-right closenav">                        <li><a id="vobox-close" title="Close" rel="tip" data-container="item"><i class="icon icon-times"></i></a></li>                        </ul>                        </div>                        </div>                        <div class="vobox-side vobox-prev-container curdef">                            <div id="vobox-prev" title="Previous" rel="tip" data-container="item" data-placement="right"></div>                        </div>                        <div class="vobox-side vobox-next-container curdef">                            <div id="vobox-next" title="Next" rel="tip" data-container="item" data-placement="left"></div>                        </div>                        <div class="vobox-baseline">                        <div class="vobox-count-container">                        <div id="vobox-count"><span class="current">1</span> of <span class="total">1</span> items</div>                        </div>                        <div class="vobox-description-container">                        <div id="vobox-description"><span class="current"></span></div>                        </div>                        </div>                        </div>                        </div>',q=false;o.settings={};o.init=function(){o.settings=c.extend({},k,t);if(c.isArray(g)){e=g;p.target=c(b);p.init(o.settings.initialIndexOnArray)}else{s.off("click");s.click(function(w){w.stopPropagation();w.preventDefault();e=[];var u,v,x;if(!x){v="rel";x=c(this).attr(v)}if(x&&x!==""&&x!=="nofollow"){$elem=s.filter("["+v+'="'+x+'"]')}else{$elem=c(h)}$elem.each(function(D){var C=c(this);var E=null,A=C.attr("href")||null,z=(A===null)?(C.data("direct")?C.closest(".tt-dataset-0"):C.closest(".preview")):C,B=z.data();itemKey=C.data("hash");if(A===null){if(B.ftype=="video"||B.ftype=="audio"){var y=((currDir!=UIDIR||B.dirhash)?(UIDIR+B.path):UIDIR);A=CLO_URL+"/"+y+"/"+B.t}else{if(B.ftype=="image"){var y=((currDir!=UIDIR)?(UIDIR+"/"+currDir):UIDIR);if(B.dirhash){y=UIDIR+"/"+B.dirhash}A=CLO_URL+"/"+y+"/"+B.ftype+"/"+itemKey+"."+B.ext+":large"}else{var y=((currDir!=UIDIR)?(UIDIR+"/"+currDir):UIDIR);if(B.dirhash){y=UIDIR+"/"+B.dirhash}A=CLO_URL+"/"+y+"/"+B.ftype+"/"+itemKey+"."+B.ext}}}e.push({data:B,href:A,title:B.t,type:B.ftype,loaded:false})});u=$elem.index(c(this));w.preventDefault();w.stopPropagation();p.target=c(w.target);p.init(u);return false})}};o.revobox=function(){if(!c.isArray(g)){p.destroy();$elem=c(h);p.actions()}};var p={init:function(v){if(o.settings.beforeOpen){o.settings.beforeOpen()}this.target.trigger("vobox-start");c.vobox.isOpen=true;this.build();this.openSlide(v);this.openMedia(v);var u=this;setTimeout(function(){u.preloadMedia(v+1);u.preloadMedia(v-1)},1000)},build:function(){var u=this;c(".popover").popover("hide");c("body").append(n);if(u.doCssTrans()){c("#vobox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"});c("#vobox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"});c("#vobox-action, #vobox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"});c("#userUi").disabletoggle(true)}c.each(e,function(){c("#vobox-slider").append('<div class="slide"></div>')});u.setDim();u.actions();u.keyboard();u.gesture();u.animBars();u.resize();c("#vobox-count").find("span.total").text(e.length)},setDim:function(){var w,u,v={};if("onorientationchange" in b){b.addEventListener("orientationchange",function(){if(b.orientation==0){w=f;u=i}else{if(b.orientation==90||b.orientation==-90){w=i;u=f}}},false)}else{w=b.innerWidth?b.innerWidth:c(b).width();u=b.innerHeight?b.innerHeight:c(b).height()}v={width:w,height:u};c("#vobox-overlay").css(v)},resize:function(){var u=this},supportTransition:function(){var v="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" ");for(var u=0;u<v.length;u++){if(a.createElement("div").style[v[u]]!==d){return v[u]}}return false},doCssTrans:function(){if(o.settings.useCSS&&this.supportTransition()){return true}},gesture:function(){if(j){var y=this,z=null,x=10,w={},u={};var v=c("#vobox-caption, #vobox-action");v.addClass("visible-bars");y.setTimeout();c("body").bind("touchstart.vobox",function(A){c(this).addClass("touching");u=A.originalEvent.targetTouches[0];w.pageX=A.originalEvent.targetTouches[0].pageX;c(".touching").bind("touchmove.vobox",function(B){B.preventDefault();B.stopPropagation();u=B.originalEvent.targetTouches[0]});return false}).bind("touchend.vobox",function(A){A.preventDefault();A.stopPropagation();if(isModal()){return}z=u.pageX-w.pageX;if(z>=x){y.getPrev();y.showBars();y.setTimeout()}else{if(z<=-x){y.getNext();y.showBars();y.setTimeout()}else{if(!v.hasClass("visible-bars")){y.showBars();y.setTimeout()}else{y.clearTimeout();y.hideBars()}}}c("body").on("click","#vobox-overlay",function(){c("body").trigger("touchend.vobox")});c(".touching").unbind("touchmove.vobox").removeClass("touching")})}},setTimeout:function(){if(o.settings.hideBarsDelay>0){var u=this;u.clearTimeout();u.timeout=b.setTimeout(function(){u.hideBars()},o.settings.hideBarsDelay)}},clearTimeout:function(){b.clearTimeout(this.timeout);this.timeout=null},showBars:function(){var u=c("#vobox-caption, #vobox-action");if(this.doCssTrans()){u.addClass("visible-bars")}else{c("#vobox-caption").animate({top:0},500);c("#vobox-action").animate({bottom:0},500);setTimeout(function(){u.addClass("visible-bars")},1000)}},hideBars:function(){var u=c("#vobox-caption, #vobox-action");if(this.doCssTrans()){u.removeClass("visible-bars")}else{c("#vobox-caption").animate({top:"-50px"},500);c("#vobox-action").animate({bottom:"-50px"},500);setTimeout(function(){u.removeClass("visible-bars")},1000)}},animBars:function(){var v=this;var u=c("#vobox-caption, #vobox-action");u.addClass("visible-bars");v.setTimeout();c("#vobox-slider").click(function(w){if(!u.hasClass("visible-bars")){v.showBars();v.setTimeout()}});c("#vobox-caption").hover(function(){v.showBars();u.addClass("force-visible-bars visible-bars");v.clearTimeout()},function(){u.removeClass("force-visible-bars visible-bars");v.setTimeout()})},keyboard:function(){var u=this;c(b).bind("keyup",function(v){v.preventDefault();v.stopPropagation();if(v.keyCode==37){u.getPrev()}else{if(v.keyCode==39){u.getNext()}else{if(v.keyCode==27){u.closeSlide()}}}})},actions:function(){var u=this;if(e.length<2){c("#vobox-prev, #vobox-next").hide()}else{c("#vobox-prev").bind("click touchend",function(v){v.preventDefault();v.stopPropagation();u.getPrev();u.setTimeout()});c("#vobox-next").bind("click touchend",function(v){v.preventDefault();v.stopPropagation();u.getNext();u.setTimeout()})}c("#vobox-download").bind("click touchend",function(y){y.preventDefault();y.stopPropagation();var x=c("#vobox-slider").data("current");var w=c($elem[x]);if(typeof downloadSingleItem==="function"){downloadSingleItem(w.closest("li"),false)}else{var v=CLO_URL+"/?octet=download&file="+w.data("t")+"&store="+w.data("store");c.fileDownload(v)}return false});if(typeof itemActions==="function"){c("#vobox-email").bind("click touchend",function(x){x.preventDefault();x.stopPropagation();var w=c("#vobox-slider").data("current");var v=c($elem[w]);itemActions("email",v.closest("li"));return false})}else{this.addEmailPop()}if(typeof itemActions==="function"){c("#vobox-share").bind("click touchend",function(w){w.preventDefault();w.stopPropagation();var v=c("#vobox-slider").data("current");itemActions("shareItem",c($elem[v]).closest("li"));return false})}else{this.sharePop()}c("#vobox-close").bind("click touchend",function(y){var w=c("#vobox-slider .slide.current"),v=c("#vobox-slider .slide").index(w),x=e[v].type;if((x=="video"||x=="audio")&&r){mel=w.find(x);$elem.eq(v).closest(".preview").data("currentTime",mel[0].player.getCurrentTime())}y.preventDefault();y.stopPropagation();u.closeSlide()})},setSlide:function(v,u){u=u||false;var w=c("#vobox-slider");if(this.doCssTrans()){w.css({left:(-v*100)+"%"})}else{w.animate({left:(-v*100)+"%"})}w.find(".slide").data("index",v).removeClass("current");w.find(".slide").eq(v).addClass("current");this.setTitle(v);c("#vobox-count").find("span.current").text(v+1);if(u){w.fadeIn()}c("#vobox-prev, #vobox-next").removeClass("disabled");if(v==0){hideTip(c("#vobox-prev")[0]);c("#vobox-prev").addClass("disabled")}else{if(v==e.length-1){hideTip(c("#vobox-next")[0]);c("#vobox-next").addClass("disabled")}}w.data("current",v)},openSlide:function(u){c("html").addClass("vobox");this.setSlide(u,true)},preloadMedia:function(u){var w=this,x=null,v;if(e[u]!==d&&e[u].type!="video"&&e[u].type!="audio"){x=e[u].href}w.openMedia(u)},openMedia:function(u){var w=this,x=null,v=null;if(e[u]!==d){x=e[u].href;v=e[u].type}if(u<0||u>=e.length){return false}switch(v){case"audio":w.loadMedia(v,x,u);break;case"video":w.loadMedia(v,x,u);break;case"document":case"other":w.loadDocument(v,x,u);break;default:c("#vobox-slider .slide").eq(u).html(this).prepend('<div class="indicator"><span></span><span></span><span></span></div>');w.loadImage(v,x,u);break}w.showBars();w.setTimeout()},setTitle:function(v,u){var y=this,z=null,x=c("#vobox-title"),w=e[v].type;x.find("b").empty();if(e[v]!==d){$item=$elem.eq(v);id=$item.data("id");y.setShare(v,u,id,z);y.setOptions(v,u)}x.find("b").text(e[v].title);x.find("span").attr("class","icon").addClass(iconTypes[w]+" "+filterTypes[w]);if(e[v].data.description){c("#vobox-description").show().find(".current").text(e[v].data.description)}else{c("#vobox-description").hide()}},setShare:function(w,u,y,x){var v=null},setOptions:function(w,u){var v=null;c("#vobox-options").empty();var x=$elem.eq(w);file=x.data("file");var y=c('<a href="javascript:;" data-title="" class="btn" data-action="fi_download" data-file="'+file+'" data-item="" data-ajax="loadShareBox"><i class="icon-white icon-cloud-download"></i><span> Download</span></a>'),z=c('<a href="javascript:;" class="btn"><i class="icon-pause"></i><a>');c("#vobox-caption").find("div.actions").append(y);if(c("body").data("playing")){c("#vobox-caption").find("div.actions").prepend(z)}},isVideo:function(u){if(u){if(u=="video"){return true}return false}},isDoc:function(u){if(type){if(type=="document"){return true}return false}},callMediaPlayer:function(u,v,w){u.find(w).mediaelementplayer({defaultVideoWidth:((isMob()||isTablet())?DevWidth-50:"480"),defaultVideoHeight:((isMob()||isTablet())?DevHeight-140:270),videoWidth:-1,videoHeight:-1,audioWidth:((isMob()||isTablet())?DevWidth-50:"480"),audioHeight:30,startVolume:0.8,plugins:["flash","silverlight"],pluginPath:ASSURI+"player/",flashName:"player.swf",silverlightName:"player.xap",features:["playpause","progress","current","duration","tracks","volume","fullscreen"],alwaysShowControls:false,enableAutosize:true,pluginWidth:-1,pluginHeight:-1,enableKeyboard:true,timerRate:250,success:function(A){A.addEventListener("ended",function(){this.player.exitFullScreen()},true);A.addEventListener("play",function(){e[v].playing=true;m={index:v,type:w};r=true},true);A.addEventListener("pause",function(){e[v].playing=false;m={index:null,type:null};x=false},true);if(e[v].data.currentTime){var z=e[v].data.currentTime,x=false,y=e[v].data.playState;A.addEventListener("loadedmetadata",function(B){if(!x&&z>0){A.setCurrentTime(z);if(y===true){setTimeout(function(){A.play()},17)}x=true}},false)}},error:function(){console.log("player cannot initialized! check your server configuration.")}});if(u.find(".download").length>0){u.find(".download").prepend(c('<div style="position: absolute; bottom: 10px; left: 0; right: 0; font-size: 10px; color: white; text-align: center">Your browser does not support to play this kind of media.</div>'));u.find(".download").find("a").on("click touchend",function(x){x.preventDefault();x.stopPropagation();return createTempIframe("?octet&file="+$elem.eq(v).data("file"));return false}).attr("href","#").prepend('<i class="icon-white icon-cloud-download icon-3x" /> ')}return true},loadMedia:function(y,z,v){var x=false,u=c("#vobox-slider .slide").eq(v);if(!e[v].loaded){var w=c((y=="video"?'<video width="'+(DevWidth*0.8)+'" height="'+(DevHeight-120)+'" id="player_'+v+'" src="'+z+'" preload="false">':'<audio id="player" src="'+z+'" preload="false">')+'<object width="566" height="320" type="application/x-shockwave-flash" data="'+ASSURI+'player/player.swf"><param name="movie" value="'+ASSURI+'player/player.swf" /><param name="flashvars" value="controls=true&file='+z+'" /></object>'+(y=="video"?"</video>":"</audio>"));u.append(w);var x=this.callMediaPlayer(u,v,y);if(x){this.removeInd(v);e[v].loaded=true}}else{return e[v]}return true},loadImage:function(w,y,v){var x=this;if(w=="image"){if(!e[v].loaded){var u=c("<img>").on("load",function(){c("#vobox-slider .slide").eq(v).html(this).prepend('<span class="om"></span>')});u.attr("src",y).on("load",function(){x.removeInd(v);e[v].loaded=true;if(!isMob()&&!isTablet()){c("#vobox-slider .slide").eq(v).find(".om").css({width:u.width(),height:c(b).height()})}})}else{return e[v]}}},loadDocument:function(D,u,A){if(!e[A].loaded){var C=this,v="if_"+D+"_"+A,y=c("#vobox-slider .slide").eq(A).height()-70,E=c("#vobox-slider .slide").eq(A).width()/2*1.2,B="col-xs-12 col-md-8  col-lg-8",x=c('<div class="'+B+' viewer_frame">\n                                        <div class="indicator"><span></span><span></span><span></span></div>\n                                        <iframe id="'+v+'" src="'+u+'" />\n                                        </div>');var z={height:y,"margin-top":0,overflow:"hidden","overflow-y":"auto",border:"none","line-height":"1.4",};x.find("iframe").attr("src",u).css(z).load(function(){var w=c(this);e[A].loaded=true;setTimeout(function(){x.find(".indicator").remove().detach()},750)});c("#vobox-slider .slide").eq(A).html(x)}else{return e[A]}},stopMedia:function(){if(m.index!==null){var v=c("#vobox-slider .slide").eq(m.index).find(m.type),u=v.prop("src");v[0].player.pause()}m={index:null,type:null};return true},getNext:function(){var v=this,u=c("#vobox-slider .slide").index(c("#vobox-slider .slide.current"));if(v.stopMedia()){if(u+1<e.length){u++;v.setSlide(u);setTimeout(function(){v.preloadMedia(u+1)},500)}else{c("#vobox-slider").addClass("rightSpring");setTimeout(function(){c("#vobox-slider").removeClass("rightSpring")},500)}}c("#vobox-email").closest("li").popover("destroy");c("#vobox-share").closest("li").popover("destroy");this.addEmailPop();this.sharePop()},getPrev:function(){var v=this,u=c("#vobox-slider .slide").index(c("#vobox-slider .slide.current"));if(this.stopMedia()){if(u>0){u--;this.setSlide(u);setTimeout(function(){v.preloadMedia(u-1)},500)}else{c("#vobox-slider").addClass("leftSpring");setTimeout(function(){c("#vobox-slider").removeClass("leftSpring")},500)}}c("#vobox-email").closest("li").popover("destroy");c("#vobox-share").closest("li").popover("destroy");this.addEmailPop();this.sharePop()},closeSlide:function(){c("html").removeClass("vobox");this.destroy();setTimeout(function(){c("#userUi").disabletoggle(false)},600)},removeInd:function(u){c("#vobox-slider .slide").eq(u).css("background-image","none")},destroy:function(){if(r){var u=c("#vobox-slider").find("video,audio");u.each(function(){var v=u.prop("src");this.player.setSrc(v)})}c(b).unbind("keyup");c("body").unbind("touchstart.vobox");c("body").unbind("touchmove.vobox");c("body").unbind("touchend.vobox");c("#vobox-slider").unbind();c("#vobox-overlay").remove();if(!c.isArray(g)){g.removeData("_vobox")}if(this.target){this.target.trigger("vobox-destroy")}c.vobox.isOpen=false;if(o.settings.afterClose){o.settings.afterClose()}},sharePop:function(){setTimeout(function(){var w=c("#vobox-slider").data("current"),u=c($elem[w]),x='<i class="icon icon-share-alt"></i> Share <small class="ul">'+u.data("t")+"</small>",v='<div id="share_box"><div class="sharebox"></div></div>';c("#vobox-share").closest("li").popover({html:true,content:v,placement:"bottom",title:x}).on("shown.bs.popover",function(){var z=c(this);var y=z.closest("ul").find(".popover-content");c.ajaxQueue({url:"/",type:"POST",data:{shareViaShare:true,value:u.data("id"),uid:u.closest("ul.share").data("uid")},dataType:"json",beforeSend:function(){y.spin()},success:function(A){y.spin(false);y.find(".sharebox").html(A.html);y.find(".sharebox").share({networks:A.shareOpts,link:A.link,url:A.url,title:A.title,desc:A.description,excpt:["email"],theme:"default"})}})})},11);c("#vobox-caption").find("li").off("click").on("click",function(u){c("#vobox-caption").find("li").not(this).popover("hide")})},addEmailPop:function(){setTimeout(function(){var w=c("#vobox-slider").data("current");var v=c($elem[w]),u=c("#vobox-email").closest("li");createEmailPop(v,u)},11);c("#vobox-caption").find("li").off("click").on("click",function(u){c("#vobox-caption").find("li").not(this).popover("hide")})}};o.init()};c.fn.vobox=function(e){if(!c.data(this,"_vobox")){var f=new c.vobox(this,e);this.data("_vobox",f)}return this.data("_vobox")}}(window,document,jQuery));