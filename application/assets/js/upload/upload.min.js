
$(function(){uploadButton=$('<button type="button"/ class="startstop dn">').on("click",function(){var d=$(this),c=d.data()||false;c.abort().done(function(){d.remove()})});clearButton=$('<button type="button"/>').addClass("btn clear dnone").on("click",function(){var d=$(this),c=d.data()||false;if(c){c.abort();c.context.remove()}});removeButton=$('<button type="button"/>').addClass("btn btn-danger btn-small remove").attr("title","Remove").append('<i class="icon-remove"/>').on("click",function(){var d=$(this),c=d.closest("li").find("button.startstop").data()||false;if(c){c.abort()}if($("#files").find("li").length==1){$toolBarclearbtn.trigger("click")}else{if(c){removeNode(c.context.find("li"))}else{removeNode(d.closest("li"))}}});$progBar=$("#uprogress");$totalProg=$("#totalProgress");$sumProg=$("#sumProgress");progressHtmlText={uploading:'<div class="indicator green sm"><span></span><span></span><span></span></div> Uploading Files',completed:'<i class="icon icon-check light-green"></i> Upload Completed!',timeremaining:"Time remaining",timeelapsed:"Time elapsed"};var b={url:AJAX_PATH,dataType:"json",sequentialUploads:true,maxFileSize:500000000,maxChunkSize:1000000,formData:[{name:"uploadme",value:1},{name:"dir",value:dir.id},{name:"path",value:dir.path}],progress:function(m,k){if(m.isDefaultPrevented()){return false}var n=$(this),l=n.data("xnu-fileupload")||n.data("fileupload");var j=$(this).data("xnuFileupload").options.previewMaxWidth/2,i=$(this).data("xnuFileupload").options.previewMaxHeight/2;var d=Math.floor(k.loaded/k.total*100),g=parseInt(100-d),f=(g==0?0.01:g),d=d==100?99.99:d;var r=360*d/100,c=360-r,h=k.anim,q=h.paths;var p=[j,i,i,0,c,1,"#8AC53E"];q[0].animate({segment:p},1500,"bounce");q[0].angle=0;var o=[j,i,i,0,r,0,"#8AC53E"];q[1].animate({segment:o},1500,"bounce");q[1].angle=0;k.context.each(function(s){var u=k.files[s],e=u.uniqueId,t=$("#"+e),w=$(".fileupload-progress .current .upload-part").last(),v=parseInt(k.loaded/k.total*100,10);t.find(".percent b").text(v);t.find(".bar").css("width",v+"%");t.find(".completed").text(l._formatFileSize(k.loaded));t.find(".total").text(l._formatFileSize(k.total))})},completed:function(d,c){var f=c.anim;setTimeout(function(){f.bottom.animate({fill:"#fff",opacity:0},2000,function(){f.remove()});f.bottom.next.animate({opacity:0},1000);f.bottom.next.next.animate({opacity:0},1500)},1000);$.each(c.result.files,function(g,h){var i=$(c.context[g]);i.find(".tnpreviewImageContainer").addClass("done");var e;e=new Image();e.onload=function(){i.find(".tnpreviewImageContainer").removeClass("done")};e.src=h.preview})},failed:function(f,c){if(c._progress.loaded>0){var d=c.formData[3].value;$.getJSON(AJAX_PATH,{action:"encr",str:d}).done(function(e){$.ajaxQueue({url:AJAX_PATH+"?cancel=true&file="+c.files[0].name+"&store="+e.hash,noind:true,async:false,dataType:"json",type:"DELETE",success:function(g){c.context.detach().remove()}})})}}};var a=$.extend(true,b,uOptions);$("#fileupload").fileupload(a).on("fileuploadstart",function(f,d){var c=$(this).data("xnu-fileupload")||$(this).data("fileupload");$list.addClass("listdown");c.startedTime=new Date()}).on("fileuploadstop",function(d){var c=$(this).data("xnu-fileupload")||$(this).data("fileupload");setTimeout(function(){$(".fileupload-progress").slideUp()},1600);setTimeout(function(){$list.removeClass("listdown")},2500)});styleFileInputs();$(document).bind("dragover",function(g){var h=$("#dropzone"),f=window.dropZoneTimeout;if(!f){h.addClass("in")}else{clearTimeout(f)}var d=false,c=g.target;do{if(c===h[0]){d=true;break}c=c.parentNode}while(c!==null&&c!=null);if(d){h.addClass("hover");doAnim(h)}else{h.removeClass("hover");doAnim(h)}window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null;h.removeClass("in hover")},300)});$(document).on("drop",function(c){c.stopPropagation();c.preventDefault()})});function doAnim(h){if(h.data("paths")){var c=h.data(),g=c.paths.paper,e=c.paths.circle}else{var d=$(window).width(),a=$(window).height();var f={},g=Raphael(h[0],d,a),e=g.circle(d/2,a/2,240),b=g.text(d/2,a/2,h.find("span").text());b.attr({"font-size":50,"font-family":"Arial, Helvetica, sans-serif",fill:"#FFFFFF"});h.data("paths",{paper:g,circle:e})}if(e.attr("stroke-width")>40){e.animate({fill:"#223fa3",stroke:"#FFF","stroke-width":1,"stroke-opacity":0.9},2000)}else{if(e.attr("stroke-width")==1){e.animate({fill:"#223fa3",stroke:"#FFF","stroke-width":41,"stroke-opacity":0.9},2000)}}}function styleFileInputs(){$(":file").filestyle({input:false,buttonText:"Upload",classButton:"act btn btn-block fileinput-button dblock",classIcon:"icon-cloud-upload"})}var jqXHR=null;(function(a){if(typeof define==="function"&&define.amd){define(["jquery","tmpl","./cl.fuploader.image","./cl.fuploader.audio","./cl.fuploader.video","./cl.fuploader.validate"],a)}else{a(window.jQuery,window.tmpl)}}(function(b,a){b.xnu.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId");b.widget("xnu.fileupload",b.xnu.fileupload,{options:{autoUpload:true,uploadTemplateId:"item-tpl",downloadTemplateId:"item-tpl",filesContainer:b("#list .directoryList"),prependFiles:true,dataType:"json",waitt:300,getNumberOfFiles:function(){return this.filesContainer.children().not(".rendering").length},getFilesFromResponse:function(c){if(c.result&&b.isArray(c.result.files)){return c.result.files}return[]},add:function(j,h){if(j.isDefaultPrevented()){return false}var i=b(this),g=i.data("xnu-fileupload")||i.data("fileupload"),c=g.options;b.each(h.files,function(e){h.files[e].uniqueId="ui"+guid()});h.context=g._renderUpload(h.files).data("data",h).addClass("rendering tobeUploaded");c.filesContainer[c.prependFiles?"prepend":"append"](h.context);var f=h.context.find(".tnpreviewImage"),d=parseInt(f.width()),k=parseInt(f.height());g.options.previewMaxWidth=(g.options.previewMaxWidth<d)?g.options.previewMaxWidth:d;g.options.previewMaxHeight=(g.options.previewMaxHeight<k)?g.options.previewMaxHeight:k-2;g.options.formData=[{name:"uploadme",value:1},{name:"size",value:1},{name:"dir",value:dir.id},{name:"path",value:dir.path},{name:"now",value:b.pdate("Y-m-d H:i:s",new Date())}];g.options=b.extend(true,g.options,uOptions);g._forceReflow(h.context);g._transition(h.context);h.process(function(){return i.fileupload("process",h)}).always(function(){h.context.each(function(e){g.options.formData[1]={name:"size",value:h.files[e].size};b(this).find(".tnfileSize").text(g._formatFileSize(h.files[e].size))}).removeClass("rendering");g._renderPreviews(h,c);emptyDirectory(true)}).done(function(){h.context.each(function(e){b(this).find(".tnpreviewImage").append('<span class="tnuploadIndicator"/>')});if((g._trigger("added",j,h)!==false)&&(c.autoUpload||h.autoUpload)&&h.autoUpload!==false){jqXHR=h.submit()}h.context.append(uploadButton.clone(true).data(h));h.context.each(function(e){var l=b(this);var m=b('<div class="close" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; cursor: pointer; background: transparent; z-index: 4" rel="tip" data-title="Cancel">');if(touchable){m.append('<b style="width: 100%; position: absolute; top: 50%; height: 36px; margin-top: -18px; text-align: center; color: rgba(0,0,0,0.8)">Cancel</b>')}m.on("click",function(){l.find("button.startstop").trigger("click")});l.prepend(m)});$screl.scrollTop(0)}).fail(function(){console.log("failed");if(h.files.error){h.context.each(function(l){var e=h.files[l].error,m=h.files[l].errorCode;i=b(this);if(e){i.addClass("failed");i.find("input[type=checkbox]").remove();switch(m){case"0202":removeNode(i);break;case"0203":i.find(".tnpreviewImage").addClass("error");break;case"0204":i.find(".tnfileSize").addClass("danger").append("<b>("+e+")</b>").closest(".bleft").css("width","auto");break;case"0205":i.find(".tnfileSize").addClass("danger").append("<b>("+e+")</b>").closest(".bleft").css("width","auto");break}i.find(".dwnTip, .tnpreviewDesc").remove().detach()}})}})},send:function(f,d){if(f.isDefaultPrevented()){return false}var c=b(this).data("xnu-fileupload")||b(this).data("fileupload");d.context.each(function(j){var l=b(this),p=l.find(".tnuploadIndicator"),o=l.find(".tnpreviewImage"),e=o.width(),n=o.height(),h=Raphael(p[0],e,n),m=h.rect(0,0,e,n,0).attr({fill:"#000",opacity:0.6,stroke:1});o.append(p);var k=d.files[j].preview;var g=((k.width>=e)?true:((k.height>=n)?true:false));var i=h.rGPie(e/2,n/2,n/2,[359,0.1],["label 1","label 2"],false,k,g);h.paths=i;d.anim=h;b("#"+d.files[j].uniqueId).addClass("on").find(".progress-current-cancel-btn").toggleClass("btn-default disabled btn-black");b("#"+d.files[j].uniqueId).addClass("on").find(".progress-current-cancel-btn").on("click",function(){var r=b(this).closest(".upload-part")[0].id;var q=$body.findItem(r,"preview","uniqueid");q.find("button.startstop").trigger("click");c._resetFineshedProcess(true,{uniqueId:r});return false})}).removeClass("tobeUploaded").addClass("uploading");if(d.context&&d.dataType&&d.dataType.substr(0,6)==="iframe"){d.context.find(".progress").addClass(!b.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%")}return c._trigger("sent",f,d)},done:function(j,i){if(j.isDefaultPrevented()){return false}var h=b(this).data("xnu-fileupload")||b(this).data("fileupload"),d=i.getFilesFromResponse||h.options.getFilesFromResponse,g=d(i),f,c;hideTip(i.context.find(".close")[0]);setTimeout(function(){if(i.context){i.context.each(function(e){var k=g[e]||{error:"Empty file upload result"};h._resetFineshedProcess(true,i.files[e]);c=h._addFinishedDeferreds();h._transition(b(this)).done(function(){var l=b(this);f=h._renderDownload([k]).replaceAll(l);h._forceReflow(f);h._transition(f).done(function(){i.context=b(this);h._trigger("completed",j,i);h._trigger("finished",j,i);c.resolve();b(".vpsve").vobox()})});if(k.error){setTimeout(function(){f.remove()},50);return}updateItemsTotalText(false,1,k.filetype);if(currFilter&&currFilter!=k.filetype){b(this).fadeOut("fast",function(){setTimeout(function(){f.remove()},50);$notify.jGrowl("Uploaded file type is different than current filtered directory so it was moved to <i>"+k.filetype+"</i> directory.",{header:k.name+" uploaded & moved!",life:10000})})}}).removeClass("uploading").addClass("success")}else{f=h._renderDownload(g)[h.options.prependFiles?"prependTo":"appendTo"](h.options.filesContainer);h._forceReflow(f);c=h._addFinishedDeferreds();h._transition(f).done(function(){i.context=b(this);hideTip(i.context.find(".close")[0]);h._trigger("completed",j,i);h._trigger("finished",j,i);c.resolve()})}},h.options.waitt)},fail:function(h,g){if(h.isDefaultPrevented()){return false}var f=b(this).data("xnu-fileupload")||b(this).data("fileupload"),d,c;if(g.context){g.context.each(function(e){if(g.errorThrown!=="abort"){console.log("failed");var i=g.files[e];i.error=i.error||g.errorThrown||true;c=f._addFinishedDeferreds();f._transition(b(this)).done(function(){var j=b(this);d=f._renderDownload([i]).replaceAll(j);f._forceReflow(d);f._transition(d).done(function(){g.context=b(this);hideTip(g.context.find(".close")[0]);f._trigger("failed",h,g);f._trigger("finished",h,g);c.resolve();j.remove().detach()})})}else{console.log("aborted");g.context.each(function(j){f._resetFineshedProcess(true,g.files[j])});c=f._addFinishedDeferreds();f._transition(b(this)).done(function(){hideTip(b(this).find(".close")[0]);b(this).remove();f._trigger("failed",h,g);f._trigger("finished",h,g);c.resolve()})}})}else{if(g.errorThrown!=="abort"){console.log("failed");g.context=f._renderUpload(g.files)[f.options.prependFiles?"prependTo":"appendTo"](f.options.filesContainer).data("data",g);f._forceReflow(g.context);c=f._addFinishedDeferreds();f._transition(g.context).done(function(){g.context=b(this);hideTip(g.context.find(".close")[0]);f._trigger("failed",h,g);f._trigger("finished",h,g);c.resolve()})}else{g.context.each(function(e){f._resetFineshedProcess(true,g.files[e])});f._trigger("failed",h,g);f._trigger("finished",h,g);f._addFinishedDeferreds().resolve()}}},progress:function(f,d){if(f.isDefaultPrevented()){return false}var c=Math.floor(d.loaded/d.total*100);if(d.context){d.context.each(function(){b(this).find(".progress").attr("aria-valuenow",c).children().first().css("width",c+"%")})}},progressall:function(j,h){if(j.isDefaultPrevented()){return false}var g=b(this).data("xnu-fileupload")||b(this).data("fileupload"),d=parseInt(h.loaded/h.total*100,10),i=b(this),c=b(".fileupload-progress"),k=c.find(".progress-extended");if(k.length){(i.data("xnu-fileupload")||i.data("fileupload"))._renderExtendedProgress(h,k)}c.find(".progress .bar").css("width",d+"%");c.find(".progress .percent b").text(d);if(h.loaded==h.total){g.endedTime=new Date();setTimeout(function(){sidebarStatistics();emptyDirectory(($list.children().length>0))},g.options.waitt+200);c.find(".upload-heading h4").html(progressHtmlText.completed);var f=g._formatTime((g.endedTime.getTime()-g.startedTime.getTime())/1000);c.find(".remaining b").text(f).prop("title",progressHtmlText.timeelapsed)}},start:function(d){if(d.isDefaultPrevented()){return false}var c=b(this).data("xnu-fileupload")||b(this).data("fileupload");c._resetFinishedDeferreds();b(".fileupload-progress").slideDown();c._trigger("started",d);b(".fileupload-progress").find(".cancel").removeClass("disabled");c._trigger("started",d)},stop:function(f){if(f.isDefaultPrevented()){return false}var d=b(this).data("xnu-fileupload")||b(this).data("fileupload"),c=d._addFinishedDeferreds();b.when.apply(b,d._getFinishedDeferreds()).done(function(){d._trigger("stopped",f)});b(".fileupload-progress").find(".cancel").addClass("disabled")},process:function(f,d){var c=b(this).data("xnu-fileupload")||b(this).data("fileupload");d.context.each(function(g){var h=d.files[g],i=b(".fileupload-progress .current"),e=a('<div id="{%=o.uniqueId%}" class="upload-part pn animated">                                     <div class="upload-file-type">                                     <img src="'+ASSURI+'/img/filetypes/{%=o.data.realext[0]%}.png">                                     </div>                                     <div class="progress-current">                                     <span class="name"><b>{%=o.name%}</b></span>                                     <span class="percent"><b>0</b>%</span>                                     <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>                                     <div class="progress-current-info">                                     <span class="sizes">                                     <b class="completed">156 KB</b> of <b class="total">358 KB</b>                                     </span>                                     </div>                                     <a href="#" class="progress-current-cancel-btn btn btn-default disabled">                                     <i class="icon icon-times"></i>                                     </a></div></div>');i.append(e(h))})},processstart:function(c){if(c.isDefaultPrevented()){return false}b(".fileupload-progress").find(".upload-heading h4").html(progressHtmlText.uploading);b(".fileupload-progress").find(".remaining b").prop("title",progressHtmlText.timeremaining);b(this).addClass("fileupload-processing")},processstop:function(c){if(c.isDefaultPrevented()){return false}b(this).removeClass("fileupload-processing")},destroy:function(f,d){if(f.isDefaultPrevented()){return false}var c=b(this).data("xnu-fileupload")||b(this).data("fileupload"),g=function(){c._transition(d.context).done(function(){b(this).remove();c._trigger("destroyed",f,d)})};if(d.url){d.dataType=d.dataType||c.options.dataType;b.ajax(d).done(g).fail(function(){c._trigger("destroyfailed",f,d)})}else{g()}}},_resetFineshedProcess:function(c,d){if(c){var e=d.uniqueId;b("#"+e).addClass("zoomOutDown fast").removeClass("on").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(f){b(this).remove().detach()})}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(c){if(!c){c=b.Deferred()}this._finishedUploads.push(c);return c},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var f=b(this),d=f.prop("href"),c=f.prop("download"),e="application/octet-stream";f.bind("dragstart",function(g){try{g.originalEvent.dataTransfer.setData("DownloadURL",[e,c,d].join(":"))}catch(h){}})},_formatFileSize:function(c){if(typeof c!=="number"){return""}if(c>=1000000000){return(c/1000000000).toFixed(1)+" GB"}if(c>=1000000){return(c/1000000).toFixed(1)+" MB"}return(c/1000).toFixed(1)+" KB"},_formatBitrate:function(c){if(typeof c!=="number"){return""}if(c>=1000000000){return(c/1000000000).toFixed(2)+" Gbit/s"}if(c>=1000000){return(c/1000000).toFixed(2)+" Mbit/s"}if(c>=1000){return(c/1000).toFixed(2)+" kbit/s"}return c.toFixed(2)+" bit/s"},_formatTime:function(d){var c=new Date(d*1000),e=Math.floor(d/86400);e=e?e+"d ":"";return e+("0"+c.getUTCHours()).slice(-2)+":"+("0"+c.getUTCMinutes()).slice(-2)+":"+("0"+c.getUTCSeconds()).slice(-2)},_formatPercentage:function(c){return(c*100).toFixed(2)+" %"},_renderExtendedProgress:function(c,d){d.find(".bitrate b").text(this._formatBitrate(c.bitrate));d.find(".remaining b").text(this._formatTime((c.total-c.loaded)*8/c.bitrate));d.find(".totalPercentage b").text(this._formatPercentage(c.loaded/c.total));d.find(".loadedPerTotal b").text(this._formatFileSize(c.loaded)+" of "+this._formatFileSize(c.total))},_renderTemplate:function(e,d){if(!e){return b()}var c=e({files:d,formatFileSize:this._formatFileSize,options:this.options,});if(c instanceof b){return c}return b(this.options.templatesContainer).html(c).children()},_renderPreviews:function(d,c){d.context.find(".tnpreviewImage").each(function(e,h){var f=c.previewMaxWidth;var g=c.previewMaxHeight-2;if(d.files[e].preview){b(h).append(d.files[e].preview)}else{b(h).addClass(returnTypeIcon(fileExtension(d.files[e].name)[0]));d.files[e].preview=[b(h).css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""),202,202]}})},_renderUpload:function(d){d[0].data={};var c=fileExtension(d[0].name);d[0].data.ftype=returnTypeIcon(((c!==null)?c[0]:false));d[0].data.realext=c;return this._renderTemplate(this.options.uploadTemplate,d)},_renderDownload:function(e){if(e[0].error){e[0].data={}}var d=fileExtension(e[0].name);e[0].data.ftype=returnTypeIcon(((d!==null)?d[0]:false));e[0].data.realext=e[0].extensionr;var c=this._renderTemplate(this.options.downloadTemplate,e).data({id:e[0].id,t:e[0].name,date:e[0].date,type:"f",p:e[0].pureName,ftype:e[0].filetype,parent:dir.id,ext:e[0].extension,realext:e[0].extensionr,path:e[0].path});b.each(e,function(g,f){b.each(f.data,function(i,h){c.data(i,h)})});hideTip(c.find(".close")[0]);fileInfoBtn(c);return c},_startHandler:function(g){g.preventDefault();var c=b(g.currentTarget),d=c.closest(".template-upload"),f=d.data("data");c.prop("disabled",true);if(f&&f.submit){f.submit()}},_cancelHandler:function(f){f.preventDefault();var c=b(f.currentTarget).closest(".template-upload,.template-download"),d=c.data("data")||{};d.context=d.context||c;if(d.abort){d.abort()}else{d.errorThrown="abort";this._trigger("fail",f,d)}},_deleteHandler:function(d){d.preventDefault();var c=b(d.currentTarget);this._trigger("destroy",d,b.extend({context:c.closest(".template-download"),type:"DELETE"},c.data()))},_forceReflow:function(c){return b.support.transition&&c.length&&c[0].offsetWidth},_transition:function(d){var c=b.Deferred();if(!d){return c}if(d.hasClass("fade")){d.slideToggle(this.options.transitionDuration,this.options.transitionEasing,function(){c.resolveWith(d)})}else{c.resolveWith(d)}return c},_initButtonBarEventHandlers:function(){var c=b(".fileupload-progress"),d=this.options.filesContainer;this._on(c.find(".start"),{click:function(f){f.preventDefault();d.find(".start").click()}});this._on(c.find(".cancel"),{click:function(f){f.preventDefault();hideTip();d.find(".startstop").click()}});this._on(c.find(".delete"),{click:function(f){f.preventDefault();d.find(".toggle:checked").closest(".template-download").find(".delete").click();c.find(".toggle").prop("checked",false)}});this._on(c.find(".toggle"),{change:function(f){d.find(".toggle").prop("checked",b(f.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(b(".fileupload-progress").find(".start, .cancel, .delete"),"click");this._off(b(".fileupload-progress .toggle"),"change.")},_initEventHandlers:function(){this._super();this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler});this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers();this._off(this.options.filesContainer,"click");this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",false).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",true).parent().addClass("disabled")},_initTemplates:function(){var c=this.options;c.templatesContainer=this.document[0].createElement(c.filesContainer.prop("nodeName"));if(a){if(c.uploadTemplateId){c.uploadTemplate=a(c.uploadTemplateId)}if(c.downloadTemplateId){c.downloadTemplate=a(c.downloadTemplateId)}}},_initFilesContainer:function(){var c=this.options;if(c.filesContainer===undefined){c.filesContainer=this.element.find(".files")}else{if(!(c.filesContainer instanceof b)){c.filesContainer=b(c.filesContainer)}}},_initSpecialOptions:function(){this._super();this._initFilesContainer();this._initTemplates()},_create:function(){this._super();this._resetFinishedDeferreds();if(!b.support.fileInput){this._disableFileInputButton()}},enable:function(){var c=false;if(this.options.disabled){c=true}this._super();if(c){this.element.find("input, button").prop("disabled",false);this._enableFileInputButton()}},disable:function(){if(!this.options.disabled){this.element.find("input, button").prop("disabled",true);this._disableFileInputButton()}this._super()}})}));Raphael.fn.rGPie=function(c,b,g,a,u,l,o,h){var n=this;n.customAttributes.segment=function(D,C,B,z,e,r,i){var A=(e-z)>180,E=(e-z)/360;z=(z%360)*Math.PI/180;e=(e%360)*Math.PI/180;return{path:[["M",D,C],["l",B*Math.cos(z),B*Math.sin(z)],["A",B,B,0,+A,1,D+B*Math.cos(e),C+B*Math.sin(e)],["z"]],fill:"hsb(0, 0, .27)","fill-opacity":r}};var w=a,v={x:(c-b)*-1,y:(c-b)*-1,},q=n.set(),y,j,d=1,k=n.circle(c,b,g+8).attr({fill:"none",stroke:"#444","fill-opacity":0,"stroke-width":10}),f=n.circle(c,b,g).attr({stroke:"none","stroke-width":0});if(o){try{var p=($.isArray(o))?true:false;src=((p)?o[0]:o.toDataURL());ow=(p?o[1]:o.width),oh=(p?o[2]:o.height);if(p||(h&&!p)){f.attr({fill:"url("+src+") -20,-20,"+(ow)+","+(oh)+""})}}catch(t){}}n.set(k,f);w=w.sort(function(i,e){return e-i});y=0;for(var s=0,m=w.length;s<m;s++){y+=w[s]}j=0;for(s=0;s<m;s++){var x=360/y*w[s];(function(e,r){d=(e==0?1:0.3),color=(e<1?"#3980B5":"#8AC53E");q.push(n.path().attr({segment:[c,b,g,j,j+r,d,color],stroke:l}))})(s,x);j+=x}return q};